tasks:
    branch: "041-orchestrator-schema-validation"
    created: "2025-12-18"
    spec_path: "specs/041-orchestrator-schema-validation/spec.yaml"
    plan_path: "specs/041-orchestrator-schema-validation/plan.yaml"
summary:
    total_tasks: 21
    total_phases: 7
    parallel_opportunities: 6
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Create new source file structure for schema validation"
      tasks:
        - id: "T001"
          title: "Create internal/workflow/schema_validation.go skeleton"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/workflow/schema_validation.go"
          dependencies: []
          acceptance_criteria:
            - "File exists with package declaration and imports"
            - "Placeholder function signatures for ValidateSpecSchema, ValidatePlanSchema, ValidateTasksSchema"
    - number: 2
      title: "Foundational"
      purpose: "Core schema validation wrapper functions that MUST be complete before user stories"
      tasks:
        - id: "T002"
          title: "Implement ValidateSpecSchema() in internal/workflow/schema_validation.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/workflow/schema_validation.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Function calls validation.NewSpecValidator().Validate() internally"
            - "Returns error with formatted validation errors on failure"
            - "Returns nil on success"
            - "Function is under 40 lines"
        - id: "T003"
          title: "Implement ValidatePlanSchema() in internal/workflow/schema_validation.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/workflow/schema_validation.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Function calls validation.NewPlanValidator().Validate() internally"
            - "Returns error with formatted validation errors on failure"
            - "Returns nil on success"
            - "Function is under 40 lines"
        - id: "T004"
          title: "Implement ValidateTasksSchema() in internal/workflow/schema_validation.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/workflow/schema_validation.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Function calls validation.NewTasksValidator().Validate() internally"
            - "Returns error with formatted validation errors on failure"
            - "Returns nil on success"
            - "Function is under 40 lines"
        - id: "T005"
          title: "Add unit tests for schema validation wrappers in internal/workflow/schema_validation_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/workflow/schema_validation_test.go"
          dependencies: ["T002", "T003", "T004"]
          acceptance_criteria:
            - "Test ValidateSpecSchema with valid and invalid spec.yaml"
            - "Test ValidatePlanSchema with valid and invalid plan.yaml"
            - "Test ValidateTasksSchema with valid and invalid tasks.yaml"
            - "Tests use map-based table-driven pattern with t.Parallel()"
            - "All tests pass"
    - number: 3
      title: "User Story 1 - Programmatic schema validation after artifact generation"
      purpose: "Orchestrator validates generated artifacts against their full schema"
      story_reference: "US-001"
      independent_test: "Generate an artifact with missing required fields and verify the orchestrator rejects it"
      tasks:
        - id: "T006"
          title: "Update executeSpecify() to use ValidateSpecSchema() in internal/workflow/workflow.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/workflow/workflow.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "executeSpecify() passes ValidateSpecSchema as validateFunc to ExecuteStage()"
            - "Schema validation replaces file-existence check"
            - "Validation errors are returned from ExecuteStage()"
        - id: "T007"
          title: "Update executePlan() to use ValidatePlanSchema() in internal/workflow/workflow.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/workflow/workflow.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "executePlan() passes ValidatePlanSchema as validateFunc to ExecuteStage()"
            - "Schema validation replaces file-existence check"
            - "Validation errors are returned from ExecuteStage()"
        - id: "T008"
          title: "Update executeTasks() to use ValidateTasksSchema() in internal/workflow/workflow.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/workflow/workflow.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "executeTasks() passes ValidateTasksSchema as validateFunc to ExecuteStage()"
            - "Schema validation replaces file-existence check"
            - "Validation errors are returned from ExecuteStage()"
        - id: "T009"
          title: "Add integration tests for schema validation in workflow in internal/workflow/workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T006", "T007", "T008"]
          acceptance_criteria:
            - "Test that invalid spec.yaml is rejected before plan stage"
            - "Test that invalid plan.yaml is rejected before tasks stage"
            - "Test that invalid tasks.yaml is rejected before implement stage"
            - "Test that valid artifacts proceed to next stage"
            - "Tests use map-based table-driven pattern"
    - number: 4
      title: "User Story 2 - Actionable error feedback on retry"
      purpose: "Validation errors passed to Claude on retry attempts"
      story_reference: "US-002"
      independent_test: "Trigger a schema validation failure with retries enabled and verify the retry prompt includes the error details"
      tasks:
        - id: "T010"
          title: "Implement FormatRetryContext() function in internal/workflow/executor.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/workflow/executor.go"
          dependencies: ["T009"]
          acceptance_criteria:
            - "Creates retry context string in format 'RETRY X/Y\nSchema validation failed:\n- error1\n- error2'"
            - "Handles empty validation errors gracefully"
            - "Limits to first 10 errors with '...and N more errors' suffix"
            - "Function is under 40 lines"
        - id: "T011"
          title: "Implement BuildRetryCommand() function in internal/workflow/executor.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/workflow/executor.go"
          dependencies: ["T010"]
          acceptance_criteria:
            - "Prepends retry context to original $ARGUMENTS content"
            - "Handles empty original arguments (retry context becomes sole content)"
            - "Separates retry context from original args with blank line"
            - "Function is under 40 lines"
        - id: "T012"
          title: "Integrate retry context into handleValidationFailure() in internal/workflow/executor.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/workflow/executor.go"
          dependencies: ["T011"]
          acceptance_criteria:
            - "Captures validation errors from failed attempt"
            - "Uses BuildRetryCommand() to create retry command with error context"
            - "Passes retry command to next Claude invocation"
            - "Function modifications are under 40 lines"
        - id: "T013"
          title: "Add unit tests for retry context formatting in internal/workflow/executor_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-002"
          file_path: "internal/workflow/executor_test.go"
          dependencies: ["T012"]
          acceptance_criteria:
            - "Test FormatRetryContext with single error"
            - "Test FormatRetryContext with multiple errors"
            - "Test FormatRetryContext with more than 10 errors (truncation)"
            - "Test BuildRetryCommand with and without original arguments"
            - "Test retry command integration in handleValidationFailure"
            - "Tests use map-based table-driven pattern with t.Parallel()"
    - number: 5
      title: "User Story 3 - Consistent validation across all execution paths"
      purpose: "Schema validation works identically across all autospec commands"
      story_reference: "US-003"
      independent_test: "Run the same invalid artifact through 'autospec run -a', 'autospec specify', and 'autospec prep' and verify identical error handling"
      tasks:
        - id: "T014"
          title: "Verify schema validation in autospec run -a path"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-003"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T013"]
          acceptance_criteria:
            - "Add test case for autospec run -a with invalid spec.yaml"
            - "Verify error message format matches standalone specify command"
            - "Verify validation catches error before plan stage"
        - id: "T015"
          title: "Verify schema validation in autospec prep path"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-003"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T013"]
          acceptance_criteria:
            - "Add test case for autospec prep with invalid plan.yaml"
            - "Verify error message format matches standalone plan command"
            - "Verify validation catches error before tasks stage"
        - id: "T016"
          title: "Add consistency assertion helper for error messages"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T014", "T015"]
          acceptance_criteria:
            - "Helper function compares error message format across entry points"
            - "Ensures consistent error prefix and structure"
            - "Documents expected error format in test comments"
    - number: 6
      title: "Command Template Documentation"
      purpose: "Document retry context handling in command templates"
      tasks:
        - id: "T017"
          title: "Add Retry Context section to internal/commands/autospec.specify.md"
          status: "Completed"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "internal/commands/autospec.specify.md"
          dependencies: ["T016"]
          acceptance_criteria:
            - "Section explains how to detect retry context in $ARGUMENTS"
            - "Documents expected format: 'RETRY X/Y' followed by errors"
            - "Provides guidance on fixing specific schema errors"
        - id: "T018"
          title: "Add Retry Context section to internal/commands/autospec.plan.md"
          status: "Completed"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "internal/commands/autospec.plan.md"
          dependencies: ["T016"]
          acceptance_criteria:
            - "Section explains how to detect retry context in $ARGUMENTS"
            - "Documents expected format: 'RETRY X/Y' followed by errors"
            - "Provides guidance on fixing specific schema errors"
        - id: "T019"
          title: "Add Retry Context section to internal/commands/autospec.tasks.md"
          status: "Completed"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "internal/commands/autospec.tasks.md"
          dependencies: ["T016"]
          acceptance_criteria:
            - "Section explains how to detect retry context in $ARGUMENTS"
            - "Documents expected format: 'RETRY X/Y' followed by errors"
            - "Provides guidance on fixing specific schema errors"
        - id: "T020"
          title: "Update docs/internals.md with retry context specification"
          status: "Completed"
          type: "documentation"
          parallel: false
          story_id: null
          file_path: "docs/internals.md"
          dependencies: ["T017", "T018", "T019"]
          acceptance_criteria:
            - "Documents standardized retry context format specification"
            - "Explains schema validation integration in orchestrator"
            - "References command templates for retry handling guidance"
    - number: 7
      title: "Quality Gates and Final Validation"
      purpose: "Ensure all quality gates pass and implementation is complete"
      tasks:
        - id: "T021"
          title: "Run all quality gates and verify implementation"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "Makefile"
          dependencies: ["T020"]
          acceptance_criteria:
            - "make test passes with all tests green"
            - "make fmt produces no changes"
            - "make lint reports no errors"
            - "make build succeeds"
            - "No regressions in existing tests"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-002"]
        - story_id: "US-002"
          depends_on: ["US-001"]
          blocks: ["US-003"]
        - story_id: "US-003"
          depends_on: ["US-002"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3]
        - phase: 3
          blocks: [4]
        - phase: 4
          blocks: [5]
        - phase: 5
          blocks: [6]
        - phase: 6
          blocks: [7]
parallel_execution:
    - phase: 2
      parallel_groups:
        - tasks: ["T002", "T003", "T004"]
          rationale: "Independent validation wrapper functions for different artifact types"
    - phase: 3
      parallel_groups:
        - tasks: ["T006", "T007", "T008"]
          rationale: "Independent workflow method updates for different stages"
    - phase: 5
      parallel_groups:
        - tasks: ["T014", "T015"]
          rationale: "Independent test verification for different entry points"
    - phase: 6
      parallel_groups:
        - tasks: ["T017", "T018", "T019"]
          rationale: "Independent documentation updates for different command templates"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Foundational + User Story 1 (programmatic schema validation)"
        validation: "Invalid artifacts are rejected before proceeding to next stage; valid artifacts pass through"
    incremental_delivery:
        - milestone: "Schema Validation Ready"
          phases: [1, 2]
          deliverable: "Validation wrapper functions ready for use; can be called directly to validate artifacts"
        - milestone: "MVP Complete"
          phases: [1, 2, 3]
          deliverable: "Orchestrator validates all artifacts against schema before stage transitions"
        - milestone: "Retry Enhancement Complete"
          phases: [1, 2, 3, 4]
          deliverable: "Failed validation triggers intelligent retry with error context"
        - milestone: "Full Feature Complete"
          phases: [1, 2, 3, 4, 5, 6, 7]
          deliverable: "Complete implementation with documentation and quality gates passed"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec dev"
    created: "2025-12-18T03:12:52Z"
    artifact_type: "tasks"
