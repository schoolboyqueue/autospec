_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "dev"
    created: "2025-12-14T09:45:00Z"
    artifact_type: "tasks"
tasks:
    branch: "009-optional-phase-commands"
    created: "2025-12-14"
    spec_path: "specs/009-optional-phase-commands/spec.yaml"
    plan_path: "specs/009-optional-phase-commands/plan.yaml"
summary:
    total_tasks: 18
    total_phases: 5
    parallel_opportunities: 8
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Add phase constants and update PhaseConfig struct foundation"
      tasks:
        - id: "T001"
          title: "Add optional phase constants to executor.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/workflow/executor.go"
          dependencies: []
          acceptance_criteria:
            - "PhaseConstitution constant added with value 'constitution'"
            - "PhaseClarify constant added with value 'clarify'"
            - "PhaseChecklist constant added with value 'checklist'"
            - "PhaseAnalyze constant added with value 'analyze'"
            - "Constants follow existing naming pattern"
    - number: 2
      title: "Foundational"
      purpose: "Update PhaseConfig struct and methods to support optional phases"
      tasks:
        - id: "T002"
          title: "Add optional phase fields to PhaseConfig struct in phase_config.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/workflow/phase_config.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Constitution bool field added to PhaseConfig"
            - "Clarify bool field added to PhaseConfig"
            - "Checklist bool field added to PhaseConfig"
            - "Analyze bool field added to PhaseConfig"
            - "Default values are false for all optional fields"
        - id: "T003"
          title: "Update GetCanonicalOrder to include optional phases in correct order"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/workflow/phase_config.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "Canonical order is: constitution -> specify -> clarify -> plan -> tasks -> checklist -> analyze -> implement"
            - "Optional phases only included when their field is true"
            - "Returned slice maintains correct order regardless of which phases are selected"
        - id: "T004"
          title: "Update HasAnyPhase and Count methods for optional phases"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/workflow/phase_config.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "HasAnyPhase returns true if any optional phase is set"
            - "Count includes optional phases in total count"
            - "Existing core phase logic unchanged"
        - id: "T005"
          title: "Add artifact dependencies for optional phases"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/workflow/phase_config.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "PhaseConstitution requires no artifacts"
            - "PhaseClarify requires spec.yaml"
            - "PhaseChecklist requires spec.yaml"
            - "PhaseAnalyze requires spec.yaml, plan.yaml, tasks.yaml"
            - "GetAllRequiredArtifacts returns correct dependencies for selected optional phases"
        - id: "T006"
          title: "Add unit tests for PhaseConfig optional phase functionality"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/workflow/phase_config_test.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Tests verify canonical order with all phase combinations"
            - "Tests verify artifact dependencies for each optional phase"
            - "Tests verify HasAnyPhase and Count with optional phases"
            - "Tests verify phases execute in canonical order regardless of flag order"
    - number: 3
      title: "User Story 1 - Standalone Optional Commands"
      purpose: "Enable running optional phases directly from CLI"
      story_reference: "US-001"
      independent_test: "Run each standalone command individually and verify it executes the corresponding slash command"
      tasks:
        - id: "T007"
          title: "Add Execute methods for optional phases in workflow.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/workflow/workflow.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "ExecuteConstitution method added with /autospec.constitution command"
            - "ExecuteClarify method added with /autospec.clarify command"
            - "ExecuteChecklist method added with /autospec.checklist command"
            - "ExecuteAnalyze method added with /autospec.analyze command"
            - "All methods support optional prompt argument injection"
            - "Methods use existing ExecutePhase pattern with retry support"
        - id: "T008"
          title: "Create constitution standalone command in constitution.go"
          status: "Pending"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/cli/constitution.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Command registered as 'autospec constitution [prompt]'"
            - "Executes /autospec.constitution slash command"
            - "Optional prompt argument passed to command"
            - "No prerequisite artifacts required"
            - "Uses spec detection for working directory"
        - id: "T009"
          title: "Create clarify standalone command in clarify.go"
          status: "Pending"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/cli/clarify.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Command registered as 'autospec clarify [prompt]'"
            - "Executes /autospec.clarify slash command"
            - "Validates spec.yaml exists before execution"
            - "Optional prompt argument passed to command"
            - "Displays error exit code 4 if spec.yaml missing"
        - id: "T010"
          title: "Create checklist standalone command in checklist.go"
          status: "Pending"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/cli/checklist.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Command registered as 'autospec checklist [prompt]'"
            - "Executes /autospec.checklist slash command"
            - "Validates spec.yaml exists before execution"
            - "Optional prompt argument passed to command"
            - "Displays error exit code 4 if spec.yaml missing"
        - id: "T011"
          title: "Create analyze standalone command in analyze.go"
          status: "Pending"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/cli/analyze.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Command registered as 'autospec analyze [prompt]'"
            - "Executes /autospec.analyze slash command"
            - "Validates spec.yaml, plan.yaml, tasks.yaml exist before execution"
            - "Optional prompt argument passed to command"
            - "Displays error exit code 4 listing which artifacts are missing"
    - number: 4
      title: "User Story 2 - Run Command Integration"
      purpose: "Enable optional phases in autospec run workflows"
      story_reference: "US-002"
      independent_test: "Use run command with optional phase flags and verify phases execute in correct order"
      tasks:
        - id: "T012"
          title: "Move -r flag from max-retries to clarify, make max-retries long-only"
          status: "Pending"
          type: "refactor"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cli/run.go"
          dependencies: ["T011"]
          acceptance_criteria:
            - "-r short flag removed from max-retries"
            - "--max-retries long flag still works"
            - "Help text updated to reflect change"
            - "Breaking change documented in CLAUDE.md"
        - id: "T013"
          title: "Add optional phase flags to run command"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cli/run.go"
          dependencies: ["T012"]
          acceptance_criteria:
            - "-c/--checklist flag added and recognized"
            - "-z/--analyze flag added and recognized"
            - "-r/--clarify flag added and recognized"
            - "-n/--constitution flag added and recognized"
            - "Flags populate PhaseConfig optional fields"
            - "Help text describes each optional phase flag"
        - id: "T014"
          title: "Update executePhases to handle optional phases in canonical order"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cli/run.go"
          dependencies: ["T013"]
          acceptance_criteria:
            - "executePhases iterates through canonical order including optional phases"
            - "Optional phases execute at correct position in workflow"
            - "Artifact dependency checking validates prerequisites for optional phases"
            - "Phase execution output shows full resolved command"
    - number: 5
      title: "User Story 3 - Canonical Order and Documentation"
      purpose: "Ensure correct execution order and complete documentation"
      story_reference: "US-003"
      independent_test: "Run a workflow with all phases and verify execution order matches canonical order"
      tasks:
        - id: "T015"
          title: "Add integration tests for run command with optional phase flags"
          status: "Pending"
          type: "test"
          parallel: true
          story_id: "US-003"
          file_path: "internal/cli/run_test.go"
          dependencies: ["T014"]
          acceptance_criteria:
            - "Tests verify -c flag includes checklist phase"
            - "Tests verify -z flag includes analyze phase"
            - "Tests verify -r flag includes clarify phase"
            - "Tests verify -n flag includes constitution phase"
            - "Tests verify combined flags execute in canonical order"
            - "Tests verify -a with optional flags works correctly"
        - id: "T016"
          title: "Add canonical order verification tests"
          status: "Pending"
          type: "test"
          parallel: true
          story_id: "US-003"
          file_path: "internal/workflow/phase_config_test.go"
          dependencies: ["T014"]
          acceptance_criteria:
            - "Test '-icts' executes as: specify, tasks, checklist, implement"
            - "Test '-ns' executes as: constitution, specify"
            - "Test '-srp' executes as: specify, clarify, plan"
            - "Test '-tczi' executes as: tasks, checklist, analyze, implement"
            - "All tests verify order regardless of flag order"
        - id: "T017"
          title: "Update CLAUDE.md with new commands and flags"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: "US-003"
          file_path: "CLAUDE.md"
          dependencies: ["T014"]
          acceptance_criteria:
            - "Standalone commands documented: checklist, analyze, clarify, constitution"
            - "Run command flags documented: -c, -z, -r, -n"
            - "Canonical order documented"
            - "Breaking change for -r flag documented"
            - "Example usage for optional phases included"
        - id: "T018"
          title: "Update README.md with optional phase usage examples"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: "US-003"
          file_path: "README.md"
          dependencies: ["T014"]
          acceptance_criteria:
            - "Quick start examples updated if applicable"
            - "Optional phase commands listed in CLI reference"
            - "Workflow examples with optional phases included"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-002"]
        - story_id: "US-002"
          depends_on: ["US-001"]
          blocks: ["US-003"]
        - story_id: "US-003"
          depends_on: ["US-002"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3]
        - phase: 3
          blocks: [4]
        - phase: 4
          blocks: [5]
parallel_execution:
    - phase: 3
      parallel_groups:
        - tasks: ["T008", "T009", "T010", "T011"]
          rationale: "Standalone commands are independent files with no shared dependencies"
    - phase: 5
      parallel_groups:
        - tasks: ["T015", "T016"]
          rationale: "Test files target different test categories"
        - tasks: ["T017", "T018"]
          rationale: "Documentation files are independent"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Foundational + Standalone Commands - enables basic optional phase usage"
        validation: "Run 'autospec checklist', 'autospec analyze', 'autospec clarify', 'autospec constitution' standalone"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "PhaseConfig supports optional phases with correct canonical ordering"
        - milestone: "Standalone Commands"
          phases: [1, 2, 3]
          deliverable: "All four optional commands usable standalone"
        - milestone: "Full Integration"
          phases: [1, 2, 3, 4]
          deliverable: "Optional phases available via run command flags"
        - milestone: "Complete Feature"
          phases: [1, 2, 3, 4, 5]
          deliverable: "Full documentation and test coverage"
