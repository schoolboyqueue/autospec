plan:
  branch: "072-update-check-cmd"
  created: "2025-12-21"
  spec_path: "specs/072-update-check-cmd/spec.yaml"

summary: |
  Implement a dedicated update check command (`autospec ck`) that separates update availability
  checking from version display. The implementation reuses the existing `update.Checker`
  infrastructure while removing the async update check from the version command. This provides
  users with a fast, deterministic version command and an explicit command for checking updates.

  The approach follows existing CLI patterns in `internal/cli/util/`, creating a new `check.go`
  file alongside `update.go` and `version.go`. The new command will be minimalistic (2-letter: `ck`)
  per the user's request while remaining discoverable via `--help`.

technical_context:
  language: "Go"
  framework: "Cobra CLI"
  primary_dependencies:
    - name: "github.com/spf13/cobra"
      version: "v1.8.1"
      purpose: "CLI command framework"
    - name: "github.com/fatih/color"
      version: "v1.18.0"
      purpose: "Terminal color output"
  storage: "None"
  testing:
    framework: "testing (stdlib)"
    approach: "Unit tests with map-based table-driven pattern; mock HTTP responses for update checker"
  target_platform: "Linux, macOS (Intel/Apple Silicon)"
  project_type: "cli"
  performance_goals: "Update check completes or times out within 5 seconds"
  constraints:
    - "Must not break existing 'autospec update' command behavior"
    - "Must maintain backward compatibility for scripts using 'autospec version --plain'"
    - "Must work on all supported platforms"
  scale_scope: "Single CLI command addition with minor modification to existing command"

constitution_check:
  constitution_path: ".autospec/memory/constitution.yaml"
  gates:
    - name: "Test-First Development (PRIN-001)"
      status: "PASS"
      notes: "Tests will be written before implementation; table-driven pattern required"
    - name: "Validation-First Workflow (PRIN-002)"
      status: "N/A"
      notes: "No workflow artifact transitions involved"
    - name: "Performance Standards (PRIN-003)"
      status: "PASS"
      notes: "5-second timeout for network operations; instant version command"
    - name: "Idempotency and Retry Logic (PRIN-004)"
      status: "N/A"
      notes: "Read-only check operation, no state mutations"
    - name: "Standardized Exit Codes (PRIN-005)"
      status: "PASS"
      notes: "Will use exit 0 for success, 1 for network errors"
    - name: "YAML-First Artifacts (PRIN-006)"
      status: "N/A"
      notes: "No artifact generation in this feature"
    - name: "Code Formatting (PRIN-007)"
      status: "PASS"
      notes: "Code will pass go fmt and go vet"
    - name: "Go Coding Standards (PRIN-011)"
      status: "PASS"
      notes: "Functions <40 lines, errors wrapped with context, table-driven tests"
    - name: "Command Template Independence (PRIN-012)"
      status: "N/A"
      notes: "No command templates modified"
    - name: "Cross-Platform Compatibility (PRIN-008)"
      status: "PASS"
      notes: "Uses existing cross-platform update.Checker"

research_findings:
  decisions:
    - topic: "Command name selection"
      decision: "Use 'ck' as the command name with 'check' as an alias"
      rationale: "Meets user request for minimalistic name (2 chars); 'check' alias aids discoverability"
      alternatives_considered:
        - "'chk' - 3 chars, slightly longer"
        - "'c' - 1 char, too ambiguous (could mean 'config', 'clean', 'clarify')"
        - "'up' - 2 chars, could be confused with 'update'"
    - topic: "Reuse vs. new implementation"
      decision: "Reuse existing update.Checker infrastructure"
      rationale: "Checker already handles GitHub API, version parsing, and error cases; DRY principle"
      alternatives_considered:
        - "New standalone checker - would duplicate version parsing and HTTP logic"
    - topic: "Version command modification approach"
      decision: "Remove async update check entirely from version command"
      rationale: "Clean separation of concerns; version becomes pure local operation"
      alternatives_considered:
        - "Keep async but suppress output - still has network latency, confusing"

data_model:
  entities:
    - name: "CheckResult"
      description: "Result of update availability check (uses existing update.UpdateCheck)"
      fields:
        - name: "CurrentVersion"
          type: "string"
          description: "Currently installed version"
          constraints: "Non-empty"
        - name: "LatestVersion"
          type: "string"
          description: "Latest available version from GitHub"
          constraints: "Non-empty when update available"
        - name: "UpdateAvailable"
          type: "bool"
          description: "Whether a newer version exists"
          constraints: "None"
      relationships: []

api_contracts:
  endpoints: []

project_structure:
  documentation:
    - path: "docs/reference.md"
      description: "Update CLI reference to include new 'ck' command"
  source_code:
    - path: "internal/cli/util/check.go"
      description: "New update check command implementation"
    - path: "internal/cli/util/version.go"
      description: "Modified to remove async update check"
    - path: "internal/cli/util/register.go"
      description: "Register the new ck command"
  tests:
    - path: "internal/cli/util/check_test.go"
      description: "Unit tests for check command"
    - path: "internal/cli/util/version_test.go"
      description: "Updated tests verifying no network calls"

implementation_phases:
  - phase: 1
    name: "Test Infrastructure Setup"
    goal: "Create test file and define test cases for the new check command"
    deliverables:
      - "check_test.go with table-driven test cases"
      - "Test cases covering: update available, already latest, dev build, network errors"
  - phase: 2
    name: "Check Command Implementation"
    goal: "Implement the ck command that checks for updates"
    dependencies:
      - "Phase 1"
    deliverables:
      - "check.go with ck command implementation"
      - "Reuse update.Checker for GitHub API calls"
      - "Pretty and plain output formats"
      - "Dev build handling"
  - phase: 3
    name: "Version Command Modification"
    goal: "Remove async update check from version command"
    dependencies:
      - "Phase 1"
    deliverables:
      - "Modified version.go without startAsyncUpdateCheck"
      - "Remove displayUpdateNotification function"
      - "Updated version_test.go verifying no network calls"
  - phase: 4
    name: "Registration and Quality Gates"
    goal: "Register command and ensure all quality gates pass"
    dependencies:
      - "Phase 2"
      - "Phase 3"
    deliverables:
      - "Updated register.go with ckCmd"
      - "All tests passing (make test)"
      - "Code formatted (make fmt)"
      - "Linting clean (make lint)"
      - "Build succeeds (make build)"

risks:
  - risk: "Breaking scripts that parse version output for update info"
    likelihood: "low"
    impact: "low"
    mitigation: "Version output format unchanged; only hidden async check removed"
  - risk: "Users unaware of new ck command"
    likelihood: "medium"
    impact: "low"
    mitigation: "Add 'check' alias for discoverability; document in --help"

open_questions:
  - question: "Should the check command support --json output for CI/CD?"
    context: "Scripted update checks might benefit from machine-readable output"
    proposed_resolution: "Not in initial scope; can be added later if needed"

_meta:
  version: "1.0.0"
  generator: "autospec"
  generator_version: "autospec dev"
  created: "2025-12-21T22:25:40Z"
  artifact_type: "plan"
