tasks:
    branch: "027-claude-settings-validation"
    created: "2025-12-16"
    spec_path: "specs/027-claude-settings-validation/spec.yaml"
    plan_path: "specs/027-claude-settings-validation/plan.yaml"
summary:
    total_tasks: 15
    total_phases: 6
    parallel_opportunities: 5
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Create new internal/claude package structure"
      tasks:
        - id: "T001"
          title: "Create internal/claude package directory"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/claude/"
          dependencies: []
          acceptance_criteria:
            - "internal/claude/ directory exists"
            - "Package can be imported by other internal packages"
    - number: 2
      title: "Foundational"
      purpose: "Core settings package with load/save/check functionality"
      tasks:
        - id: "T002"
          title: "Implement settings.go core types and Load function"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/claude/settings.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "SettingsStatus enum with Configured, Missing, NeedsPermission, Denied values"
            - "SettingsCheckResult struct with Status, Message, FilePath fields"
            - "Load() function reads and parses .claude/settings.local.json"
            - "Uses map[string]interface{} for flexible JSON structure"
            - "Handles missing file gracefully"
            - "Error messages include file path context"
        - id: "T003"
          title: "Implement HasPermission, CheckDenyList, and Check functions"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/claude/settings.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "HasPermission(perm string) checks if permission exists in allow list"
            - "CheckDenyList(perm string) checks if permission is explicitly denied"
            - "Check() returns SettingsCheckResult with appropriate status"
            - "All functions <40 lines per PRIN-011"
        - id: "T004"
          title: "Implement AddPermission and Save functions with atomic writes"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/claude/settings.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "AddPermission(perm string) adds permission to allow list"
            - "Save() writes settings with atomic temp file + rename pattern"
            - "Written JSON is pretty-printed with indentation"
            - "Preserves all existing settings fields"
            - "Handles missing .claude/ directory by creating it"
        - id: "T005"
          title: "Implement settings_test.go unit tests"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/claude/settings_test.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Map-based table-driven tests per PRIN-011"
            - "Tests use t.Parallel() where safe"
            - "Test cases for: missing file, empty file, malformed JSON"
            - "Test cases for: permission in allow, permission in deny, permission missing"
            - "Test cases for: preserving existing settings during modifications"
            - "Test atomic write behavior"
    - number: 3
      title: "User Story 1 - Automatic Claude Code permissions configuration during init"
      purpose: "Configure Claude Code permissions when running autospec init"
      story_reference: "US-001"
      independent_test: "Run autospec init in a project without Claude settings and verify .claude/settings.local.json is created with correct permissions"
      tasks:
        - id: "T006"
          title: "Implement configureClaudeSettings helper in init.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/init.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "configureClaudeSettings() function orchestrates settings configuration"
            - "Loads existing settings or creates new settings"
            - "Checks deny list before adding permission"
            - "Outputs appropriate status messages for all scenarios"
            - "Messages match spec: Created, Added, Already configured, Warning for deny conflict"
            - "Function <40 lines, extracts helpers as needed"
        - id: "T007"
          title: "Integrate configureClaudeSettings into init command flow"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/init.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Claude settings configuration runs as part of init workflow"
            - "Configuration happens after directory structure setup"
            - "Errors in Claude settings do not block init completion (warn only)"
            - "Status line follows existing init output format"
        - id: "T008"
          title: "Add init command tests for Claude settings integration"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/init_test.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Test init creates settings.local.json when missing"
            - "Test init adds permission to existing settings"
            - "Test init skips when permission already present"
            - "Test init warns when permission is denied"
            - "Tests use temp directories and t.Parallel()"
    - number: 4
      title: "User Story 2 - Claude settings validation in doctor command"
      purpose: "Add Claude settings check to autospec doctor health checks"
      story_reference: "US-002"
      independent_test: "Run autospec doctor with various Claude settings states and verify appropriate pass/fail messages"
      tasks:
        - id: "T009"
          title: "Implement CheckClaudeSettings in health.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-002"
          file_path: "internal/health/health.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "CheckClaudeSettings() returns health check result"
            - "Reports failure if settings file missing"
            - "Reports failure if permission missing from allow list"
            - "Reports success if permission configured"
            - "Messages match spec format with checkmarks/x marks"
        - id: "T010"
          title: "Integrate CheckClaudeSettings into RunHealthChecks"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/health/health.go"
          dependencies: ["T009"]
          acceptance_criteria:
            - "Claude settings check included in health check aggregation"
            - "Check runs alongside existing health checks"
            - "Failed Claude check contributes to overall doctor exit code"
        - id: "T011"
          title: "Add health check tests for Claude settings"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-002"
          file_path: "internal/health/health_test.go"
          dependencies: ["T010"]
          acceptance_criteria:
            - "Test health check passes with correct settings"
            - "Test health check fails with missing file"
            - "Test health check fails with missing permission"
            - "Map-based table-driven tests"
    - number: 5
      title: "User Story 3 - Respect user's explicit deny rules"
      purpose: "Warn but not override explicitly denied permissions"
      story_reference: "US-003"
      independent_test: "Add Bash(autospec:*) to deny list, run autospec init, verify warning is shown and deny list unchanged"
      tasks:
        - id: "T012"
          title: "Implement deny list conflict detection in settings.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-003"
          file_path: "internal/claude/settings.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "CheckDenyList returns true if permission in deny list"
            - "Check() returns Denied status when permission in deny list"
            - "Message includes specific file path and permission name"
        - id: "T013"
          title: "Add deny list handling to init and doctor commands"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/cli/init.go"
          dependencies: ["T012", "T007", "T010"]
          acceptance_criteria:
            - "init warns when permission is denied, does not modify file"
            - "doctor reports deny conflict with resolution instructions"
            - "Warning messages match spec format"
        - id: "T014"
          title: "Add tests for deny list scenarios"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-003"
          file_path: "internal/claude/settings_test.go"
          dependencies: ["T013"]
          acceptance_criteria:
            - "Test CheckDenyList returns true when permission denied"
            - "Test Check returns Denied status appropriately"
            - "Test init does not modify file when permission denied"
            - "Test doctor reports deny conflict"
    - number: 6
      title: "Polish & Cross-Cutting Concerns"
      purpose: "Final validation, edge case handling, and code quality"
      tasks:
        - id: "T015"
          title: "Final validation and lint pass"
          status: "Completed"
          type: "refactor"
          parallel: false
          story_id: null
          file_path: "internal/claude/"
          dependencies: ["T005", "T008", "T011", "T014"]
          acceptance_criteria:
            - "All tests pass with go test ./..."
            - "make lint passes without errors"
            - "make fmt produces no changes"
            - "Edge cases handled: malformed JSON, read-only file, disk full"
            - "Error messages wrapped with context per PRIN-011"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: []
        - story_id: "US-002"
          depends_on: []
          blocks: []
        - story_id: "US-003"
          depends_on: ["US-001", "US-002"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3, 4, 5]
        - phase: 3
          blocks: [6]
        - phase: 4
          blocks: [6]
        - phase: 5
          blocks: [6]
parallel_execution:
    - phase: 3
      parallel_groups:
        - tasks: ["T009"]
          rationale: "US-002 health check can start in parallel with US-001 init integration once foundational tasks complete"
    - phase: 5
      parallel_groups:
        - tasks: ["T012"]
          rationale: "Deny list detection can be implemented in parallel with other story work"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Foundational + Init Integration (US-001)"
        validation: "Run autospec init and verify .claude/settings.local.json created with Bash(autospec:*) permission"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "Claude settings package with load/save/check functionality"
        - milestone: "Init Integration Complete"
          phases: [1, 2, 3]
          deliverable: "autospec init configures Claude Code permissions automatically"
        - milestone: "Doctor Integration Complete"
          phases: [1, 2, 3, 4]
          deliverable: "autospec doctor validates Claude settings configuration"
        - milestone: "Full Feature Complete"
          phases: [1, 2, 3, 4, 5, 6]
          deliverable: "Complete Claude settings validation with deny list handling"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec dev"
    created: "2025-12-16T19:22:55Z"
    artifact_type: "tasks"
