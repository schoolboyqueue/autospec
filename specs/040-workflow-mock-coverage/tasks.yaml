tasks:
    branch: "040-workflow-mock-coverage"
    created: "2025-12-18"
    spec_path: "specs/040-workflow-mock-coverage/spec.yaml"
    plan_path: "specs/040-workflow-mock-coverage/plan.yaml"
summary:
    total_tasks: 14
    total_phases: 5
    parallel_opportunities: 6
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Verify test environment and existing mock infrastructure"
      tasks:
        - id: "T001"
          title: "Verify mock-claude.sh supports artifact generation via MOCK_RESPONSE_FILE"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "mocks/scripts/mock-claude.sh"
          dependencies: []
          acceptance_criteria:
            - "mock-claude.sh exists and is executable"
            - "Script supports MOCK_RESPONSE_FILE environment variable for output content"
            - "Script logs calls to MOCK_CALL_LOG when set"
            - "Script respects MOCK_EXIT_CODE for error simulation"
    - number: 2
      title: "Foundational"
      purpose: "Enhance MockExecutorBuilder to support WorkflowOrchestrator integration"
      tasks:
        - id: "T002"
          title: "Add WithArtifactDir method to MockExecutorBuilder in internal/testutil/mock_executor.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/testutil/mock_executor.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "MockExecutorBuilder has WithArtifactDir(dir string) method"
            - "Artifact directory is used when generating responses"
            - "Method returns *MockExecutorBuilder for fluent chaining"
        - id: "T003"
          title: "Add helper to create test WorkflowOrchestrator with mock ClaudeCmd in internal/testutil/mock_executor.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/testutil/mock_executor.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "NewTestOrchestrator(t *testing.T, specsDir string) function exists"
            - "Configures ClaudeCmd to use mock-claude.sh path"
            - "Sets up isolated config pointing to test specsDir"
            - "Returns *WorkflowOrchestrator ready for testing"
        - id: "T004"
          title: "Create valid mock artifact fixture files in mocks/fixtures/"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "mocks/fixtures/"
          dependencies: ["T001"]
          acceptance_criteria:
            - "mocks/fixtures/valid-spec.yaml contains minimal valid spec"
            - "mocks/fixtures/valid-plan.yaml contains minimal valid plan"
            - "mocks/fixtures/valid-tasks.yaml contains minimal valid tasks"
            - "All fixtures pass autospec artifact validation"
    - number: 3
      title: "User Story 1 - Test Execute* Methods with Artifact-Generating Mocks"
      purpose: "Achieve coverage for all Execute* methods in workflow.go"
      story_reference: "US-001"
      independent_test: "Run go test -cover ./internal/workflow/ and verify coverage >= 85%"
      tasks:
        - id: "T005"
          title: "Add TestExecuteSpecify_Success in internal/workflow/workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T002", "T003", "T004"]
          acceptance_criteria:
            - "Test uses NewTestOrchestrator with isolated t.TempDir()"
            - "Mock is configured to generate valid spec.yaml"
            - "Test calls orchestrator.ExecuteSpecify(featureDescription)"
            - "Test verifies spec.yaml is created in expected location"
            - "Test uses map-based table-driven pattern if multiple cases"
        - id: "T006"
          title: "Add TestExecutePlan_Success in internal/workflow/workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-001"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Test uses NewTestOrchestrator with isolated t.TempDir()"
            - "Test sets up prerequisite spec.yaml in temp dir"
            - "Mock is configured to generate valid plan.yaml"
            - "Test calls orchestrator.ExecutePlan(specName, prompt)"
            - "Test verifies plan.yaml is created in expected location"
        - id: "T007"
          title: "Add TestExecuteTasks_Success in internal/workflow/workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-001"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Test uses NewTestOrchestrator with isolated t.TempDir()"
            - "Test sets up prerequisite spec.yaml and plan.yaml"
            - "Mock is configured to generate valid tasks.yaml"
            - "Test calls orchestrator.ExecuteTasks(specName, prompt)"
            - "Test verifies tasks.yaml is created in expected location"
        - id: "T008"
          title: "Add TestExecuteImplement_Success in internal/workflow/workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-001"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Test uses NewTestOrchestrator with isolated t.TempDir()"
            - "Test sets up all prerequisite artifacts (spec, plan, tasks)"
            - "Mock is configured to simulate implementation completion"
            - "Test calls orchestrator.ExecuteImplement with options"
            - "Test verifies implementation completes without error"
    - number: 4
      title: "User Story 2 - Test Full Workflow Orchestration"
      purpose: "Cover RunCompleteWorkflow and RunFullWorkflow end-to-end"
      story_reference: "US-002"
      independent_test: "Run tests for RunCompleteWorkflow and RunFullWorkflow, verify they execute all stages"
      tasks:
        - id: "T009"
          title: "Add TestRunCompleteWorkflow_Success in internal/workflow/workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-002"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T005", "T006", "T007"]
          acceptance_criteria:
            - "Test uses NewTestOrchestrator with isolated t.TempDir()"
            - "Mock is configured with sequential responses for specify, plan, tasks stages"
            - "Test calls orchestrator.RunCompleteWorkflow(featureDescription)"
            - "Test verifies all three artifacts are created in sequence"
            - "Test verifies correct stage order execution"
        - id: "T010"
          title: "Add TestRunFullWorkflow_Success in internal/workflow/workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-002"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T009"]
          acceptance_criteria:
            - "Test uses NewTestOrchestrator with isolated t.TempDir()"
            - "Mock is configured with responses for all four stages including implement"
            - "Test calls orchestrator.RunFullWorkflow(featureDescription, resume=false)"
            - "Test verifies all stages execute including implementation"
            - "Test verifies artifacts are created in correct order"
    - number: 5
      title: "User Story 3 - Test Workflow Error Handling Paths"
      purpose: "Cover error handling and retry behavior for increased coverage"
      story_reference: "US-003"
      independent_test: "Run tests with mock errors configured, verify correct error messages"
      tasks:
        - id: "T011"
          title: "Add TestExecuteSpecify_ValidationFailure in internal/workflow/workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-003"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Test uses NewTestOrchestrator with isolated t.TempDir()"
            - "Mock is configured to generate invalid spec.yaml"
            - "Test calls orchestrator.ExecuteSpecify(featureDescription)"
            - "Test verifies validation error is returned with context"
            - "Test uses MOCK_EXIT_CODE or invalid response content"
        - id: "T012"
          title: "Add TestExecuteWithRetry_RetriesOnFailure in internal/workflow/workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-003"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Test uses NewTestOrchestrator with isolated t.TempDir()"
            - "Mock is configured to fail first attempt, succeed on second"
            - "Test exercises retry mechanism through Execute* method"
            - "Test verifies retry count and final success"
        - id: "T013"
          title: "Add TestAuxiliaryExecuteMethods in internal/workflow/workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-003"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Tests cover ExecuteConstitution, ExecuteClarify, ExecuteChecklist, ExecuteAnalyze"
            - "Each method has at least one success test case"
            - "Uses map-based table-driven pattern for multiple methods"
            - "All tests use isolated t.TempDir()"
        - id: "T014"
          title: "Verify coverage target and run quality gates"
          status: "Completed"
          type: "documentation"
          parallel: false
          story_id: null
          file_path: "internal/workflow/"
          dependencies: ["T009", "T010", "T011", "T012", "T013"]
          acceptance_criteria:
            - "go test -cover ./internal/workflow/ reports >= 85%"
            - "make test passes with exit code 0"
            - "make fmt shows no formatting changes"
            - "make lint passes with no errors"
            - "make build completes successfully"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-002"]
        - story_id: "US-002"
          depends_on: ["US-001"]
          blocks: ["US-003"]
        - story_id: "US-003"
          depends_on: ["US-002"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3]
        - phase: 3
          blocks: [4]
        - phase: 4
          blocks: [5]
parallel_execution:
    - phase: 2
      parallel_groups:
        - tasks: ["T002", "T003", "T004"]
          rationale: "Independent infrastructure enhancements with no shared dependencies"
    - phase: 3
      parallel_groups:
        - tasks: ["T006", "T007", "T008"]
          rationale: "Each Execute* test is independent after T005 establishes pattern"
    - phase: 5
      parallel_groups:
        - tasks: ["T011", "T012", "T013"]
          rationale: "Error handling tests can run in parallel with isolated temp dirs"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Foundational + Execute* method tests achieves core coverage"
        validation: "Run go test -cover ./internal/workflow/ and verify Execute* methods have >0% coverage"
    incremental_delivery:
        - milestone: "Infrastructure Ready"
          phases: [1, 2]
          deliverable: "MockExecutorBuilder enhanced with artifact support; test helpers ready"
        - milestone: "Execute* Coverage"
          phases: [1, 2, 3]
          deliverable: "All Execute* methods have test coverage; individual stage testing works"
        - milestone: "Full Workflow Coverage"
          phases: [1, 2, 3, 4]
          deliverable: "RunCompleteWorkflow and RunFullWorkflow have test coverage"
        - milestone: "85%+ Coverage"
          phases: [1, 2, 3, 4, 5]
          deliverable: "Workflow package achieves 85%+ coverage with error path tests"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec dev"
    created: "2025-12-18T02:55:48Z"
    artifact_type: "tasks"
