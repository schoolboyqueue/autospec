tasks:
    branch: "036-history-immediate-logging"
    created: "2025-12-17"
    spec_path: "specs/036-history-immediate-logging/spec.yaml"
    plan_path: "specs/036-history-immediate-logging/plan.yaml"
summary:
    total_tasks: 18
    total_phases: 6
    parallel_opportunities: 5
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Project initialization and verify existing history infrastructure"
      tasks:
        - id: "T001"
          title: "Verify existing history infrastructure in internal/history/"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/history/"
          dependencies: []
          acceptance_criteria:
            - "Understand existing HistoryEntry struct in internal/history/history.go"
            - "Understand existing Writer interface and implementation"
            - "Identify integration points for new fields"
    - number: 2
      title: "Foundational"
      purpose: "Core infrastructure that MUST be complete before user stories"
      tasks:
        - id: "T002"
          title: "Extend HistoryEntry struct with new fields in internal/history/history.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/history/history.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Add ID field (string, omitempty) for unique identifier"
            - "Add Status field (string, omitempty) for running/completed/failed/cancelled"
            - "Add CreatedAt field (time.Time, omitempty) for explicit start time"
            - "Add CompletedAt field (*time.Time, omitempty) for nullable completion time"
            - "YAML tags use omitempty for backward compatibility"
            - "Existing fields (Timestamp, Command, Spec, ExitCode, Duration) preserved"
        - id: "T003"
          title: "Create ID generator with word lists in internal/history/idgen.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/history/idgen.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Define ~50 adjectives slice (brave, calm, swift, etc.)"
            - "Define ~50 nouns slice (fox, river, falcon, etc.)"
            - "GenerateID() function returns adjective_noun_YYYYMMDD_HHMMSS format"
            - "Uses crypto/rand for word selection to prevent collisions"
            - "Functions under 40 lines per coding standards"
        - id: "T004"
          title: "Write tests for ID generation in internal/history/idgen_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: null
          file_path: "internal/history/idgen_test.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "Map-based table-driven tests with t.Parallel()"
            - "Test ID format matches adjective_noun_YYYYMMDD_HHMMSS pattern"
            - "Test uniqueness across multiple rapid generations"
            - "Test all words in lists are lowercase alphanumeric"
        - id: "T005"
          title: "Write tests for enhanced HistoryEntry in internal/history/history_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: null
          file_path: "internal/history/history_test.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "Map-based table-driven tests with t.Parallel()"
            - "Test YAML serialization of new fields"
            - "Test backward compatibility: old entries without new fields load correctly"
            - "Test new entries serialize with all fields"
    - number: 3
      title: "User Story 1 - Track running commands in history"
      purpose: "History entries written immediately when commands start with 'running' status"
      story_reference: "US-001"
      independent_test: "Start a command and verify history entry exists before completion"
      tasks:
        - id: "T006"
          title: "Implement WriteStart method in internal/history/writer.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/history/writer.go"
          dependencies: ["T002", "T003"]
          acceptance_criteria:
            - "WriteStart(command, spec string) (string, error) method"
            - "Generates unique ID using GenerateID()"
            - "Creates entry with status 'running'"
            - "Sets CreatedAt and Timestamp to current time"
            - "Appends entry to history file immediately"
            - "Returns the generated ID for later update"
            - "Functions under 40 lines, errors wrapped with context"
        - id: "T007"
          title: "Write tests for WriteStart in internal/history/writer_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/history/writer_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Map-based table-driven tests with t.Parallel()"
            - "Test entry is written with 'running' status"
            - "Test entry has valid ID format"
            - "Test entry exists in history file immediately after WriteStart"
            - "Test simulated crash leaves 'running' entry intact"
    - number: 4
      title: "User Story 2 - Complete history entries on command finish"
      purpose: "History entries updated when commands complete with final status and duration"
      story_reference: "US-002"
      independent_test: "Run a command to completion and verify entry is updated with final status"
      tasks:
        - id: "T008"
          title: "Implement UpdateComplete method in internal/history/writer.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/history/writer.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "UpdateComplete(id string, exitCode int, status string, duration time.Duration) error"
            - "Loads history file, finds entry by ID"
            - "Updates Status, ExitCode, Duration, CompletedAt fields"
            - "Saves history file atomically"
            - "Returns error if entry not found"
            - "Functions under 40 lines, errors wrapped with context"
        - id: "T009"
          title: "Write tests for UpdateComplete in internal/history/writer_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-002"
          file_path: "internal/history/writer_test.go"
          dependencies: ["T008"]
          acceptance_criteria:
            - "Map-based table-driven tests with t.Parallel()"
            - "Test entry updated with 'completed' status and exit code 0"
            - "Test entry updated with 'failed' status and non-zero exit code"
            - "Test entry updated with 'cancelled' status"
            - "Test CompletedAt and Duration fields are set"
            - "Test error returned when ID not found"
        - id: "T010"
          title: "Extend HistoryLogger interface in internal/lifecycle/handler.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/lifecycle/handler.go"
          dependencies: ["T006", "T008"]
          acceptance_criteria:
            - "Add WriteStart(command, spec string) (string, error) to interface"
            - "Add UpdateComplete(id string, exitCode int, status string, duration time.Duration) error"
            - "Existing LogCommand method preserved for backward compatibility"
        - id: "T011"
          title: "Modify lifecycle wrappers for two-phase logging in internal/lifecycle/lifecycle.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/lifecycle/lifecycle.go"
          dependencies: ["T010"]
          acceptance_criteria:
            - "RunWithHistory calls WriteStart before fn(), UpdateComplete after"
            - "RunWithHistoryContext uses same two-phase pattern"
            - "Determine status from error/context: completed (nil), failed (error), cancelled (context)"
            - "Calculate duration from start to completion"
            - "Handle panic recovery with 'failed' status"
            - "Functions under 40 lines, errors wrapped with context"
        - id: "T012"
          title: "Write tests for lifecycle two-phase logging in internal/lifecycle/lifecycle_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-002"
          file_path: "internal/lifecycle/lifecycle_test.go"
          dependencies: ["T011"]
          acceptance_criteria:
            - "Map-based table-driven tests with t.Parallel()"
            - "Test successful completion sets 'completed' status"
            - "Test error sets 'failed' status"
            - "Test context cancellation sets 'cancelled' status"
            - "Test panic recovery sets 'failed' status"
            - "Test duration is calculated correctly"
    - number: 5
      title: "User Story 4 - View and filter history by status"
      purpose: "Display status column with colors and support --status filter flag"
      story_reference: "US-004"
      independent_test: "Run commands with different outcomes, then filter history by status"
      tasks:
        - id: "T013"
          title: "Add status column to history output in internal/cli/history.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/cli/history.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "Display ID column in history output"
            - "Display Status column with color coding"
            - "Green for 'completed', Yellow for 'running', Red for 'failed'/'cancelled'"
            - "Old entries without status show '-' or 'unknown'"
            - "Functions under 40 lines"
        - id: "T014"
          title: "Add --status filter flag to history command in internal/cli/history.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/cli/history.go"
          dependencies: ["T013"]
          acceptance_criteria:
            - "Add --status flag accepting: running, completed, failed, cancelled"
            - "Filter history output to show only matching entries"
            - "Empty result for non-existent status (no error)"
            - "Functions under 40 lines"
        - id: "T015"
          title: "Write tests for history status display and filter in internal/cli/history_test.go"
          status: "InProgress"
          type: "test"
          parallel: false
          story_id: "US-004"
          file_path: "internal/cli/history_test.go"
          dependencies: ["T013", "T014"]
          acceptance_criteria:
            - "Map-based table-driven tests with t.Parallel()"
            - "Test status column appears in output"
            - "Test --status flag filters correctly"
            - "Test backward compatibility with old entries"
            - "Test empty result for non-matching filter"
        - id: "T016"
          title: "Update history command documentation in docs/reference.md"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: "US-004"
          file_path: "docs/reference.md"
          dependencies: ["T014"]
          acceptance_criteria:
            - "Document new --status flag with allowed values"
            - "Document ID column in output"
            - "Document Status column and color coding"
            - "Provide usage examples for filtering"
    - number: 6
      title: "Quality Assurance"
      purpose: "Ensure all quality gates pass and feature is production-ready"
      tasks:
        - id: "T017"
          title: "Run all quality gates: make test, make fmt, make lint, make build"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "Makefile"
          dependencies: ["T005", "T007", "T009", "T012", "T015", "T016"]
          acceptance_criteria:
            - "make test passes with 0 failures"
            - "make fmt produces no changes"
            - "make lint reports no errors"
            - "make build succeeds"
        - id: "T018"
          title: "Manual end-to-end testing of immediate logging workflow"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/history/"
          dependencies: ["T017"]
          acceptance_criteria:
            - "Run autospec command, verify 'running' entry appears immediately"
            - "Let command complete, verify entry updated to 'completed'"
            - "Interrupt command with Ctrl+C, verify entry shows 'cancelled'"
            - "Verify history --status running shows only running commands"
            - "Verify history --status failed filters correctly"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-002"]
        - story_id: "US-002"
          depends_on: ["US-001"]
          blocks: ["US-004"]
        - story_id: "US-003"
          depends_on: []
          blocks: []
          notes: "ID generation handled in Foundational phase as infrastructure"
        - story_id: "US-004"
          depends_on: ["US-002"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3, 4, 5]
        - phase: 3
          blocks: [4]
        - phase: 4
          blocks: [5]
        - phase: 5
          blocks: [6]
parallel_execution:
    - phase: 2
      parallel_groups:
        - tasks: ["T003", "T002"]
          rationale: "HistoryEntry struct and idgen.go can be developed independently"
        - tasks: ["T004", "T005"]
          rationale: "Test files for different components, no dependencies"
    - phase: 5
      parallel_groups:
        - tasks: ["T016"]
          rationale: "Documentation can be written while tests are being developed"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3, 4]
        description: "Setup + Foundational + US-001 (Track running) + US-002 (Complete entries)"
        validation: "Commands create 'running' entries immediately and update on completion"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "Enhanced HistoryEntry struct with ID generation capability"
        - milestone: "Core Logging Complete"
          phases: [1, 2, 3, 4]
          deliverable: "Two-phase logging working: entries created on start, updated on complete"
        - milestone: "Full Feature Complete"
          phases: [1, 2, 3, 4, 5, 6]
          deliverable: "Complete feature with status display, filtering, and quality gates passed"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec dev"
    created: "2025-12-17T02:23:24Z"
    artifact_type: "tasks"
