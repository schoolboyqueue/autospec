tasks:
    branch: "032-lifecycle-wrapper"
    created: "2025-12-16"
    spec_path: "specs/032-lifecycle-wrapper/spec.yaml"
    plan_path: "specs/032-lifecycle-wrapper/plan.yaml"
summary:
    total_tasks: 21
    total_phases: 7
    parallel_opportunities: 13
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Create internal/lifecycle package structure"
      tasks:
        - id: "T001"
          title: "Create internal/lifecycle package directory and handler.go interface"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/lifecycle/handler.go"
          dependencies: []
          acceptance_criteria:
            - "internal/lifecycle directory exists"
            - "handler.go defines NotificationHandler interface with OnCommandComplete and OnStageComplete methods"
            - "Interface is minimal to avoid circular imports with notify package"
    - number: 2
      title: "Foundational"
      purpose: "Core lifecycle wrapper functions that MUST be complete before user story implementation"
      tasks:
        - id: "T002"
          title: "Implement lifecycle.Run() function in internal/lifecycle/lifecycle.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/lifecycle/lifecycle.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Run(handler, name, fn) captures start time, executes fn, calculates duration"
            - "Calls handler.OnCommandComplete(name, success, duration) after fn completes"
            - "Returns fn's error unchanged"
            - "Nil handler is safe (no-op, no panic)"
            - "Handler panics are recovered; fn's error still returned"
            - "Function under 40 lines"
        - id: "T003"
          title: "Implement lifecycle.RunWithContext() function in internal/lifecycle/lifecycle.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/lifecycle/lifecycle.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "RunWithContext(ctx, handler, name, fn) checks context before executing fn"
            - "If context already cancelled, returns context.Canceled without calling fn"
            - "Notification sent with success=false on cancellation"
            - "Passes context to fn if fn accepts it"
            - "Function under 40 lines"
        - id: "T004"
          title: "Implement lifecycle.RunStage() function in internal/lifecycle/lifecycle.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/lifecycle/lifecycle.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "RunStage(handler, name, fn) executes fn and calls handler.OnStageComplete(name, success)"
            - "Nil handler is safe (no-op)"
            - "Handler panics are recovered"
            - "Function under 40 lines"
        - id: "T005"
          title: "Create unit tests for lifecycle functions in internal/lifecycle/lifecycle_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/lifecycle/lifecycle_test.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Tests use map-based table-driven pattern with t.Parallel()"
            - "Test Run() success and failure cases"
            - "Test Run() with nil handler"
            - "Test Run() with panicking handler (verify recovery)"
            - "Test RunWithContext() with valid context"
            - "Test RunWithContext() with cancelled context"
            - "Test RunStage() success and failure cases"
            - "All tests pass"
        - id: "T006"
          title: "Create benchmark tests for lifecycle overhead in internal/lifecycle/lifecycle_bench_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: null
          file_path: "internal/lifecycle/lifecycle_bench_test.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "BenchmarkRun verifies overhead under 1ms"
            - "BenchmarkRunWithContext verifies overhead under 1ms"
            - "BenchmarkRunStage verifies overhead under 1ms"
            - "Benchmarks report allocations"
    - number: 3
      title: "User Story 1 - Command lifecycle automation"
      purpose: "Migrate first command (specify) to validate lifecycle wrapper pattern works"
      story_reference: "US-001"
      independent_test: "Run specify command and verify notification fires without manual notification code in specify.go"
      tasks:
        - id: "T007"
          title: "Migrate specify.go to use lifecycle.Run() wrapper"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/specify.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Replace notification boilerplate with lifecycle.Run() call"
            - "Remove direct notify.NewHandler, SetStartTime, OnCommandComplete calls"
            - "Command behavior unchanged"
            - "Notification still fires on completion"
            - "Net reduction of 6-8 lines"
    - number: 4
      title: "User Story 2 - Consistent notification behavior (remaining commands)"
      purpose: "Migrate all remaining workflow commands to lifecycle wrapper for consistent UX"
      story_reference: "US-002"
      independent_test: "Run each of the 11 commands and verify notification fires on completion"
      tasks:
        - id: "T008"
          title: "Migrate plan.go to use lifecycle.Run() wrapper"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-002"
          file_path: "internal/cli/plan.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Replace notification boilerplate with lifecycle.Run() call"
            - "Command behavior unchanged; notification fires on completion"
        - id: "T009"
          title: "Migrate tasks.go to use lifecycle.Run() wrapper"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-002"
          file_path: "internal/cli/tasks.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Replace notification boilerplate with lifecycle.Run() call"
            - "Command behavior unchanged; notification fires on completion"
        - id: "T010"
          title: "Migrate clarify.go to use lifecycle.Run() wrapper"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-002"
          file_path: "internal/cli/clarify.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Replace notification boilerplate with lifecycle.Run() call"
            - "Command behavior unchanged; notification fires on completion"
        - id: "T011"
          title: "Migrate analyze.go to use lifecycle.Run() wrapper"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-002"
          file_path: "internal/cli/analyze.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Replace notification boilerplate with lifecycle.Run() call"
            - "Command behavior unchanged; notification fires on completion"
        - id: "T012"
          title: "Migrate checklist.go to use lifecycle.Run() wrapper"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-002"
          file_path: "internal/cli/checklist.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Replace notification boilerplate with lifecycle.Run() call"
            - "Command behavior unchanged; notification fires on completion"
        - id: "T013"
          title: "Migrate constitution.go to use lifecycle.Run() wrapper"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-002"
          file_path: "internal/cli/constitution.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Replace notification boilerplate with lifecycle.Run() call"
            - "Command behavior unchanged; notification fires on completion"
        - id: "T014"
          title: "Migrate implement.go to use lifecycle.Run() wrapper"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-002"
          file_path: "internal/cli/implement.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Replace notification boilerplate with lifecycle.Run() call"
            - "Command behavior unchanged; notification fires on completion"
        - id: "T015"
          title: "Migrate prep.go to use lifecycle.Run() wrapper"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-002"
          file_path: "internal/cli/prep.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Replace notification boilerplate with lifecycle.Run() call"
            - "Command behavior unchanged; notification fires on completion"
        - id: "T016"
          title: "Migrate run.go to use lifecycle.Run() wrapper"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-002"
          file_path: "internal/cli/run.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Replace notification boilerplate with lifecycle.Run() call"
            - "Command behavior unchanged; notification fires on completion"
        - id: "T017"
          title: "Migrate all.go to use lifecycle.Run() wrapper"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-002"
          file_path: "internal/cli/all.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Replace notification boilerplate with lifecycle.Run() call"
            - "Command behavior unchanged; notification fires on completion"
    - number: 5
      title: "User Story 4 - Context cancellation support"
      purpose: "Ensure commands handle cancellation gracefully"
      story_reference: "US-004"
      independent_test: "Start a command, cancel it with Ctrl+C, verify notification fires"
      tasks:
        - id: "T018"
          title: "Update commands that need context cancellation to use RunWithContext"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/cli/"
          dependencies: ["T017"]
          acceptance_criteria:
            - "Long-running commands (implement, run, prep) use RunWithContext"
            - "Context cancellation triggers notification with success=false"
            - "Cancelled commands return appropriate error"
    - number: 6
      title: "User Story 5 - Stage-level lifecycle support"
      purpose: "Update executor to use lifecycle.RunStage() for consistent stage handling"
      story_reference: "US-005"
      independent_test: "Execute a stage via executor, verify stage notification fires"
      tasks:
        - id: "T019"
          title: "Migrate executor.go to use lifecycle.RunStage() for stage completion"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-005"
          file_path: "internal/workflow/executor.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Replace direct OnStageComplete calls with lifecycle.RunStage()"
            - "Stage notification behavior unchanged"
            - "All existing executor tests pass"
    - number: 7
      title: "Polish & Cross-Cutting Concerns"
      purpose: "Regression test update, documentation, and quality gates"
      tasks:
        - id: "T020"
          title: "Update TestAllCommandsHaveNotificationSupport to verify lifecycle usage"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/cli/specify_test.go"
          dependencies: ["T017", "T019"]
          acceptance_criteria:
            - "Test verifies all 11 commands use lifecycle.Run() instead of direct notification boilerplate"
            - "Test passes with all commands migrated"
        - id: "T021"
          title: "Update CLAUDE.md to document lifecycle wrapper pattern"
          status: "Completed"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "CLAUDE.md"
          dependencies: ["T020"]
          acceptance_criteria:
            - "CLI Command Notification Handlers section updated to reference lifecycle.Run()"
            - "Example code shows new pattern instead of manual boilerplate"
            - "make test, make fmt, make lint, make build all pass"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-002"]
        - story_id: "US-002"
          depends_on: ["US-001"]
          blocks: ["US-003"]
        - story_id: "US-003"
          depends_on: ["US-002"]
          blocks: []
        - story_id: "US-004"
          depends_on: ["US-002"]
          blocks: []
        - story_id: "US-005"
          depends_on: []
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3, 6]
        - phase: 3
          blocks: [4]
        - phase: 4
          blocks: [5, 7]
        - phase: 5
          blocks: [7]
        - phase: 6
          blocks: [7]
parallel_execution:
    - phase: 2
      parallel_groups:
        - tasks: ["T005", "T006"]
          rationale: "Unit tests and benchmark tests are independent files"
    - phase: 4
      parallel_groups:
        - tasks: ["T008", "T009", "T010", "T011", "T012", "T013", "T014", "T015", "T016", "T017"]
          rationale: "Each command migration is in a separate file with no dependencies on other migrations"
    - phase: 7
      parallel_groups:
        - tasks: ["T020", "T021"]
          rationale: "Test update and documentation can proceed in parallel once dependencies met"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Foundational + First command migration (specify)"
        validation: "Run specify command, verify notification fires via lifecycle wrapper"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "internal/lifecycle package with Run(), RunWithContext(), RunStage() functions and tests"
        - milestone: "First Command Migrated"
          phases: [1, 2, 3]
          deliverable: "specify command using lifecycle.Run() - validates pattern works"
        - milestone: "All Commands Migrated"
          phases: [1, 2, 3, 4]
          deliverable: "All 11 CLI commands using lifecycle.Run() - ~100 lines of boilerplate removed"
        - milestone: "Full Implementation"
          phases: [1, 2, 3, 4, 5, 6, 7]
          deliverable: "Complete feature with context cancellation, stage support, tests, and documentation"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec dev"
    created: "2025-12-17T00:37:28Z"
    artifact_type: "tasks"
