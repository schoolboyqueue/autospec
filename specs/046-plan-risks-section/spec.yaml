feature:
    branch: "046-plan-risks-section"
    created: "2025-12-18"
    status: "Completed"
    completed_at: 2025-12-18T05:34:48Z
    input: "Add optional 'risks' section to plan.yaml for documenting implementation risks. PROBLEM: Risks identified during planning aren't captured in artifacts. SCHEMA CHANGE: Add risks array to plan.yaml with fields: id, description, likelihood (low/medium/high), impact (low/medium/high), mitigation. VALIDATION: Emit warning if high-impact risks have no mitigation. DISPLAY: Show risks summary in 'autospec st' for specs in planning phase. BENEFIT: Forces explicit risk acknowledgment before implementation."
user_stories:
    - id: "US-001"
      title: "Plan author documents implementation risks"
      priority: "P1"
      as_a: "plan author"
      i_want: "to document implementation risks with unique IDs in plan.yaml"
      so_that: "risks are tracked systematically and can be referenced during implementation"
      why_this_priority: "Core functionality - without risk documentation, the feature has no value"
      independent_test: "Create a plan.yaml with a risks section and verify it validates successfully"
      acceptance_scenarios:
        - given: "a plan.yaml file with a risks section containing properly structured risk entries"
          when: "the user runs 'autospec artifact' on the file"
          then: "validation passes and shows risk count in summary"
        - given: "a plan.yaml file without a risks section"
          when: "the user runs 'autospec artifact' on the file"
          then: "validation passes (risks section is optional)"
    - id: "US-002"
      title: "Plan author receives warning for unmitigated high-impact risks"
      priority: "P1"
      as_a: "plan author"
      i_want: "to receive a warning when high-impact risks lack mitigation strategies"
      so_that: "I am prompted to consider mitigations before proceeding to implementation"
      why_this_priority: "Key safety feature - high-impact risks without mitigation can derail projects"
      independent_test: "Create plan.yaml with high-impact risk missing mitigation, run validation, observe warning"
      acceptance_scenarios:
        - given: "a plan.yaml with a risk having impact 'high' and empty mitigation"
          when: "the user runs 'autospec artifact' on the file"
          then: "validation passes with a warning about unmitigated high-impact risk"
        - given: "a plan.yaml with a risk having impact 'high' and non-empty mitigation"
          when: "the user runs 'autospec artifact' on the file"
          then: "validation passes without warnings"
        - given: "a plan.yaml with a risk having impact 'medium' and empty mitigation"
          when: "the user runs 'autospec artifact' on the file"
          then: "validation passes without warnings (only high-impact triggers warning)"
    - id: "US-003"
      title: "User views risks summary in status display"
      priority: "P2"
      as_a: "developer"
      i_want: "to see a summary of documented risks when viewing spec status"
      so_that: "I am aware of identified risks before starting implementation"
      why_this_priority: "Enhances visibility but not critical for risk documentation itself"
      independent_test: "Create spec with plan.yaml containing risks, run 'autospec st', verify risks appear"
      acceptance_scenarios:
        - given: "a spec directory with plan.yaml containing 3 risks (1 high, 1 medium, 1 low impact)"
          when: "the user runs 'autospec st' for that spec"
          then: "the status display shows a risks summary with count and breakdown by impact level"
        - given: "a spec directory with plan.yaml containing no risks section"
          when: "the user runs 'autospec st' for that spec"
          then: "the status display shows 'No risks documented' or omits the risks section"
        - given: "a spec directory without plan.yaml (only spec.yaml exists)"
          when: "the user runs 'autospec st' for that spec"
          then: "no risks information is displayed (plan phase not yet reached)"
requirements:
    functional:
        - id: "FR-001"
          description: "MUST validate risk entries have required fields: id, description, likelihood, impact"
          testable: true
          acceptance_criteria: "Validation error when any required field is missing from a risk entry"
        - id: "FR-002"
          description: "MUST validate likelihood field accepts only values: low, medium, high"
          testable: true
          acceptance_criteria: "Validation error when likelihood has invalid value"
        - id: "FR-003"
          description: "MUST validate impact field accepts only values: low, medium, high"
          testable: true
          acceptance_criteria: "Validation error when impact has invalid value"
        - id: "FR-004"
          description: "SHOULD emit warning when a risk has impact 'high' and mitigation is empty or missing"
          testable: true
          acceptance_criteria: "Warning message appears in validation output for unmitigated high-impact risks"
        - id: "FR-005"
          description: "MUST treat risks section as optional (plan.yaml without risks is valid)"
          testable: true
          acceptance_criteria: "Existing plan.yaml files without risks section continue to validate"
        - id: "FR-006"
          description: "MUST display risks summary in 'autospec st' output when plan.yaml exists and contains risks"
          testable: true
          acceptance_criteria: "Status output includes risks count and impact breakdown"
        - id: "FR-007"
          description: "MUST validate risk id follows pattern RISK-NNN (e.g., RISK-001)"
          testable: true
          acceptance_criteria: "Validation error when id doesn't match expected pattern"
        - id: "FR-008"
          description: "MUST include mitigation field as optional (can be empty string or omitted)"
          testable: true
          acceptance_criteria: "Validation passes when mitigation is missing; warning only for high-impact risks"
        - id: "FR-009"
          description: "MUST pass all quality gates: make test, make fmt, make lint, and make build"
          testable: true
          acceptance_criteria: "All commands exit 0; no test failures, format changes, lint errors, or build failures"
    non_functional:
        - id: "NFR-001"
          category: "performance"
          description: "Risk validation must complete within overall validation performance budget"
          measurable_target: "Validation with risks section completes in <10ms (part of existing validation)"
        - id: "NFR-002"
          category: "code_quality"
          description: "All functions must be under 40 lines; extract helpers for complex logic"
          measurable_target: "No function exceeds 40 lines excluding comments"
        - id: "NFR-003"
          category: "code_quality"
          description: "All errors must be wrapped with context using fmt.Errorf(\"doing X: %w\", err)"
          measurable_target: "Zero bare 'return err' statements in new code"
        - id: "NFR-004"
          category: "code_quality"
          description: "Tests must use map-based table-driven pattern with t.Parallel()"
          measurable_target: "All new test functions use map[string]struct pattern and call t.Parallel()"
        - id: "NFR-005"
          category: "code_quality"
          description: "Accept interfaces, return concrete types"
          measurable_target: "Function signatures follow interface-in, concrete-out pattern where applicable"
        - id: "NFR-006"
          category: "compatibility"
          description: "Backward compatible with existing plan.yaml files"
          measurable_target: "All existing plan.yaml files in specs/ directory continue to validate"
success_criteria:
    measurable_outcomes:
        - id: "SC-001"
          description: "All existing plan.yaml files in the specs directory continue to validate without errors"
          metric: "Number of validation failures on existing files"
          target: "0 failures"
        - id: "SC-002"
          description: "Users can document risks with unique identifiers in plan.yaml"
          metric: "Ability to add risks section to plan.yaml"
          target: "Risks section with id, description, likelihood, impact, mitigation fields validates"
        - id: "SC-003"
          description: "High-impact risks without mitigation trigger visible warnings"
          metric: "Warning displayed in validation output"
          target: "Warning message present for each unmitigated high-impact risk"
        - id: "SC-004"
          description: "Status command shows risk summary for specs in planning phase"
          metric: "Presence of risks information in status output"
          target: "Risks count and impact breakdown displayed when plan.yaml contains risks"
key_entities:
    - name: "Risk"
      description: "An identified implementation risk with assessment and mitigation"
      attributes:
        - "id: unique identifier (RISK-NNN format)"
        - "description: text describing the risk"
        - "likelihood: probability of occurrence (low/medium/high)"
        - "impact: severity if risk materializes (low/medium/high)"
        - "mitigation: optional strategy to address the risk"
edge_cases:
    - scenario: "Risk with empty description"
      expected_behavior: "Validation error requiring non-empty description"
    - scenario: "Duplicate risk IDs in same plan.yaml"
      expected_behavior: "Validation warning about duplicate IDs (non-blocking)"
    - scenario: "Plan.yaml has risks section but it's an empty array"
      expected_behavior: "Validation passes (empty array is valid)"
    - scenario: "Risk with likelihood 'critical' (invalid value)"
      expected_behavior: "Validation error listing valid values"
    - scenario: "Very long risk description (1000+ characters)"
      expected_behavior: "Validation passes; truncation only in status display if needed"
assumptions:
    - "The existing plan.yaml schema infrastructure can be extended without breaking changes"
    - "Warning messages in validation do not cause non-zero exit codes"
    - "The status command already reads plan.yaml for other purposes (can be extended)"
    - "Users are familiar with the RISK-NNN ID format from similar patterns in spec.yaml (FR-NNN, NFR-NNN)"
constraints:
    - "Must maintain backward compatibility with all existing plan.yaml files"
    - "Risks section must remain optional to avoid breaking existing workflows"
    - "Validation performance must stay under 10ms total (existing contract)"
    - "Risk ID format must be consistent with existing ID patterns in the codebase"
out_of_scope:
    - "Automatic risk scoring or prioritization algorithms"
    - "Risk tracking across multiple specs (cross-project risk management)"
    - "Integration with external risk management tools"
    - "Risk templates or suggested risks based on project type"
    - "Historical risk tracking or versioning"
    - "Risk assignment to team members"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec dev"
    created: "2025-12-18T05:17:29Z"
    artifact_type: "spec"
