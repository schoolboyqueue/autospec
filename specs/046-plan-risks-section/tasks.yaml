tasks:
    branch: "046-plan-risks-section"
    created: "2025-12-18"
    spec_path: "specs/046-plan-risks-section/spec.yaml"
    plan_path: "specs/046-plan-risks-section/plan.yaml"
summary:
    total_tasks: 14
    total_phases: 5
    parallel_opportunities: 4
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Prepare development environment and verify prerequisites"
      tasks:
        - id: "T001"
          title: "Verify existing plan.yaml testdata and validation infrastructure"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/validation/testdata/plan/"
          dependencies: []
          acceptance_criteria:
            - "Existing plan.yaml test fixtures are identified"
            - "Current PlanValidator implementation is understood"
            - "Schema.go plan field definitions are reviewed"
    - number: 2
      title: "Foundational"
      purpose: "Add warning support to ValidationResult that all user stories depend on"
      tasks:
        - id: "T002"
          title: "Add ValidationWarning type to internal/validation/validation.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/validation/validation.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "ValidationWarning struct has Path, Line, and Message fields"
            - "Type is exported and documented"
        - id: "T003"
          title: "Add Warnings field and AddWarning method to ValidationResult"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/validation/validation.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "ValidationResult has Warnings []ValidationWarning field"
            - "AddWarning method appends warnings to the slice"
            - "Existing tests still pass"
    - number: 3
      title: "User Story 1 - Plan author documents implementation risks"
      purpose: "Enable risk documentation in plan.yaml with validation"
      story_reference: "US-001"
      independent_test: "Create a plan.yaml with a risks section and verify it validates successfully"
      tasks:
        - id: "T004"
          title: "Update PlanSchema risks Children in internal/validation/schema.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/validation/schema.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "PlanSchema risks field has Children defining id, risk, likelihood, impact, mitigation"
            - "id, risk, likelihood, impact are required; mitigation is optional"
            - "likelihood and impact have ValidValues: low, medium, high"
        - id: "T005"
          title: "Add validateRisks method to PlanValidator in internal/validation/artifact_plan.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/validation/artifact_plan.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "validateRisks method validates each risk entry"
            - "Validates required fields: id, risk, likelihood, impact"
            - "Validates id matches RISK-\\d{3} pattern"
            - "Validates likelihood and impact are valid enum values"
            - "Called from Validate method when risks section exists"
        - id: "T006"
          title: "Add test fixtures for risk validation in internal/validation/testdata/plan/"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/validation/testdata/plan/"
          dependencies: ["T005"]
          acceptance_criteria:
            - "risks_valid.yaml with properly structured risks section"
            - "risks_missing_required.yaml with missing required fields"
            - "risks_invalid_enum.yaml with invalid likelihood/impact values"
            - "risks_invalid_id.yaml with malformed risk ID"
            - "risks_empty_array.yaml with empty risks array"
        - id: "T007"
          title: "Add unit tests for risk validation in internal/validation/artifact_plan_test.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/validation/artifact_plan_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Map-based table-driven tests with t.Parallel()"
            - "Tests for valid risks section passes"
            - "Tests for missing required fields fail validation"
            - "Tests for invalid enum values fail validation"
            - "Tests for invalid ID pattern fail validation"
            - "Tests for empty risks array passes"
            - "Tests for missing risks section passes (optional)"
    - number: 4
      title: "User Story 2 - Plan author receives warning for unmitigated high-impact risks"
      purpose: "Warn users about high-impact risks without mitigation strategies"
      story_reference: "US-002"
      independent_test: "Create plan.yaml with high-impact risk missing mitigation, run validation, observe warning"
      tasks:
        - id: "T008"
          title: "Add high-impact risk warning logic to validateRisks in internal/validation/artifact_plan.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/validation/artifact_plan.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Warning emitted when risk has impact 'high' and mitigation is empty/missing"
            - "Warning uses AddWarning method on ValidationResult"
            - "Warning message includes risk ID for reference"
            - "No warning for medium/low impact risks without mitigation"
        - id: "T009"
          title: "Update artifact command to display warnings in output"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cli/artifact.go"
          dependencies: ["T008"]
          acceptance_criteria:
            - "Warnings are displayed after validation passes"
            - "Warning output is visually distinct from errors"
            - "Warnings do not cause non-zero exit code"
        - id: "T010"
          title: "Add test fixtures and tests for warning emission"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/validation/artifact_plan_test.go"
          dependencies: ["T009"]
          acceptance_criteria:
            - "risks_high_impact_no_mitigation.yaml test fixture"
            - "risks_high_impact_with_mitigation.yaml test fixture"
            - "Test verifies warning is emitted for unmitigated high-impact risk"
            - "Test verifies no warning for mitigated high-impact risk"
            - "Test verifies no warning for unmitigated medium/low impact risk"
    - number: 5
      title: "User Story 3 - User views risks summary in status display"
      purpose: "Display risk summary in autospec st output for visibility"
      story_reference: "US-003"
      independent_test: "Create spec with plan.yaml containing risks, run 'autospec st', verify risks appear"
      tasks:
        - id: "T011"
          title: "Add risk parsing to status command in internal/cli/status.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/cli/status.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Parse plan.yaml risks section when plan.yaml exists"
            - "Extract risk count and breakdown by impact level"
            - "Handle missing risks section gracefully"
            - "Handle missing plan.yaml gracefully"
        - id: "T012"
          title: "Display risk summary in status output"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/cli/status.go"
          dependencies: ["T011"]
          acceptance_criteria:
            - "Risk count displayed when risks exist"
            - "Breakdown by impact level (high: N, medium: N, low: N)"
            - "'No risks documented' or omit section when no risks"
            - "Risks section only shown when plan.yaml exists"
        - id: "T013"
          title: "Add tests for status command risk display in internal/cli/status_test.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/cli/status_test.go"
          dependencies: ["T012"]
          acceptance_criteria:
            - "Map-based table-driven tests with t.Parallel()"
            - "Test with plan.yaml containing risks shows summary"
            - "Test with plan.yaml without risks section"
            - "Test without plan.yaml (spec only)"
    - number: 6
      title: "Polish & Quality Gates"
      purpose: "Final validation, quality checks, and documentation"
      tasks:
        - id: "T014"
          title: "Run quality gates: make test, make fmt, make lint, make build"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "."
          dependencies: ["T010", "T013"]
          acceptance_criteria:
            - "make test passes with no failures"
            - "make fmt produces no changes"
            - "make lint produces no errors"
            - "make build succeeds"
            - "All existing plan.yaml files in specs/ continue to validate"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-002"]
        - story_id: "US-002"
          depends_on: ["US-001"]
          blocks: []
        - story_id: "US-003"
          depends_on: ["US-001"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3]
        - phase: 3
          blocks: [4, 5]
        - phase: 4
          blocks: [6]
        - phase: 5
          blocks: [6]
parallel_execution:
    - phase: 4
      parallel_groups:
        - tasks: ["T011"]
          rationale: "US-003 only depends on US-001, can start after T007 completes"
    - phase: 5
      parallel_groups:
        - tasks: ["T011", "T012", "T013"]
          rationale: "Status command changes are independent of warning emission in Phase 4"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Foundational + US-001 (risk documentation with validation)"
        validation: "Create plan.yaml with risks section, run autospec artifact, verify validation passes"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "ValidationResult supports warnings; ready for risk validation"
        - milestone: "Risk Documentation MVP"
          phases: [1, 2, 3]
          deliverable: "Users can document risks in plan.yaml with full validation"
        - milestone: "Warning System"
          phases: [1, 2, 3, 4]
          deliverable: "High-impact risks without mitigation trigger visible warnings"
        - milestone: "Full Feature"
          phases: [1, 2, 3, 4, 5, 6]
          deliverable: "Complete feature with status display and quality gates passed"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec dev"
    created: "2025-12-18T05:21:17Z"
    artifact_type: "tasks"
