plan:
  branch: "013-uninstall-command"
  created: "2025-12-15"
  spec_path: "specs/013-uninstall-command/spec.yaml"

summary: |
  Implement a new 'autospec uninstall' CLI command that completely removes autospec from
  the system. The command will remove: (1) the autospec binary from its installed location,
  (2) user configuration directory (~/.config/autospec/), and (3) state directory (~/.autospec/).

  The implementation follows the existing clean.go pattern for prompts and file removal,
  with additions for binary location detection using os.Executable() and privilege handling.
  The command supports --dry-run for preview, --yes/-y for non-interactive mode, and provides
  clear feedback on removal progress.

technical_context:
  language: "Go"
  framework: "Cobra CLI (v1.10.1)"
  primary_dependencies:
    - name: "spf13/cobra"
      version: "v1.10.1"
      purpose: "CLI command structure and flag parsing"
    - name: "golang.org/x/term"
      version: "v0.18.0"
      purpose: "Terminal detection for prompts (already in project)"
  storage: "None"
  testing:
    framework: "Go testing package"
    approach: "Table-driven unit tests following existing patterns in clean_test.go"
  target_platform: "Linux, macOS"
  project_type: "cli"
  performance_goals: "Complete within 5 seconds (NFR-001)"
  constraints:
    - "Must work on Linux and macOS (Windows explicitly out of scope)"
    - "Cannot remove files without user permission (without sudo)"
    - "Must not delete project-specific files"
    - "Must handle missing files gracefully"
  scale_scope: "Single-user CLI tool operation"

constitution_check:
  constitution_path: ".autospec/memory/constitution.yaml"
  gates:
    - name: "Test-First Development (PRIN-001)"
      status: "PASS"
      notes: "Tests will be written before implementation in Phase 1"
    - name: "Validation-First Workflow (PRIN-002)"
      status: "PASS"
      notes: "Pre-removal validation checks targets exist before proceeding"
    - name: "Performance Standards (PRIN-003)"
      status: "PASS"
      notes: "Target <5s total execution time, validation <10ms"
    - name: "Idempotency and Retry Logic (PRIN-004)"
      status: "PASS"
      notes: "Uninstall is idempotent - missing files handled gracefully"
    - name: "Standardized Exit Codes (PRIN-005)"
      status: "PASS"
      notes: "Will use exit 0 for success, 1 for partial failure"
    - name: "YAML-First Artifacts (PRIN-006)"
      status: "N/A"
      notes: "Uninstall command does not produce artifacts"
    - name: "Code Formatting (PRIN-007)"
      status: "PASS"
      notes: "Will run make fmt before committing"
    - name: "Cross-Platform Compatibility (PRIN-008)"
      status: "PASS"
      notes: "Uses Go standard library for cross-platform file ops"
    - name: "Explicit Dependencies (PRIN-009)"
      status: "PASS"
      notes: "No new dependencies required"
    - name: "Documentation Standards (PRIN-010)"
      status: "PASS"
      notes: "Will update CLAUDE.md with new command documentation"

research_findings:
  decisions:
    - topic: "Binary location detection"
      decision: "Use os.Executable() to detect running binary location"
      rationale: "Standard library function that returns the path to the current executable, portable across platforms"
      alternatives_considered:
        - "Hardcode /usr/local/bin/autospec"
        - "Use which/whereis commands via shell"
        - "Check AUTOSPEC_INSTALL_DIR environment variable only"
    - topic: "Privilege handling for binary removal"
      decision: "Detect if sudo is needed, prompt user to re-run with sudo if required"
      rationale: "Matches install.sh pattern; avoids running entire command as sudo when only binary removal needs it"
      alternatives_considered:
        - "Always require sudo"
        - "Use setuid bits"
        - "Shell out to sudo rm"
    - topic: "Package manager detection"
      decision: "Skip package manager detection (out of scope per spec)"
      rationale: "Spec explicitly marks package manager detection as out of scope; keep implementation simple"
      alternatives_considered:
        - "Check for brew/apt package ownership"
        - "Read /var/lib/dpkg/status"
    - topic: "Code organization"
      decision: "Create internal/uninstall/ package mirroring internal/clean/ structure"
      rationale: "Consistent with existing codebase patterns; separates business logic from CLI layer"
      alternatives_considered:
        - "Add all logic directly in internal/cli/uninstall.go"
        - "Extend internal/clean/ package"

data_model:
  entities:
    - name: "UninstallTarget"
      description: "A file or directory to be removed during uninstall"
      fields:
        - name: "Path"
          type: "string"
          description: "Absolute path to the target"
          constraints: "Must be absolute path"
        - name: "Type"
          type: "TargetType"
          description: "Type of target: binary, config_dir, or state_dir"
          constraints: "One of defined constants"
        - name: "Description"
          type: "string"
          description: "Human-readable description for display"
          constraints: "Non-empty"
        - name: "Exists"
          type: "bool"
          description: "Whether the target currently exists"
          constraints: "None"
        - name: "RequiresSudo"
          type: "bool"
          description: "Whether elevated privileges are needed"
          constraints: "Only relevant for binary target"
      relationships: []
    - name: "UninstallResult"
      description: "Result of attempting to remove a target"
      fields:
        - name: "Target"
          type: "UninstallTarget"
          description: "The target that was processed"
          constraints: "None"
        - name: "Success"
          type: "bool"
          description: "Whether removal succeeded"
          constraints: "None"
        - name: "Error"
          type: "error"
          description: "Error if removal failed"
          constraints: "Nil on success"
      relationships:
        - target: "UninstallTarget"
          type: "one-to-one"
          description: "Result contains the target it processed"

api_contracts:
  endpoints: []

project_structure:
  documentation:
    - path: "CLAUDE.md"
      description: "Update with new uninstall command documentation"
  source_code:
    - path: "internal/cli/uninstall.go"
      description: "Cobra command implementation for uninstall"
    - path: "internal/uninstall/uninstall.go"
      description: "Core uninstall logic: target detection, removal"
  tests:
    - path: "internal/cli/uninstall_test.go"
      description: "CLI command tests"
    - path: "internal/uninstall/uninstall_test.go"
      description: "Unit tests for uninstall logic"

implementation_phases:
  - phase: 1
    name: "Core uninstall logic with tests"
    goal: "Implement the internal/uninstall package with target detection and removal functions"
    deliverables:
      - "internal/uninstall/uninstall.go with UninstallTarget, UninstallResult types"
      - "DetectBinaryLocation() function using os.Executable()"
      - "GetUninstallTargets() function returning all removal targets"
      - "RemoveTargets() function with error handling for each target"
      - "RequiresSudo() function to check if binary needs elevated privileges"
      - "internal/uninstall/uninstall_test.go with table-driven unit tests"
  - phase: 2
    name: "CLI command implementation"
    goal: "Create the autospec uninstall command with flags and user interaction"
    dependencies:
      - "Phase 1"
    deliverables:
      - "internal/cli/uninstall.go with Cobra command definition"
      - "Support for --dry-run, --yes/-y flags"
      - "Confirmation prompt with y/N default"
      - "Clear progress output showing each removal step"
      - "Hint message about autospec clean for project cleanup"
      - "internal/cli/uninstall_test.go for CLI command tests"
  - phase: 3
    name: "Documentation and integration"
    goal: "Update documentation and ensure integration with existing commands"
    dependencies:
      - "Phase 2"
    deliverables:
      - "Update CLAUDE.md with uninstall command usage and examples"
      - "Ensure command appears in autospec --help"
      - "Run make fmt for code formatting"
      - "Run make test to verify all tests pass"

risks:
  - risk: "Binary installed by package manager"
    likelihood: "low"
    impact: "medium"
    mitigation: "Spec explicitly marks this as out of scope; command assumes direct installation"
  - risk: "Permission denied when removing binary"
    likelihood: "medium"
    impact: "medium"
    mitigation: "Detect permission issue and provide clear message to user about using sudo"
  - risk: "Binary symlinked or in unexpected location"
    likelihood: "low"
    impact: "low"
    mitigation: "os.Executable() resolves symlinks; still points to actual binary location"

open_questions:
  - question: "Should uninstall warn if config has custom settings before removal?"
    context: "User might lose customized configuration without realizing"
    proposed_resolution: "Display configuration file path in --dry-run output; standard y/N prompt provides safety"
  - question: "Should we offer --keep-config flag to preserve user configuration?"
    context: "Users might want to reinstall later with same config"
    proposed_resolution: "Not in initial implementation; can be added later if users request it"

_meta:
  version: "1.0.0"
  generator: "autospec"
  generator_version: "dev"
  created: "2025-12-15T23:00:00Z"
  artifact_type: "plan"
