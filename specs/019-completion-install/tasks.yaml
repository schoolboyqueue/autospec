tasks:
    branch: "019-completion-install"
    created: "2025-12-16"
    spec_path: "specs/019-completion-install/spec.yaml"
    plan_path: "specs/019-completion-install/plan.yaml"
summary:
    total_tasks: 18
    total_phases: 5
    parallel_opportunities: 6
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Create internal/completion package structure"
      tasks:
        - id: "T001"
          title: "Create internal/completion package directory"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/completion/"
          dependencies: []
          acceptance_criteria:
            - "Directory internal/completion/ exists"
            - "Package can be imported by other internal packages"
    - number: 2
      title: "Foundational"
      purpose: "Core shell configuration and detection infrastructure"
      tasks:
        - id: "T002"
          title: "Implement shell type constants and ShellConfig struct in internal/completion/shells.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/completion/shells.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Shell constants defined for bash, zsh, fish, powershell"
            - "ShellConfig struct with rcPath, completionDir, requiresRCModification fields"
            - "GetShellConfig() returns correct config for each shell type"
            - "Bash/zsh/powershell have requiresRCModification=true"
            - "Fish has requiresRCModification=false and completionDir set"
        - id: "T003"
          title: "Implement DetectShell() function in internal/completion/shells.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/completion/shells.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "Parses $SHELL environment variable"
            - "Returns correct shell type for /bin/bash, /usr/bin/bash, /bin/zsh, etc."
            - "Returns error if $SHELL is not set or unrecognized"
            - "Handles PowerShell detection on Windows"
        - id: "T004"
          title: "Implement GetCompletionBlock() function in internal/completion/shells.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/completion/shells.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "Returns completion block with start/end markers per FR-007"
            - "Bash block: source <(autospec completion bash)"
            - "Zsh block: autoload -U compinit && compinit; source <(autospec completion zsh)"
            - "PowerShell block: autospec completion powershell | Out-String | Invoke-Expression"
            - "Fish returns empty block (uses standalone file)"
        - id: "T005"
          title: "Add unit tests for shell configuration in internal/completion/shells_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: null
          file_path: "internal/completion/shells_test.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Table-driven tests for GetShellConfig()"
            - "Table-driven tests for DetectShell() with various $SHELL values"
            - "Table-driven tests for GetCompletionBlock()"
            - "Tests cover all four supported shells"
            - "Tests verify marker format matches FR-007"
    - number: 3
      title: "User Story 1&2 - One-command completion setup with auto-detection"
      purpose: "Enable users to install completions with a single command that auto-detects their shell"
      story_reference: "US-001, US-002"
      independent_test: "Run 'autospec completion install' without arguments, verify correct rc file is modified"
      tasks:
        - id: "T006"
          title: "Implement CreateBackup() function in internal/completion/install.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/completion/install.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "Creates backup with .autospec-backup-YYYYMMDD-HHMMSS suffix"
            - "Preserves original file content exactly"
            - "Returns backup path on success"
            - "Handles case where original file doesn't exist (no backup needed)"
        - id: "T007"
          title: "Implement HasExistingInstallation() function in internal/completion/install.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/completion/install.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Detects presence of start marker in rc file"
            - "Returns true if completion block already exists"
            - "Returns false if markers not found"
            - "Handles case where rc file doesn't exist"
        - id: "T008"
          title: "Implement Install() orchestration function in internal/completion/install.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/completion/install.go"
          dependencies: ["T006", "T007"]
          acceptance_criteria:
            - "Orchestrates full installation flow for bash/zsh/powershell"
            - "Creates backup before modification (FR-005)"
            - "Appends completion block to rc file"
            - "Handles fish specially: writes to completions directory"
            - "Creates fish completions directory if it doesn't exist"
            - "Returns InstallResult with success, backupPath, configPath, action, message"
        - id: "T009"
          title: "Add unit tests for installation logic in internal/completion/install_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-001"
          file_path: "internal/completion/install_test.go"
          dependencies: ["T008"]
          acceptance_criteria:
            - "Table-driven tests for CreateBackup()"
            - "Table-driven tests for HasExistingInstallation()"
            - "Table-driven tests for Install() with all four shells"
            - "Tests verify backup file creation with correct timestamp format"
            - "Tests verify idempotent behavior (skip/update on existing)"
            - "Tests use temp directories for file operations"
        - id: "T010"
          title: "Create Cobra 'completion install' subcommand in internal/cli/completion_install.go"
          status: "InProgress"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cli/completion_install.go"
          dependencies: ["T008"]
          acceptance_criteria:
            - "Subcommand registered under 'completion' parent command"
            - "Auto-detects shell when no argument provided"
            - "Calls completion.Install() with detected or specified shell"
            - "Displays success message with activation instructions (FR-008)"
            - "Exits with code 0 on success"
    - number: 4
      title: "User Story 3&4&5 - Explicit shell selection, backups, and manual instructions"
      purpose: "Support power users with explicit shell selection, ensure safe modifications with backups, and provide fallback manual instructions"
      story_reference: "US-003, US-004, US-005"
      independent_test: "Run 'autospec completion install zsh' from bash; verify backup exists; run with --manual flag and verify instructions shown"
      tasks:
        - id: "T011"
          title: "Add shell argument parsing to completion install command"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/cli/completion_install.go"
          dependencies: ["T010"]
          acceptance_criteria:
            - "Accepts optional positional argument: bash, zsh, fish, powershell"
            - "Validates argument against supported shells"
            - "Returns exit code 3 for unknown shell argument (FR-003)"
            - "Clear error message lists supported shells on invalid input"
        - id: "T012"
          title: "Implement --manual flag for instructions-only mode"
          status: "Pending"
          type: "implementation"
          parallel: true
          story_id: "US-005"
          file_path: "internal/cli/completion_install.go"
          dependencies: ["T010"]
          acceptance_criteria:
            - "--manual flag displays manual installation instructions"
            - "No files modified when --manual flag is set"
            - "Instructions include exact commands for each shell type"
            - "Instructions show where to add the completion block"
        - id: "T013"
          title: "Add permission error handling with manual instructions fallback"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-005"
          file_path: "internal/completion/install.go"
          dependencies: ["T008"]
          acceptance_criteria:
            - "Catches permission denied errors during file operations"
            - "Returns appropriate error with manual instructions"
            - "Error message explains cause and recommended action (NFR-003)"
        - id: "T014"
          title: "Add CLI integration tests for completion install in internal/cli/completion_install_test.go"
          status: "Pending"
          type: "test"
          parallel: true
          story_id: "US-003"
          file_path: "internal/cli/completion_install_test.go"
          dependencies: ["T011", "T012"]
          acceptance_criteria:
            - "Tests auto-detection flow"
            - "Tests explicit shell argument for all four shells"
            - "Tests --manual flag output"
            - "Tests invalid shell argument error handling"
            - "Tests idempotency (existing installation detected)"
    - number: 5
      title: "Polish & Documentation"
      purpose: "Update documentation and finalize user experience"
      tasks:
        - id: "T015"
          title: "Update docs/SHELL-COMPLETION.md with install command"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "docs/SHELL-COMPLETION.md"
          dependencies: ["T011", "T012"]
          acceptance_criteria:
            - "Documents 'autospec completion install' command"
            - "Shows examples for all four shells"
            - "Explains auto-detection behavior"
            - "Explains --manual flag usage"
            - "Documents backup file location and format"
        - id: "T016"
          title: "Update CLAUDE.md with completion install command reference"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "CLAUDE.md"
          dependencies: ["T011"]
          acceptance_criteria:
            - "Adds completion install to CLI command list"
            - "Documents usage patterns"
            - "Follows existing documentation style"
        - id: "T017"
          title: "Update README.md completion section"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "README.md"
          dependencies: ["T011"]
          acceptance_criteria:
            - "Mentions 'autospec completion install' for easy setup"
            - "Links to SHELL-COMPLETION.md for details"
        - id: "T018"
          title: "Run make fmt and verify all tests pass"
          status: "Pending"
          type: "refactor"
          parallel: false
          story_id: null
          file_path: "Makefile"
          dependencies: ["T014", "T015", "T016", "T017"]
          acceptance_criteria:
            - "make fmt runs without changes needed"
            - "go test ./... passes all tests"
            - "make lint passes without errors"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-003", "US-004", "US-005"]
        - story_id: "US-002"
          depends_on: []
          blocks: ["US-003"]
        - story_id: "US-003"
          depends_on: ["US-001", "US-002"]
          blocks: []
        - story_id: "US-004"
          depends_on: ["US-001"]
          blocks: []
        - story_id: "US-005"
          depends_on: ["US-001"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3]
        - phase: 3
          blocks: [4]
        - phase: 4
          blocks: [5]
parallel_execution:
    - phase: 2
      parallel_groups:
        - tasks: ["T005"]
          rationale: "Tests can be developed alongside implementation in Phase 2"
    - phase: 3
      parallel_groups:
        - tasks: ["T006", "T007"]
          rationale: "CreateBackup and HasExistingInstallation are independent functions"
        - tasks: ["T009"]
          rationale: "Unit tests can be developed in parallel with CLI integration"
    - phase: 4
      parallel_groups:
        - tasks: ["T012"]
          rationale: "--manual flag is independent of shell argument parsing"
        - tasks: ["T014"]
          rationale: "CLI integration tests can be written in parallel"
    - phase: 5
      parallel_groups:
        - tasks: ["T015", "T016", "T017"]
          rationale: "Documentation files are independent"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Foundational + Core installation with auto-detection"
        validation: "Run 'autospec completion install' without arguments, verify completions work in new shell"
    incremental_delivery:
        - milestone: "Shell Infrastructure Ready"
          phases: [1, 2]
          deliverable: "Shell detection and configuration functions available for CLI integration"
        - milestone: "MVP Complete"
          phases: [1, 2, 3]
          deliverable: "Users can run 'autospec completion install' to enable completions with auto-detection"
        - milestone: "Full Feature"
          phases: [1, 2, 3, 4]
          deliverable: "Explicit shell selection, --manual flag, robust error handling"
        - milestone: "Production Ready"
          phases: [1, 2, 3, 4, 5]
          deliverable: "Complete with documentation and all tests passing"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec dev"
    created: "2025-12-16T06:13:14Z"
    artifact_type: "tasks"
