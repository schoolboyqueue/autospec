tasks:
    branch: "026-completion-notifications"
    created: "2025-12-16"
    spec_path: "specs/026-completion-notifications/spec.yaml"
    plan_path: "specs/026-completion-notifications/plan.yaml"
summary:
    total_tasks: 24
    total_phases: 8
    parallel_opportunities: 10
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Create new notification package structure and foundational files"
      tasks:
        - id: "T001"
          title: "Create internal/notify package directory structure"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/notify/"
          dependencies: []
          acceptance_criteria:
            - "Directory internal/notify/ exists"
            - "Package structure ready for implementation"
    - number: 2
      title: "Foundational - Core Notification Types"
      purpose: "Define notification types, interfaces, and platform detection logic that all user stories depend on"
      tasks:
        - id: "T002"
          title: "Implement NotificationConfig struct with YAML tags in internal/notify/notify.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/notify/notify.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "NotificationConfig struct with Enabled, Type, SoundFile, OnCommandComplete, OnStageComplete, OnError, OnLongRunning, LongRunningThreshold fields"
            - "All fields have proper yaml, json, and mapstructure tags"
            - "Type field validates against enum: sound, visual, both"
            - "LongRunningThreshold is time.Duration with 30s default"
        - id: "T003"
          title: "Implement Notification struct and NotificationType enum in internal/notify/notify.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/notify/notify.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Notification struct with Title, Message, NotificationType fields"
            - "NotificationType constants: Success, Failure, Info"
            - "Constructor function NewNotification(title, message, notificationType)"
        - id: "T004"
          title: "Implement NotificationSender interface in internal/notify/sender.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/notify/sender.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "NotificationSender interface with Send(notification Notification) error method"
            - "Platform detection using runtime.GOOS"
            - "NewSender(config NotificationConfig) NotificationSender factory function"
            - "Tool availability checks using exec.LookPath"
        - id: "T005"
          title: "Implement platform availability detection in internal/notify/sender.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/notify/sender.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "CheckVisualAvailable() returns bool based on platform tools"
            - "CheckSoundAvailable() returns bool based on platform tools"
            - "Uses exec.LookPath to detect notify-send, osascript, powershell"
    - number: 3
      title: "User Story US-004 - Cross-platform notification support"
      purpose: "Implement platform-specific notification senders for macOS, Linux, and Windows"
      story_reference: "US-004"
      independent_test: "Run autospec with notifications on each OS and verify native notification appears"
      tasks:
        - id: "T006"
          title: "Implement macOS notification sender in internal/notify/darwin.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-004"
          file_path: "internal/notify/darwin.go"
          dependencies: ["T004", "T005"]
          acceptance_criteria:
            - "Uses osascript for visual notifications via display notification AppleScript"
            - "Uses afplay for sound notifications"
            - "Default sound: /System/Library/Sounds/Glass.aiff"
            - "Supports custom sound file path"
            - "Graceful failure when osascript/afplay unavailable"
        - id: "T007"
          title: "Implement Linux notification sender in internal/notify/linux.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-004"
          file_path: "internal/notify/linux.go"
          dependencies: ["T004", "T005"]
          acceptance_criteria:
            - "Uses notify-send for visual notifications"
            - "Uses paplay for sound notifications"
            - "Falls back gracefully when tools unavailable"
            - "Supports custom sound file path"
            - "Detects missing display environment"
        - id: "T008"
          title: "Implement Windows notification sender in internal/notify/windows.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-004"
          file_path: "internal/notify/windows.go"
          dependencies: ["T004", "T005"]
          acceptance_criteria:
            - "Uses PowerShell for toast notifications"
            - "Uses PowerShell for sound (system beep or custom file)"
            - "Uses -ExecutionPolicy Bypass for script execution"
            - "Graceful failure when PowerShell unavailable"
    - number: 4
      title: "User Story US-003 - Configure notification type preferences"
      purpose: "Integrate notification config with existing config hierarchy"
      story_reference: "US-003"
      independent_test: "Set different notification configurations and verify each setting is respected"
      tasks:
        - id: "T009"
          title: "Add NotificationConfig to Configuration struct in internal/config/config.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/config/config.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "Configuration struct has Notifications NotificationConfig field"
            - "Proper yaml, json, mapstructure tags"
            - "Environment variable support via AUTOSPEC_NOTIFICATIONS_* prefix"
        - id: "T010"
          title: "Add notification defaults to GetDefaults() in internal/config/defaults.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/config/defaults.go"
          dependencies: ["T009"]
          acceptance_criteria:
            - "Notifications.Enabled defaults to false"
            - "Notifications.Type defaults to 'both'"
            - "Notifications.OnCommandComplete defaults to true"
            - "Notifications.OnError defaults to true"
            - "Notifications.OnStageComplete defaults to false"
            - "Notifications.OnLongRunning defaults to false"
            - "Notifications.LongRunningThreshold defaults to 30s"
        - id: "T011"
          title: "Add config validation for notification settings in internal/config/config.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/config/config.go"
          dependencies: ["T010"]
          acceptance_criteria:
            - "Validates Type is one of: sound, visual, both"
            - "Validates SoundFile exists if specified"
            - "Validates LongRunningThreshold is non-negative or treats 0/negative as 'always notify'"
    - number: 5
      title: "User Story US-007 - Configure notification hooks"
      purpose: "Implement notification hook logic and handler integration"
      story_reference: "US-007"
      independent_test: "Enable different hook combinations and verify notifications fire at correct times"
      tasks:
        - id: "T012"
          title: "Implement NotificationHandler struct in internal/notify/handler.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-007"
          file_path: "internal/notify/handler.go"
          dependencies: ["T006", "T007", "T008", "T011"]
          acceptance_criteria:
            - "NotificationHandler wraps NotificationSender with config"
            - "NewHandler(config NotificationConfig) *NotificationHandler constructor"
            - "Tracks command start time for duration calculation"
            - "Dispatches notifications asynchronously via goroutine"
            - "Context timeout for notification dispatch (100ms)"
        - id: "T013"
          title: "Implement hook methods in internal/notify/handler.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-007"
          file_path: "internal/notify/handler.go"
          dependencies: ["T012"]
          acceptance_criteria:
            - "OnCommandComplete(commandName string, success bool, duration time.Duration)"
            - "OnStageComplete(stageName string, success bool)"
            - "OnError(commandName string, err error)"
            - "Each method checks config flags before sending"
            - "on_long_running only fires if duration >= threshold"
            - "Multiple hooks can fire for same event independently"
    - number: 6
      title: "User Story US-001 & US-002 - Executor Integration"
      purpose: "Hook notifications into workflow executor for command and stage completion"
      story_reference: "US-001"
      independent_test: "Run any autospec command with notifications enabled and verify notification appears"
      tasks:
        - id: "T014"
          title: "Add NotificationHandler field to Executor struct in internal/workflow/executor.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/workflow/executor.go"
          dependencies: ["T013"]
          acceptance_criteria:
            - "Executor struct has NotificationHandler *notify.NotificationHandler field"
            - "NotificationHandler initialized via Executor options or constructor"
            - "Nil handler is handled gracefully (no-op)"
        - id: "T015"
          title: "Integrate OnStageComplete notifications in executor stage completion"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/workflow/executor.go"
          dependencies: ["T014"]
          acceptance_criteria:
            - "completeStageSuccess() calls NotificationHandler.OnStageComplete()"
            - "Stage failures trigger OnError hook"
            - "Notification dispatch is non-blocking"
            - "Stage name and success status included in notification"
        - id: "T016"
          title: "Integrate OnCommandComplete notifications in CLI commands"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/run.go"
          dependencies: ["T015"]
          acceptance_criteria:
            - "Command completion triggers OnCommandComplete hook"
            - "Command duration tracked from start to finish"
            - "Success/failure status passed to handler"
            - "Works for run, prep, implement, and other commands"
        - id: "T017"
          title: "Add NotificationHandler initialization to CLI command setup"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/root.go"
          dependencies: ["T016"]
          acceptance_criteria:
            - "NotificationHandler created from loaded config"
            - "Handler passed to Executor during workflow execution"
            - "Handler respects config.Notifications.Enabled flag"
    - number: 7
      title: "User Story US-005 & US-006 - Custom Sound and Graceful Degradation"
      purpose: "Implement custom sound support and ensure graceful failure handling"
      story_reference: "US-005"
      independent_test: "Set custom sound path and verify that sound plays on notification"
      tasks:
        - id: "T018"
          title: "Implement custom sound file validation and playback in platform senders"
          status: "Pending"
          type: "implementation"
          parallel: true
          story_id: "US-005"
          file_path: "internal/notify/sender.go"
          dependencies: ["T006", "T007", "T008"]
          acceptance_criteria:
            - "Custom sound file path validated before playback"
            - "Invalid file falls back to default system sound"
            - "Warning logged when custom sound file not found"
            - "Supports common audio formats (.wav, .mp3, .aiff)"
        - id: "T019"
          title: "Implement CI environment detection for auto-disabling notifications"
          status: "Pending"
          type: "implementation"
          parallel: true
          story_id: "US-006"
          file_path: "internal/notify/handler.go"
          dependencies: ["T012"]
          acceptance_criteria:
            - "Detects CI environment variables (CI, GITHUB_ACTIONS, GITLAB_CI, etc.)"
            - "Auto-disables notifications in CI unless explicitly enabled"
            - "Detects TTY availability for interactive mode check"
            - "Debug log message when notifications skipped"
    - number: 8
      title: "Polish & Documentation"
      purpose: "Update documentation and finalize cross-cutting concerns"
      tasks:
        - id: "T020"
          title: "Add notification config examples to docs/reference.md"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "docs/reference.md"
          dependencies: ["T017"]
          acceptance_criteria:
            - "Document all notification config options"
            - "Include example YAML configurations"
            - "Document environment variable overrides"
            - "Document hook behavior and combinations"
        - id: "T021"
          title: "Add notification troubleshooting section to docs/troubleshooting.md"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "docs/troubleshooting.md"
          dependencies: ["T017"]
          acceptance_criteria:
            - "Document common notification issues per platform"
            - "Include instructions for installing notify-send on Linux"
            - "Document PowerShell execution policy workarounds"
            - "Document CI/headless environment behavior"
        - id: "T022"
          title: "Add unit tests for notification types and config in internal/notify/notify_test.go"
          status: "Pending"
          type: "test"
          parallel: true
          story_id: null
          file_path: "internal/notify/notify_test.go"
          dependencies: ["T002", "T003"]
          acceptance_criteria:
            - "Test NotificationConfig default values"
            - "Test Notification struct construction"
            - "Test type enum validation"
            - "Map-based table tests per Go best practices"
        - id: "T023"
          title: "Add unit tests for platform detection and sender in internal/notify/sender_test.go"
          status: "Pending"
          type: "test"
          parallel: true
          story_id: null
          file_path: "internal/notify/sender_test.go"
          dependencies: ["T004", "T005"]
          acceptance_criteria:
            - "Test platform detection logic"
            - "Test tool availability checks with mocked exec"
            - "Test NewSender factory returns correct platform sender"
            - "Test graceful degradation when tools unavailable"
        - id: "T024"
          title: "Add integration tests for notification handler in internal/notify/handler_test.go"
          status: "Pending"
          type: "test"
          parallel: true
          story_id: null
          file_path: "internal/notify/handler_test.go"
          dependencies: ["T012", "T013"]
          acceptance_criteria:
            - "Test hook firing based on config flags"
            - "Test on_long_running threshold logic"
            - "Test multiple hooks firing independently"
            - "Test async dispatch with timeout"
            - "Test CI environment detection"
dependencies:
    user_story_order:
        - story_id: "US-004"
          depends_on: []
          blocks: ["US-001", "US-002", "US-003"]
        - story_id: "US-003"
          depends_on: ["US-004"]
          blocks: ["US-007"]
        - story_id: "US-007"
          depends_on: ["US-003"]
          blocks: ["US-001", "US-002"]
        - story_id: "US-001"
          depends_on: ["US-007"]
          blocks: []
        - story_id: "US-002"
          depends_on: ["US-007"]
          blocks: []
        - story_id: "US-005"
          depends_on: ["US-004"]
          blocks: []
        - story_id: "US-006"
          depends_on: ["US-007"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3, 4]
        - phase: 3
          blocks: [5]
        - phase: 4
          blocks: [5]
        - phase: 5
          blocks: [6]
        - phase: 6
          blocks: [7, 8]
        - phase: 7
          blocks: [8]
parallel_execution:
    - phase: 2
      parallel_groups:
        - tasks: ["T003", "T004"]
          rationale: "Different files, independent type definitions"
    - phase: 3
      parallel_groups:
        - tasks: ["T006", "T007", "T008"]
          rationale: "Platform-specific implementations are independent"
    - phase: 7
      parallel_groups:
        - tasks: ["T018", "T019"]
          rationale: "Custom sound and CI detection are independent enhancements"
    - phase: 8
      parallel_groups:
        - tasks: ["T020", "T021"]
          rationale: "Documentation updates are independent"
        - tasks: ["T022", "T023", "T024"]
          rationale: "Test files are independent of each other"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3, 4, 5, 6]
        description: "Setup + Core Types + Platform Senders + Config + Hooks + Executor Integration"
        validation: "Run autospec command with notifications.enabled=true and verify notification appears on command completion"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "Core notification types and interfaces defined, platform detection working"
        - milestone: "Platform Support"
          phases: [1, 2, 3]
          deliverable: "Notifications working on all three platforms with visual and sound"
        - milestone: "Configuration Working"
          phases: [1, 2, 3, 4]
          deliverable: "Users can configure notifications via config files"
        - milestone: "MVP Complete"
          phases: [1, 2, 3, 4, 5, 6]
          deliverable: "Full notification system with all hooks integrated into executor"
        - milestone: "Full Feature"
          phases: [1, 2, 3, 4, 5, 6, 7, 8]
          deliverable: "Custom sounds, graceful degradation, documentation, and tests complete"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec dev"
    created: "2025-12-16T18:34:57Z"
    artifact_type: "tasks"
