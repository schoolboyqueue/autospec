feature:
  branch: "016-smart-artifact-validation"
  created: "2025-12-16"
  status: "Draft"
  input: |
    autospec artifact plan should assume current branch's spec/ folder and find the plan.yaml.
    Show in response the chosen spec (fallback to last spec if not on a spec branch - we have
    go function for this to use). IF path is provided then use that path. We should just KNOW
    its a plan schema without being given the "plan" type - because path has the filename.
    If filename DOES NOT correspond to any known generated yaml then we throw an error.

user_stories:
  - id: "US-001"
    title: "Validate artifact with minimal typing"
    priority: "P1"
    as_a: "developer using autospec"
    i_want: "to run 'autospec artifact' without specifying the artifact type or path"
    so_that: "I can quickly validate artifacts with less typing and cognitive overhead"
    why_this_priority: "This is the core pain point - users must currently specify redundant information"
    independent_test: "Run 'autospec artifact' on a spec branch and verify it validates the correct artifact"
    acceptance_scenarios:
      - given: "I am on branch '016-smart-artifact-validation'"
        when: "I run 'autospec artifact plan'"
        then: "it validates specs/016-smart-artifact-validation/plan.yaml automatically"
      - given: "I am on branch '016-smart-artifact-validation'"
        when: "I run 'autospec artifact spec'"
        then: "it validates specs/016-smart-artifact-validation/spec.yaml automatically"
      - given: "I am on a non-spec branch"
        when: "I run 'autospec artifact plan'"
        then: "it falls back to the most recently modified spec directory"

  - id: "US-002"
    title: "Validate artifact by path with auto-detected type"
    priority: "P1"
    as_a: "developer using autospec"
    i_want: "to run 'autospec artifact path/to/plan.yaml' and have the type inferred from filename"
    so_that: "I don't need to redundantly specify 'plan' when the filename is 'plan.yaml'"
    why_this_priority: "Eliminates redundant information that creates friction"
    independent_test: "Run 'autospec artifact specs/001/plan.yaml' and verify plan schema validation"
    acceptance_scenarios:
      - given: "I have a valid plan.yaml file"
        when: "I run 'autospec artifact specs/016/plan.yaml'"
        then: "it infers the 'plan' type and validates against the plan schema"
      - given: "I have a valid spec.yaml file"
        when: "I run 'autospec artifact specs/016/spec.yaml'"
        then: "it infers the 'spec' type and validates against the spec schema"
      - given: "I have a valid tasks.yaml file"
        when: "I run 'autospec artifact specs/016/tasks.yaml'"
        then: "it infers the 'tasks' type and validates against the tasks schema"

  - id: "US-003"
    title: "Error on unknown artifact filenames"
    priority: "P1"
    as_a: "developer using autospec"
    i_want: "to receive a clear error when I try to validate an unrecognized file"
    so_that: "I understand why validation failed and what files are supported"
    why_this_priority: "Clear errors are essential for good CLI UX"
    independent_test: "Run 'autospec artifact random.yaml' and verify error message"
    acceptance_scenarios:
      - given: "I have a file named 'config.yaml'"
        when: "I run 'autospec artifact config.yaml'"
        then: "it shows an error listing supported filenames (spec.yaml, plan.yaml, tasks.yaml)"
      - given: "I have a file named 'myspec.yaml'"
        when: "I run 'autospec artifact myspec.yaml'"
        then: "it shows an error explaining only spec.yaml, plan.yaml, tasks.yaml are recognized"

  - id: "US-004"
    title: "Display detected spec in output"
    priority: "P2"
    as_a: "developer using autospec"
    i_want: "to see which spec directory was auto-detected in the validation output"
    so_that: "I can confirm the correct spec is being validated, especially on fallback"
    why_this_priority: "Important for trust and debugging, but not blocking core functionality"
    independent_test: "Run 'autospec artifact plan' and verify output shows detected spec path"
    acceptance_scenarios:
      - given: "I am on branch '016-smart-artifact-validation'"
        when: "I run 'autospec artifact plan'"
        then: "the output includes 'Using spec: 016-smart-artifact-validation'"
      - given: "I am on a non-spec branch and spec 015 was most recently modified"
        when: "I run 'autospec artifact plan'"
        then: "the output includes 'Using spec: 015-artifact-validation (fallback)'"

requirements:
  functional:
    - id: "FR-001"
      description: "MUST detect current spec from git branch name when no path is provided"
      testable: true
      acceptance_criteria: "Running 'autospec artifact <type>' on branch 'NNN-name' validates specs/NNN-name/<type>.yaml"
    - id: "FR-002"
      description: "MUST fall back to most recently modified spec directory when branch detection fails"
      testable: true
      acceptance_criteria: "Running 'autospec artifact <type>' on 'main' branch validates the most recent spec"
    - id: "FR-003"
      description: "MUST infer artifact type from filename when path is provided"
      testable: true
      acceptance_criteria: "Running 'autospec artifact path/to/plan.yaml' validates against plan schema"
    - id: "FR-004"
      description: "MUST error with helpful message when filename is not recognized"
      testable: true
      acceptance_criteria: "Error message lists valid filenames: spec.yaml, plan.yaml, tasks.yaml"
    - id: "FR-005"
      description: "MUST display the detected spec name/path in validation output"
      testable: true
      acceptance_criteria: "Output includes 'Using spec: <name>' before validation results"
    - id: "FR-006"
      description: "MUST support --schema flag with type-only argument"
      testable: true
      acceptance_criteria: "'autospec artifact plan --schema' shows plan schema"
    - id: "FR-007"
      description: "MUST support --fix flag with auto-detected or explicit path"
      testable: true
      acceptance_criteria: "'autospec artifact plan --fix' auto-fixes current spec's plan.yaml"
  non_functional:
    - id: "NFR-001"
      category: "usability"
      description: "Command syntax must require minimal keystrokes for common operations"
      measurable_target: "'autospec artifact plan' (19 chars) vs 'autospec artifact plan specs/NNN-name/plan.yaml' (50+ chars)"
    - id: "NFR-002"
      category: "reliability"
      description: "Fallback detection must work consistently across different git states"
      measurable_target: "100% success rate for fallback when specs/ directory exists with at least one spec"

success_criteria:
  measurable_outcomes:
    - id: "SC-001"
      description: "Users can validate the current spec's artifacts with 50% fewer keystrokes"
      metric: "Character count for common validation command"
      target: "From ~50 characters to ~20 characters for branch-based validation"
    - id: "SC-002"
      description: "Users can validate by path without specifying type"
      metric: "Number of required arguments for path-based validation"
      target: "From 2 arguments (type + path) to 1 argument (path only)"
    - id: "SC-003"
      description: "Clear feedback on which spec is being validated"
      metric: "Presence of spec identification in output"
      target: "100% of validation runs show which spec is being used"

key_entities:
  - name: "Artifact"
    description: "A YAML file representing a spec, plan, or tasks definition"
    attributes:
      - "type (spec|plan|tasks)"
      - "path (filesystem location)"
      - "filename (spec.yaml, plan.yaml, tasks.yaml)"
  - name: "Spec Directory"
    description: "A numbered directory in specs/ containing feature artifacts"
    attributes:
      - "number (NNN prefix)"
      - "name (kebab-case identifier)"
      - "path (specs/NNN-name/)"
  - name: "Detection Context"
    description: "Information used to auto-detect the current spec"
    attributes:
      - "git branch name"
      - "most recently modified spec (fallback)"

edge_cases:
  - scenario: "No specs/ directory exists"
    expected_behavior: "Error with helpful message: 'No specs directory found. Run autospec specify first.'"
  - scenario: "Branch name doesn't match any spec directory"
    expected_behavior: "Fall back to most recently modified spec and indicate fallback in output"
  - scenario: "Artifact file doesn't exist in detected spec directory"
    expected_behavior: "Error with message: 'plan.yaml not found in specs/016-smart-artifact-validation/'"
  - scenario: "Empty specs/ directory (no spec subdirectories)"
    expected_behavior: "Error with helpful message: 'No spec directories found in specs/'"
  - scenario: "User provides path with wrong extension (e.g., plan.yml instead of plan.yaml)"
    expected_behavior: "Attempt to infer from base filename, or show error if unrecognized"
  - scenario: "User runs 'autospec artifact' with no arguments"
    expected_behavior: "Show help message explaining usage options"

assumptions:
  - "The existing spec detection logic (DetectCurrentSpec) is available and reliable"
  - "Artifact filenames follow the convention: spec.yaml, plan.yaml, tasks.yaml"
  - "The --schema and --fix flags should continue to work with the new syntax"
  - "Backward compatibility with explicit type+path syntax is desirable but not required"

constraints:
  - "Must use existing DetectCurrentSpec() function from internal/spec/ package"
  - "Must maintain existing validation infrastructure and error handling"
  - "CLI interface is via Cobra commands"

out_of_scope:
  - "Validating multiple artifacts in a single command"
  - "Creating new artifact types beyond spec/plan/tasks"
  - "Changing the artifact file naming convention"
  - "Auto-detection based on file content rather than filename"

_meta:
  version: "1.0.0"
  generator: "autospec"
  generator_version: "autospec dev"
  created: "2025-12-16T03:21:11Z"
  artifact_type: "spec"
