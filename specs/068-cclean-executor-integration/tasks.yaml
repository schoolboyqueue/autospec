tasks:
    branch: "068-cclean-executor-integration"
    created: "2025-12-20"
    spec_path: "specs/068-cclean-executor-integration/spec.yaml"
    plan_path: "specs/068-cclean-executor-integration/plan.yaml"
summary:
    total_tasks: 18
    total_phases: 6
    parallel_opportunities: 4
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Verify cclean dependency is available and understand its API"
      tasks:
        - id: "T001"
          title: "Verify cclean v0.2.0 dependency in go.mod"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "go.mod"
          dependencies: []
          acceptance_criteria:
            - "github.com/ariel-frischer/claude-clean v0.2.0 present in go.mod"
            - "go mod tidy completes without errors"
    - number: 2
      title: "Foundational - OutputStyle Type"
      purpose: "Define OutputStyle type and validation (blocking for all user stories)"
      tasks:
        - id: "T002"
          title: "Create OutputStyle type with validation in internal/config/output_style.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/config/output_style.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "OutputStyle string type defined"
            - "Constants for default, compact, minimal, plain, raw"
            - "ValidateOutputStyle(string) error function"
            - "Error message lists valid options"
        - id: "T003"
          title: "Add unit tests for OutputStyle validation in internal/config/output_style_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/config/output_style_test.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "Table-driven tests with t.Parallel()"
            - "Tests for all 5 valid styles"
            - "Tests for invalid style values"
            - "Tests for empty string"
        - id: "T004"
          title: "Add output_style field to Configuration struct in internal/config/config.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/config/config.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "OutputStyle field added with yaml tag"
            - "GetDefaults returns 'default' for output_style"
            - "GetDefaultConfigTemplate includes output_style with comment"
            - "Validation integrates with existing config validation"
    - number: 3
      title: "User Story 1 - Zero-configuration output formatting (US-001)"
      purpose: "Users see formatted output automatically without any configuration"
      story_reference: "US-001"
      independent_test: "Run autospec implement with default config, verify output is formatted with box-drawing and colors"
      tasks:
        - id: "T005"
          title: "Create StreamFormatter struct in internal/workflow/formatter.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/workflow/formatter.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "StreamFormatter struct with style field"
            - "NewStreamFormatter(style OutputStyle, writer io.Writer) constructor"
            - "Maps OutputStyle to cclean display.Config"
            - "ProcessLine(line string) method parses JSONL via cclean parser"
            - "FormatAndWrite(msg) method displays via cclean display"
            - "Uses parser.StripSystemReminders for non-raw styles"
        - id: "T006"
          title: "Add unit tests for StreamFormatter in internal/workflow/formatter_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/workflow/formatter_test.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Table-driven tests with t.Parallel()"
            - "Test with sample valid JSONL lines"
            - "Test parsing of different message types"
            - "Test output style mapping to cclean config"
            - "Test system reminder stripping"
        - id: "T007"
          title: "Add OutputStyle field to ClaudeExecutor in internal/workflow/claude.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/workflow/claude.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "OutputStyle field on ClaudeExecutor struct"
            - "detectStreamJsonMode() helper checking for --output-format stream-json and -p flags"
            - "Supports both long (--output-format) and short (-o) forms"
        - id: "T008"
          title: "Integrate StreamFormatter in Execute/StreamCommand methods"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/workflow/claude.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "When stream-json + headless detected, wrap stdout with StreamFormatter"
            - "Real-time line-by-line processing maintained"
            - "Non-stream-json output passed through unchanged"
            - "Raw style bypasses all formatting"
        - id: "T009"
          title: "Add integration tests for stream-json detection in internal/workflow/claude_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/workflow/claude_test.go"
          dependencies: ["T008"]
          acceptance_criteria:
            - "Test detects --output-format stream-json with -p"
            - "Test detects -o stream-json with -p"
            - "Test skips formatting when -p absent"
            - "Test skips formatting for non-stream-json modes"
    - number: 4
      title: "User Story 4 - Graceful fallback on parse errors (US-004)"
      purpose: "Malformed output lines displayed as-is rather than lost"
      story_reference: "US-004"
      independent_test: "Inject malformed JSONL line, verify it appears in output as raw text"
      tasks:
        - id: "T010"
          title: "Add fallback to raw output on parse errors in StreamFormatter"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/workflow/formatter.go"
          dependencies: ["T009"]
          acceptance_criteria:
            - "ProcessLine returns raw line when JSON parsing fails"
            - "No error thrown for malformed input"
            - "Empty lines silently skipped"
            - "Non-UTF8 bytes handled gracefully"
        - id: "T011"
          title: "Add fallback tests in internal/workflow/formatter_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-004"
          file_path: "internal/workflow/formatter_test.go"
          dependencies: ["T010"]
          acceptance_criteria:
            - "Test malformed JSON input prints raw"
            - "Test empty line handling"
            - "Test mix of valid and invalid lines"
            - "Test partial/truncated JSON"
    - number: 5
      title: "User Stories 2 & 3 - Output style configuration and CLI override (US-002, US-003)"
      purpose: "Users can configure output style globally and override per-command"
      story_reference: "US-002, US-003"
      independent_test: "Set global config to one style, run with --output-style flag for different style, verify flag wins"
      tasks:
        - id: "T012"
          title: "Add --output-style persistent flag to root command in internal/cli/root.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cli/root.go"
          dependencies: ["T011"]
          acceptance_criteria:
            - "--output-style flag added as persistent flag"
            - "Help text lists valid options: default, compact, minimal, plain, raw"
            - "Flag registered with validation"
        - id: "T013"
          title: "Pass output_style to orchestrator from stage commands"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-002"
          file_path: "internal/cli/stages/*.go"
          dependencies: ["T012"]
          acceptance_criteria:
            - "specify, plan, tasks, clarify, analyze, checklist, constitution commands read --output-style"
            - "Flag value passed to orchestrator"
            - "CLI flag takes precedence over config file"
        - id: "T014"
          title: "Pass output_style to orchestrator from run/prep/all/implement commands"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-002"
          file_path: "internal/cli/run.go"
          dependencies: ["T012"]
          acceptance_criteria:
            - "run, prep, all, implement commands read --output-style"
            - "Flag value passed to orchestrator"
            - "CLI flag takes precedence over config file"
        - id: "T015"
          title: "Add orchestrator support for output_style to ClaudeExecutor"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/workflow/orchestrator.go"
          dependencies: ["T013", "T014"]
          acceptance_criteria:
            - "Orchestrator accepts output_style parameter"
            - "Sets OutputStyle on ClaudeExecutor before execution"
            - "Respects precedence: CLI flag > config file > default"
        - id: "T016"
          title: "Add integration tests for flag precedence"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-003"
          file_path: "internal/cli/stages/implement_test.go"
          dependencies: ["T015"]
          acceptance_criteria:
            - "Test CLI flag overrides config file value"
            - "Test default used when neither set"
            - "Test each of 5 styles produces distinct output"
    - number: 6
      title: "Polish & Documentation"
      purpose: "Update documentation and verify all quality gates pass"
      tasks:
        - id: "T017"
          title: "Update docs/cclean.md with native integration documentation"
          status: "Completed"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "docs/cclean.md"
          dependencies: ["T016"]
          acceptance_criteria:
            - "Document output_style configuration option"
            - "Document --output-style CLI flag"
            - "Document each of 5 styles with example output"
            - "Document precedence rules (CLI > config > default)"
        - id: "T018"
          title: "Run all quality gates: make test, make fmt, make lint, make build"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "Makefile"
          dependencies: ["T017"]
          acceptance_criteria:
            - "make test passes with no failures"
            - "make fmt produces no changes"
            - "make lint reports no errors"
            - "make build succeeds"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-004"]
        - story_id: "US-004"
          depends_on: ["US-001"]
          blocks: ["US-002", "US-003"]
        - story_id: "US-002"
          depends_on: ["US-004"]
          blocks: []
        - story_id: "US-003"
          depends_on: ["US-002"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3]
        - phase: 3
          blocks: [4]
        - phase: 4
          blocks: [5]
        - phase: 5
          blocks: [6]
parallel_execution:
    - phase: 5
      parallel_groups:
        - tasks: ["T013", "T014"]
          rationale: "Different command files, no dependencies between them"
    - phase: 6
      parallel_groups:
        - tasks: ["T017", "T018"]
          rationale: "Documentation and quality gates can proceed independently initially"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Foundational + US-001 (zero-config formatting)"
        validation: "Run autospec implement with default config, verify formatted output appears"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "OutputStyle type and validation available for use"
        - milestone: "MVP Complete"
          phases: [1, 2, 3]
          deliverable: "Zero-configuration formatted output working with default style"
        - milestone: "Error Handling Complete"
          phases: [1, 2, 3, 4]
          deliverable: "Graceful fallback for malformed output"
        - milestone: "Full Feature Complete"
          phases: [1, 2, 3, 4, 5]
          deliverable: "All styles configurable via config and CLI flags"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec dev"
    created: "2025-12-20T09:35:35Z"
    artifact_type: "tasks"
