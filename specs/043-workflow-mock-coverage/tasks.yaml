tasks:
    branch: "043-workflow-mock-coverage"
    created: "2025-12-18"
    spec_path: "specs/043-workflow-mock-coverage/spec.yaml"
    plan_path: "specs/043-workflow-mock-coverage/plan.yaml"
summary:
    total_tasks: 18
    total_phases: 6
    parallel_opportunities: 8
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Verify existing test infrastructure and baseline coverage"
      tasks:
        - id: "T001"
          title: "Verify baseline coverage in internal/workflow/"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/workflow/"
          dependencies: []
          acceptance_criteria:
            - "Run 'go test -cover ./internal/workflow/' and record baseline (expected ~79.4%)"
            - "Document functions with 0% coverage for targeting"
            - "Confirm mock-claude.sh and MockClaudeExecutor are functional"
    - number: 2
      title: "Foundational"
      purpose: "Verify mock infrastructure is ready for integration tests"
      tasks:
        - id: "T002"
          title: "Verify newTestOrchestratorWithSpecName() helper in workflow_test.go"
          status: "Completed"
          type: "setup"
          parallel: true
          story_id: null
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Helper function exists and creates properly configured orchestrator"
            - "Helper works with MockClaudeExecutor for isolated tests"
            - "Helper can be used with mock-claude.sh for integration tests"
        - id: "T003"
          title: "Verify mock-claude.sh artifact generation via MOCK_ARTIFACT_DIR"
          status: "Completed"
          type: "setup"
          parallel: true
          story_id: null
          file_path: "test/mock-claude.sh"
          dependencies: ["T001"]
          acceptance_criteria:
            - "MOCK_ARTIFACT_DIR triggers artifact generation"
            - "Generated artifacts (spec.yaml, plan.yaml, tasks.yaml) are valid"
            - "MOCK_EXIT_CODE and MOCK_CALL_LOG work as expected"
    - number: 3
      title: "US-001/US-002 - Integration Tests for Core Methods"
      purpose: "Add tests that actually call executeSingleTaskSession, executeSinglePhaseSession, executeAndVerifyTask, executeTaskLoop"
      story_reference: "US-001, US-002"
      independent_test: "Run 'go test -v ./internal/workflow/ -run Integration' and verify coverage increases for target functions"
      tasks:
        - id: "T004"
          title: "Add TestExecuteSingleTaskSession_Integration in workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T002", "T003"]
          acceptance_criteria:
            - "Test creates orchestrator using newTestOrchestratorWithSpecName()"
            - "Test sets up valid tasks.yaml with at least one pending task"
            - "Test actually calls executeSingleTaskSession (not just string formatting)"
            - "Test verifies task state changes from Pending to Completed/InProgress"
            - "Coverage for executeSingleTaskSession increases from 0% to >80%"
        - id: "T005"
          title: "Add TestExecuteSinglePhaseSession_Integration in workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "Test creates orchestrator using newTestOrchestratorWithSpecName()"
            - "Test sets up tasks.yaml with multiple tasks in a single phase"
            - "Test actually calls executeSinglePhaseSession"
            - "Test verifies phase completion based on task states"
            - "Coverage for executeSinglePhaseSession increases from 0% to >80%"
        - id: "T006"
          title: "Add TestExecuteAndVerifyTask_Integration in workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Test loads task from tasks.yaml using validation.GetAllTasks()"
            - "Test calls executeAndVerifyTask with valid task"
            - "Test verifies task state change and artifact creation"
            - "Coverage for executeAndVerifyTask increases from 0% to >80%"
        - id: "T007"
          title: "Add TestExecuteTaskLoop_Integration in workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Test sets up task list with mixed states (Pending, Completed)"
            - "Test calls executeTaskLoop"
            - "Test verifies only pending tasks are executed"
            - "Test verifies loop exits correctly on completion or error"
            - "Coverage for executeTaskLoop increases to >60%"
        - id: "T008"
          title: "Verify coverage increase to ~82% after Phase 3 tests"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/workflow/"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Run 'go test -cover ./internal/workflow/'"
            - "Coverage is at least 82%"
            - "All new tests pass consistently (run 3 times)"
    - number: 4
      title: "US-003 - Stdin Input Testing via io.Reader"
      purpose: "Add PromptUserToContinueWithReader variant for testable stdin input"
      story_reference: "US-003"
      independent_test: "Run 'go test -v ./internal/workflow/ -run PromptUser' and verify coverage for PromptUserToContinue functions"
      tasks:
        - id: "T009"
          title: "Add PromptUserToContinueWithReader(reader io.Reader) in preflight.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/workflow/preflight.go"
          dependencies: ["T008"]
          acceptance_criteria:
            - "New function PromptUserToContinueWithReader(reader io.Reader) (bool, error) exists"
            - "Original PromptUserToContinue() delegates to new function with os.Stdin"
            - "Function handles y/n/yes/no/empty inputs correctly"
            - "Function handles EOF gracefully (returns false, nil)"
            - "Function wraps read errors with context"
        - id: "T010"
          title: "Add TestPromptUserToContinue_WithReader in preflight_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-003"
          file_path: "internal/workflow/preflight_test.go"
          dependencies: ["T009"]
          acceptance_criteria:
            - "Test uses map-based table-driven pattern"
            - "Test covers inputs: 'y', 'n', 'yes', 'no', 'Y', 'N', '', EOF"
            - "Test covers error path with failing reader"
            - "Coverage for PromptUserToContinue* increases from 0% to >80%"
    - number: 5
      title: "US-004 - Preflight Checks via Dependency Injection"
      purpose: "Create PreflightChecker interface and MockPreflightChecker for testability"
      story_reference: "US-004"
      independent_test: "Run 'go test -v ./internal/workflow/ -run Preflight' and verify runPreflightChecks coverage increases"
      tasks:
        - id: "T011"
          title: "Define PreflightChecker interface in preflight.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/workflow/preflight.go"
          dependencies: ["T010"]
          acceptance_criteria:
            - "PreflightChecker interface with RunChecks() and PromptUser() methods"
            - "Interface follows accept-interfaces-return-concrete pattern"
            - "Existing DefaultPreflightChecker implements the interface"
        - id: "T012"
          title: "Add optional PreflightChecker field to WorkflowOrchestrator in workflow.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/workflow/workflow.go"
          dependencies: ["T011"]
          acceptance_criteria:
            - "WorkflowOrchestrator has optional PreflightChecker field"
            - "runPreflightChecks uses injected checker if present, else default"
            - "Nil-safe: existing code works unchanged with nil checker"
            - "No changes to public API or existing constructor"
        - id: "T013"
          title: "Add MockPreflightChecker to mocks_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-004"
          file_path: "internal/workflow/mocks_test.go"
          dependencies: ["T012"]
          acceptance_criteria:
            - "mockPreflightChecker implements PreflightChecker interface"
            - "Has configurable RunChecksResult, RunChecksError, PromptUserResult"
            - "Tracks call counts for verification"
        - id: "T014"
          title: "Add TestRunPreflightChecks_WithMock in preflight_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-004"
          file_path: "internal/workflow/preflight_test.go"
          dependencies: ["T013"]
          acceptance_criteria:
            - "Test uses MockPreflightChecker injection"
            - "Test covers pass scenario (all checks green)"
            - "Test covers warn scenario (user prompted)"
            - "Test covers fail scenario (error returned)"
            - "Coverage for runPreflightChecks increases from 0% to >80%"
    - number: 6
      title: "Polish - Edge Cases and Final Coverage"
      purpose: "Cover remaining edge cases for startProgressDisplay, CleanupContextFile, and reach 85% target"
      tasks:
        - id: "T015"
          title: "Add TestStartProgressDisplay_EdgeCases in workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: null
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T014"]
          acceptance_criteria:
            - "Test verifies nil ProgressDisplay doesn't panic"
            - "Test verifies warning printed on error path"
            - "Coverage for startProgressDisplay increases"
        - id: "T016"
          title: "Add TestCleanupContextFile_EdgeCases in workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: null
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T014"]
          acceptance_criteria:
            - "Test verifies non-existent file returns nil (idempotent)"
            - "Test verifies error handling for permission issues"
            - "Coverage for CleanupContextFile increases"
        - id: "T017"
          title: "Add TestExecuteTaskLoop_EdgeCases in workflow_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: null
          file_path: "internal/workflow/workflow_test.go"
          dependencies: ["T014"]
          acceptance_criteria:
            - "Test covers empty task list (returns nil immediately)"
            - "Test covers all tasks already completed (skips all)"
            - "Test covers all tasks blocked by dependencies"
        - id: "T018"
          title: "Verify final coverage >= 85% and all quality gates pass"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/workflow/"
          dependencies: ["T015", "T016", "T017"]
          acceptance_criteria:
            - "Run 'go test -cover ./internal/workflow/' shows >= 85.0%"
            - "Run 'make test' passes"
            - "Run 'make fmt' shows no changes"
            - "Run 'make lint' passes"
            - "Run 'make build' succeeds"
            - "Run test suite 3 times with no flakiness"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-003", "US-004"]
        - story_id: "US-002"
          depends_on: []
          blocks: []
        - story_id: "US-003"
          depends_on: ["US-001"]
          blocks: []
        - story_id: "US-004"
          depends_on: ["US-001", "US-003"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3]
        - phase: 3
          blocks: [4, 5]
        - phase: 4
          blocks: [5]
        - phase: 5
          blocks: [6]
parallel_execution:
    - phase: 2
      parallel_groups:
        - tasks: ["T002", "T003"]
          rationale: "Independent verification of different mock infrastructure components"
    - phase: 6
      parallel_groups:
        - tasks: ["T015", "T016", "T017"]
          rationale: "Independent edge case tests for different functions"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Foundational + Integration tests for core methods"
        validation: "Coverage reaches ~82%, core methods have >60% individual coverage"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "Verified mock infrastructure; ready to write integration tests"
        - milestone: "Core Coverage Achieved"
          phases: [1, 2, 3]
          deliverable: "82% coverage; executeSingleTaskSession, executeSinglePhaseSession, executeAndVerifyTask, executeTaskLoop tested"
        - milestone: "Stdin Testing Enabled"
          phases: [1, 2, 3, 4]
          deliverable: "PromptUserToContinue testable via io.Reader; ~83% coverage"
        - milestone: "Full DI and 85% Target"
          phases: [1, 2, 3, 4, 5, 6]
          deliverable: "PreflightChecker interface; all edge cases covered; >= 85% coverage"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec dev"
    created: "2025-12-18T04:04:01Z"
    artifact_type: "tasks"
