tasks:
    branch: "066-worktree-setup-generator"
    created: "2025-12-20"
    spec_path: "specs/066-worktree-setup-generator/spec.yaml"
    plan_path: "specs/066-worktree-setup-generator/plan.yaml"
summary:
    total_tasks: 9
    total_phases: 5
    parallel_opportunities: 2
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Verify existing worktree command structure and prepare integration points"
      tasks:
        - id: "T001"
          title: "Verify existing worktree command structure in internal/cli/worktree/"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/cli/worktree/worktree.go"
          dependencies: []
          acceptance_criteria:
            - "Confirm worktree.go exists with parent command definition"
            - "Identify registration pattern for subcommands"
            - "Verify existing subcommands: create, list, remove, setup, prune"
    - number: 2
      title: "Foundational - Claude Command Template"
      purpose: "Create the project-agnostic Claude command template that generates setup scripts"
      tasks:
        - id: "T002"
          title: "Create Claude command template at internal/commands/autospec.worktree-setup.md"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/commands/autospec.worktree-setup.md"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Template has proper frontmatter with description and invocation"
            - "Template is project-agnostic (no MCP tools, no Claude Code tools, no autospec paths per PRIN-012)"
            - "Template instructs Claude to detect package managers (npm/yarn/pnpm, go mod, pip/poetry, cargo)"
            - "Template specifies secret exclusion patterns (.env*, credentials.*, *.pem, *.key)"
            - "Template specifies dependency directory exclusions (node_modules, vendor, __pycache__, .venv)"
            - "Template specifies essential inclusions (.autospec/, .claude/)"
            - "Template defines output script format with POSIX-compatible bash"
            - "Template accepts --include-env context for optional secret copying"
    - number: 3
      title: "User Story 1-4,6 - CLI Command Implementation"
      purpose: "Implement gen-script subcommand with flag handling and Claude invocation"
      story_reference: "US-001, US-002, US-003, US-004, US-006"
      independent_test: "Run 'autospec worktree gen-script' and verify .autospec/scripts/setup-worktree.sh is created"
      tasks:
        - id: "T003"
          title: "Create gen_script_test.go with unit tests for gen-script command"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-004"
          file_path: "internal/cli/worktree/gen_script_test.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "Uses map-based table-driven test pattern with t.Parallel()"
            - "Tests command registration under worktree parent"
            - "Tests --include-env flag parsing"
            - "Tests overwrite confirmation behavior"
            - "Tests error handling for non-git-repo scenarios"
        - id: "T004"
          title: "Implement gen_script.go CLI command with Claude invocation"
          status: "InProgress"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/cli/worktree/gen_script.go"
          dependencies: ["T003"]
          acceptance_criteria:
            - "Command registered as 'gen-script' under worktree parent"
            - "Uses lifecycle.RunWithHistory for notifications and history logging"
            - "Invokes Claude with autospec.worktree-setup template"
            - "Passes --include-env flag context to Claude if specified"
            - "Creates .autospec/scripts/ directory if missing"
            - "Sets script permissions to 0755 (executable)"
            - "Prompts for overwrite confirmation if script exists"
            - "Functions under 40 lines with extracted helpers"
            - "Errors wrapped with context (no bare return err)"
        - id: "T005"
          title: "Register gen-script command in internal/cli/worktree/worktree.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/cli/worktree/worktree.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "NewGenScriptCmd() called and added to parent command"
            - "Command appears in 'autospec worktree --help' output"
    - number: 4
      title: "User Story 5 - Optional Environment File Inclusion"
      purpose: "Implement --include-env flag for explicit secret copying opt-in"
      story_reference: "US-005"
      independent_test: "Run 'autospec worktree gen-script --include-env' and verify warning is displayed"
      tasks:
        - id: "T006"
          title: "Add --include-env flag handling with security warning"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-005"
          file_path: "internal/cli/worktree/gen_script.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "--include-env flag defined as persistent bool flag"
            - "When flag is set, prints warning about security implications"
            - "Flag value passed to Claude template as context"
            - "Warning message clearly states secrets will be copied"
        - id: "T007"
          title: "Add test cases for --include-env flag behavior"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-005"
          file_path: "internal/cli/worktree/gen_script_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Test --include-env flag is recognized"
            - "Test warning message output when flag is set"
            - "Test flag value passed correctly in context"
    - number: 5
      title: "Polish & Documentation"
      purpose: "Complete documentation and quality gates"
      tasks:
        - id: "T008"
          title: "Update docs/worktree.md with gen-script command documentation"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "docs/worktree.md"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Documents 'autospec worktree gen-script' command"
            - "Explains --include-env flag and security implications"
            - "Shows example usage and generated script location"
            - "Documents relationship to 'autospec worktree create' command"
        - id: "T009"
          title: "Run quality gates: make test, make fmt, make lint, make build"
          status: "Pending"
          type: "refactor"
          parallel: false
          story_id: null
          file_path: "Makefile"
          dependencies: ["T008"]
          acceptance_criteria:
            - "make test passes with all tests green"
            - "make fmt produces no changes"
            - "make lint produces no errors"
            - "make build succeeds"
            - "No bare 'return err' in new code"
            - "All new functions under 40 lines"
dependencies:
    user_story_order:
        - story_id: "US-004"
          depends_on: []
          blocks: ["US-001", "US-002", "US-003", "US-006"]
        - story_id: "US-001"
          depends_on: ["US-004"]
          blocks: []
        - story_id: "US-002"
          depends_on: ["US-004"]
          blocks: []
        - story_id: "US-003"
          depends_on: ["US-004"]
          blocks: []
        - story_id: "US-006"
          depends_on: ["US-004"]
          blocks: []
        - story_id: "US-005"
          depends_on: ["US-004"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3]
        - phase: 3
          blocks: [4]
        - phase: 4
          blocks: [5]
parallel_execution:
    - phase: 5
      parallel_groups:
        - tasks: ["T008", "T009"]
          rationale: "Documentation and quality gates can be started together; final verification after docs"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Template + CLI Command - generates working setup scripts"
        validation: "Run 'autospec worktree gen-script' on a Node.js project and verify script includes npm install"
    incremental_delivery:
        - milestone: "Template Ready"
          phases: [1, 2]
          deliverable: "Claude command template can be invoked manually to generate scripts"
        - milestone: "CLI Integration"
          phases: [1, 2, 3]
          deliverable: "Full CLI experience with 'autospec worktree gen-script'"
        - milestone: "Feature Complete"
          phases: [1, 2, 3, 4, 5]
          deliverable: "--include-env support, documentation, all quality gates passing"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec dev"
    created: "2025-12-20T01:57:27Z"
    artifact_type: "tasks"
