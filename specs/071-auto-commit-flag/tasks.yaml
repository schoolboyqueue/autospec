tasks:
    branch: "071-auto-commit-flag"
    created: "2025-12-21"
    spec_path: "specs/071-auto-commit-flag/spec.yaml"
    plan_path: "specs/071-auto-commit-flag/plan.yaml"
summary:
    total_tasks: 24
    total_phases: 8
    parallel_opportunities: 8
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Add go-git dependency required for git state capture"
      tasks:
        - id: "T001"
          title: "Add go-git dependency to go.mod"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "go.mod"
          dependencies: []
          acceptance_criteria:
            - "github.com/go-git/go-git/v5 is added to go.mod with version >=5.11.0"
            - "go mod tidy succeeds without errors"
    - number: 2
      title: "Foundational - Configuration"
      purpose: "Add auto_commit config field with schema, defaults, and environment variable support"
      tasks:
        - id: "T002"
          title: "Add AutoCommit field to Configuration struct in internal/config/config.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/config/config.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "AutoCommit field added with type bool and koanf tag 'auto_commit'"
            - "Field follows existing Configuration struct patterns"
        - id: "T003"
          title: "Add auto_commit schema entry to KnownKeys map in internal/config/schema.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/config/schema.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "auto_commit key added to KnownKeys map"
            - "Type set to TypeBool"
            - "Appropriate description provided"
        - id: "T004"
          title: "Set auto_commit default to true in GetDefaults() in internal/config/defaults.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/config/defaults.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "auto_commit defaults to true"
            - "Default follows FR-007 requirement"
        - id: "T005"
          title: "Add tests for auto_commit config parsing in internal/config/config_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/config/config_test.go"
          dependencies: ["T002", "T003", "T004"]
          acceptance_criteria:
            - "Tests cover YAML parsing of auto_commit: true and auto_commit: false"
            - "Tests cover AUTOSPEC_AUTO_COMMIT environment variable override"
            - "Tests verify default value is true"
            - "Tests use map-based table-driven pattern with t.Parallel()"
    - number: 3
      title: "Foundational - Git State Capture"
      purpose: "Implement go-git based state capture for before/after workflow comparison"
      tasks:
        - id: "T006"
          title: "Create GitState struct and CaptureGitState function in internal/git/state.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/git/state.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "GitState struct with CommitSHA, BranchName, CapturedAt fields"
            - "CaptureGitState(repoPath string) (*GitState, error) function using go-git"
            - "Handles detached HEAD state by setting BranchName to 'detached'"
            - "Returns error only for fatal conditions (not for detached HEAD)"
        - id: "T007"
          title: "Implement CompareGitStates function in internal/git/state.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/git/state.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "CompareGitStates(initial, final *GitState) []string returns warning messages"
            - "Detects branch switch and returns serious warning"
            - "Detects no new commit when auto-commit was expected"
            - "Returns empty slice when commit was created successfully"
        - id: "T008"
          title: "Add tests for git state capture using in-memory go-git repos in internal/git/state_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/git/state_test.go"
          dependencies: ["T006", "T007"]
          acceptance_criteria:
            - "Tests use go-git in-memory storage (memory.NewStorage)"
            - "Tests do NOT touch local .git directory"
            - "Tests cover normal branch state capture"
            - "Tests cover detached HEAD state"
            - "Tests cover state comparison scenarios"
            - "Tests use map-based table-driven pattern with t.Parallel()"
    - number: 4
      title: "Foundational - Auto-Commit Instructions"
      purpose: "Create instruction template for agent prompt injection"
      tasks:
        - id: "T009"
          title: "Create auto-commit instruction template and BuildAutoCommitInstructions in internal/workflow/autocommit.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/workflow/autocommit.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Instruction template covers .gitignore guidance for common patterns"
            - "Template covers staging rules for appropriate files"
            - "Template specifies conventional commit format: type(scope): description"
            - "BuildAutoCommitInstructions() string function returns formatted instructions"
        - id: "T010"
          title: "Add tests for instruction generation in internal/workflow/autocommit_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/workflow/autocommit_test.go"
          dependencies: ["T009"]
          acceptance_criteria:
            - "Tests verify instruction content includes .gitignore guidance"
            - "Tests verify instruction content includes staging rules"
            - "Tests verify instruction content includes conventional commit format"
            - "Tests are agent-agnostic (no Claude-specific content)"
    - number: 5
      title: "User Story 1 - Auto-commit changes after workflow completion"
      purpose: "Enable automatic git commit creation after workflow sessions"
      story_reference: "US-001"
      independent_test: "Run a workflow command with the auto-commit flag enabled and verify a commit is created with proper conventional commit format"
      tasks:
        - id: "T011"
          title: "Add --auto-commit and --no-auto-commit flags to internal/cli/stages/specify.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/cli/stages/specify.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "--auto-commit flag added with appropriate help text"
            - "--no-auto-commit flag added with appropriate help text"
            - "Flags marked mutually exclusive with MarkFlagsMutuallyExclusive()"
            - "Flag-to-config resolution using cmd.Flags().Changed() pattern"
        - id: "T012"
          title: "Add --auto-commit and --no-auto-commit flags to internal/cli/stages/plan.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/cli/stages/plan.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "--auto-commit flag added with appropriate help text"
            - "--no-auto-commit flag added with appropriate help text"
            - "Flags marked mutually exclusive"
            - "Flag-to-config resolution using Changed() pattern"
        - id: "T013"
          title: "Add --auto-commit and --no-auto-commit flags to internal/cli/stages/tasks.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/cli/stages/tasks.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "--auto-commit flag added with appropriate help text"
            - "--no-auto-commit flag added with appropriate help text"
            - "Flags marked mutually exclusive"
            - "Flag-to-config resolution using Changed() pattern"
        - id: "T014"
          title: "Add --auto-commit and --no-auto-commit flags to internal/cli/stages/implement.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/cli/stages/implement.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "--auto-commit flag added with appropriate help text"
            - "--no-auto-commit flag added with appropriate help text"
            - "Flags marked mutually exclusive"
            - "Flag-to-config resolution using Changed() pattern"
        - id: "T015"
          title: "Add --auto-commit and --no-auto-commit flags to internal/cli/prep.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/cli/prep.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "--auto-commit flag added with appropriate help text"
            - "--no-auto-commit flag added with appropriate help text"
            - "Flags marked mutually exclusive"
            - "Flag-to-config resolution using Changed() pattern"
        - id: "T016"
          title: "Add --auto-commit and --no-auto-commit flags to internal/cli/run.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: "US-001"
          file_path: "internal/cli/run.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "--auto-commit flag added with appropriate help text"
            - "--no-auto-commit flag added with appropriate help text"
            - "Flags marked mutually exclusive"
            - "Flag-to-config resolution using Changed() pattern"
        - id: "T017"
          title: "Add tests for flag handling in internal/cli/stages/flags_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/stages/flags_test.go"
          dependencies: ["T011", "T012", "T013", "T014", "T015", "T016"]
          acceptance_criteria:
            - "Tests verify flags are registered on all workflow commands"
            - "Tests verify mutual exclusivity error when both flags specified"
            - "Tests verify flag overrides config setting"
            - "Tests use map-based table-driven pattern with t.Parallel()"
    - number: 6
      title: "User Story 2 - Configure auto-commit behavior in config file"
      purpose: "Allow persistent auto-commit configuration at project and user levels"
      story_reference: "US-002"
      independent_test: "Set auto_commit: true in config, run workflow without flag, verify commit behavior occurs"
      tasks:
        - id: "T018"
          title: "Integrate instruction injection into workflow executor when auto_commit is enabled"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/workflow/executor.go"
          dependencies: ["T009", "T017"]
          acceptance_criteria:
            - "Auto-commit instructions injected when cfg.AutoCommit is true"
            - "Follows existing FormatRetryContext pattern for instruction injection"
            - "Instructions are agent-agnostic"
        - id: "T019"
          title: "Add state capture/comparison to lifecycle wrapper in internal/lifecycle/autocommit.go"
          status: "InProgress"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/lifecycle/autocommit.go"
          dependencies: ["T007", "T018"]
          acceptance_criteria:
            - "CaptureGitState called before workflow execution when auto-commit enabled"
            - "CompareGitStates called after workflow execution"
            - "Warnings logged to stderr without failing workflow"
            - "No warnings when auto-commit is disabled (FR-012)"
            - "Workflow returns exit 0 even if comparison shows issues (FR-013)"
    - number: 7
      title: "User Story 3 - One-Time Migration Notice"
      purpose: "Inform users of new auto-commit default behavior after upgrade"
      story_reference: "US-003"
      independent_test: "Run workflow for first time after upgrade, verify notice appears, run again, verify notice does not repeat"
      tasks:
        - id: "T020"
          title: "Create notice state management in internal/state/notice.go"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/state/notice.go"
          dependencies: ["T019"]
          acceptance_criteria:
            - "AutoCommitNoticeState struct with NoticeShown and ShownAt fields"
            - "LoadNoticeState(stateDir string) function"
            - "SaveNoticeState(stateDir string, state *AutoCommitNoticeState) function"
            - "State persisted to StateDir/auto_commit_notice.json"
        - id: "T021"
          title: "Integrate notice display into workflow commands"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/lifecycle/autocommit.go"
          dependencies: ["T020"]
          acceptance_criteria:
            - "Notice shown on first run when using default auto_commit value"
            - "Notice not shown when explicit config or flag is set"
            - "Notice persisted after display to prevent repeat"
            - "Notice text clearly explains new default behavior"
        - id: "T022"
          title: "Add tests for notice state management in internal/state/notice_test.go"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-003"
          file_path: "internal/state/notice_test.go"
          dependencies: ["T020", "T021"]
          acceptance_criteria:
            - "Tests cover notice state load/save"
            - "Tests verify notice shown only once"
            - "Tests verify notice not shown when explicit config exists"
            - "Tests use isolated temp directories"
            - "Tests use map-based table-driven pattern with t.Parallel()"
    - number: 8
      title: "Polish & Documentation"
      purpose: "Update documentation and ensure quality gates pass"
      tasks:
        - id: "T023"
          title: "Update docs/reference.md with --auto-commit and --no-auto-commit flag documentation"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "docs/reference.md"
          dependencies: ["T022"]
          acceptance_criteria:
            - "Flags documented for all workflow commands"
            - "Usage examples provided"
            - "Mutual exclusivity noted"
        - id: "T024"
          title: "Update docs/agents.md with auto_commit config option and README.md with feature mention"
          status: "Pending"
          type: "documentation"
          parallel: true
          story_id: null
          file_path: "docs/agents.md"
          dependencies: ["T022"]
          acceptance_criteria:
            - "docs/agents.md includes auto_commit config option documentation"
            - "Default behavior (true) documented"
            - "Environment variable AUTOSPEC_AUTO_COMMIT documented"
            - "README.md updated with brief feature mention in features section"
            - "All quality gates pass: make test, make fmt, make lint, make build"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-002"]
        - story_id: "US-002"
          depends_on: ["US-001"]
          blocks: ["US-003"]
        - story_id: "US-003"
          depends_on: ["US-002"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2, 3, 4]
        - phase: 2
          blocks: [5]
        - phase: 3
          blocks: [6]
        - phase: 4
          blocks: [6]
        - phase: 5
          blocks: [6]
        - phase: 6
          blocks: [7]
        - phase: 7
          blocks: [8]
parallel_execution:
    - phase: 2
      parallel_groups:
        - tasks: ["T002", "T003", "T004"]
          rationale: "Independent config files with no cross-dependencies"
    - phase: 5
      parallel_groups:
        - tasks: ["T011", "T012", "T013", "T014", "T015", "T016"]
          rationale: "Independent CLI command files, all following same flag pattern"
    - phase: 8
      parallel_groups:
        - tasks: ["T023", "T024"]
          rationale: "Independent documentation files"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3, 4, 5]
        description: "Setup + Config + Git State + Instructions + CLI Flags"
        validation: "Run workflow command with --auto-commit flag, verify instructions injected and git state captured"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2, 3, 4]
          deliverable: "Config option, git state capture, and instruction generation working independently"
        - milestone: "MVP Complete"
          phases: [1, 2, 3, 4, 5, 6]
          deliverable: "Full auto-commit workflow with CLI flags and config integration"
        - milestone: "Production Ready"
          phases: [1, 2, 3, 4, 5, 6, 7, 8]
          deliverable: "Complete feature with migration notice and documentation"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec 0.6.1"
    created: "2025-12-21T20:00:46Z"
    artifact_type: "tasks"
