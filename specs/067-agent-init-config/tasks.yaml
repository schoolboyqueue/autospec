tasks:
    branch: "067-agent-init-config"
    created: "2025-12-20"
    spec_path: "specs/067-agent-init-config/spec.yaml"
    plan_path: "specs/067-agent-init-config/plan.yaml"
summary:
    total_tasks: 18
    total_phases: 6
    parallel_opportunities: 6
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Project initialization and new package structure"
      tasks:
        - id: "T001"
          title: "Create configurator.go with Configurator interface and ConfigResult struct"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/cliagent/configurator.go"
          dependencies: []
          acceptance_criteria:
            - "Configurator interface defined with ConfigureProject(projectDir, specsDir string) (ConfigResult, error)"
            - "ConfigResult struct with PermissionsAdded []string, AlreadyConfigured bool, Warning string"
            - "Configure helper function that checks if agent implements Configurator and calls it"
            - "File passes gofmt and govet"
    - number: 2
      title: "Foundational"
      purpose: "Core infrastructure that MUST be complete before user stories"
      tasks:
        - id: "T002"
          title: "Add DefaultAgents field to Configuration struct"
          status: "Pending"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/config/config.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "DefaultAgents []string field added to Configuration struct"
            - "JSON/YAML tags include 'default_agents' key"
            - "Field is optional (omitempty)"
        - id: "T003"
          title: "Add default_agents to config template"
          status: "Pending"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/config/defaults.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "default_agents added to config template with empty default"
            - "Comment explaining field purpose"
        - id: "T004"
          title: "Add AddPermissions method to Claude settings"
          status: "Pending"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/claude/settings.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "AddPermissions method that adds permissions without duplicates"
            - "Returns list of permissions actually added (not already present)"
            - "Idempotent - calling multiple times has same effect"
            - "Preserves existing permissions and unknown fields"
    - number: 3
      title: "User Story 1 - Select agents during initialization"
      purpose: "Allow users to select which AI coding agents to configure during autospec init"
      story_reference: "US-001"
      independent_test: "Run autospec init in a fresh project and verify multi-select prompt appears with all supported agents listed"
      tasks:
        - id: "T005"
          title: "Create AgentOption type for prompt display"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/config/agent_prompt.go"
          dependencies: ["T002", "T003"]
          acceptance_criteria:
            - "AgentOption struct with Name, DisplayName, Recommended, Selected fields"
            - "Function to get all supported agents as AgentOptions"
            - "Claude marked as Recommended by default"
        - id: "T006"
          title: "Implement promptAgentSelection function"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/config/agent_prompt.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Displays numbered list of agents with selection state"
            - "Claude shown with (Recommended) label"
            - "Accepts space-separated numbers to toggle selections"
            - "Supports 'done' or empty input to confirm"
            - "Returns list of selected agent names"
        - id: "T007"
          title: "Write tests for agent prompt logic"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/config/agent_prompt_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Tests for GetSupportedAgents returns all 6 agents"
            - "Tests for Claude being marked Recommended"
            - "Tests for selection toggling logic"
            - "Tests use map-based table-driven pattern"
            - "Tests call t.Parallel()"
    - number: 4
      title: "User Story 2 - Configure Claude Code with complete permissions"
      purpose: "Claude Code configured with all necessary permissions for autospec workflows"
      story_reference: "US-002"
      independent_test: "Select Claude during init and verify .claude/settings.local.json contains all required permissions"
      tasks:
        - id: "T008"
          title: "Implement Claude.ConfigureProject method"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cliagent/claude.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "ConfigureProject method added to Claude agent"
            - "Generates permissions: Bash(autospec:*), Write(.autospec/**), Edit(.autospec/**)"
            - "Generates permissions with dynamic specsDir: Write({specsDir}/**), Edit({specsDir}/**)"
            - "Calls AddPermissions to update .claude/settings.local.json"
            - "Returns ConfigResult with permissions added or already configured"
        - id: "T009"
          title: "Write tests for Claude ConfigureProject"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cliagent/configurator_test.go"
          dependencies: ["T008"]
          acceptance_criteria:
            - "Test permission generation with default specs dir"
            - "Test permission generation with custom specs dir (e.g., 'features')"
            - "Test idempotency - second call returns AlreadyConfigured=true"
            - "Test AddPermissions doesn't create duplicates"
            - "Tests use map-based table-driven pattern with t.Parallel()"
    - number: 5
      title: "User Stories 3-5 - Init Integration and Polish"
      purpose: "Wire agent selection into init, persist preferences, show feedback"
      story_reference: "US-003, US-004, US-005"
      independent_test: "Run init twice with same selections and verify preferences remembered; run with --no-agents and verify skip"
      tasks:
        - id: "T010"
          title: "Add --no-agents flag to init command"
          status: "Pending"
          type: "implementation"
          parallel: true
          story_id: "US-004"
          file_path: "internal/cli/config/init_cmd.go"
          dependencies: ["T006", "T008"]
          acceptance_criteria:
            - "Flag --no-agents added to init command"
            - "Flag documented in help text"
            - "When set, agent selection prompt is skipped"
        - id: "T011"
          title: "Integrate agent selection into runInit"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/config/init_cmd.go"
          dependencies: ["T010"]
          acceptance_criteria:
            - "runInit calls promptAgentSelection unless --no-agents set"
            - "Selected agents are configured via Configurator interface"
            - "Non-configurator agents show 'no configuration needed' message"
            - "Existing unconditional Claude config removed"
        - id: "T012"
          title: "Persist agent selections to config"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/cli/config/init_cmd.go"
          dependencies: ["T011"]
          acceptance_criteria:
            - "After agent selection, DefaultAgents saved to config.yml"
            - "On subsequent init, saved agents pre-selected in prompt"
            - "Changing selections updates persisted preferences"
        - id: "T013"
          title: "Display configuration feedback"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: "US-005"
          file_path: "internal/cli/config/init_cmd.go"
          dependencies: ["T012"]
          acceptance_criteria:
            - "Each configured agent shows checkmark and name"
            - "Permissions added are listed for each agent"
            - "Already configured agents show appropriate message"
            - "No agents selected shows warning about manual config"
        - id: "T014"
          title: "Handle non-interactive terminals"
          status: "Pending"
          type: "implementation"
          parallel: true
          story_id: "US-004"
          file_path: "internal/cli/config/agent_prompt.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Detect non-TTY environment (os.IsTerminal check)"
            - "In non-TTY without --no-agents, fail with helpful message"
            - "Message suggests using --no-agents or running interactively"
        - id: "T015"
          title: "Write integration tests for init with agents"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/config/init_test.go"
          dependencies: ["T013"]
          acceptance_criteria:
            - "Test init with --no-agents skips prompt"
            - "Test init creates expected .claude/settings.local.json"
            - "Test init persists DefaultAgents to config"
            - "Test idempotent behavior on repeated init"
            - "Tests use map-based table-driven pattern with t.Parallel()"
    - number: 6
      title: "Polish & Cross-Cutting Concerns"
      purpose: "Edge cases, validation, and quality gates"
      tasks:
        - id: "T016"
          title: "Handle edge cases from spec"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/cli/config/init_cmd.go"
          dependencies: ["T015"]
          acceptance_criteria:
            - "Partial existing permissions: only missing permissions added"
            - "Unknown agent names in config: ignored with no error"
            - "Malformed config.yml: defaults to claude recommended"
            - "File permission errors: clear error message, continue with other agents"
            - "Special characters in specs_dir: correctly escaped in permissions"
        - id: "T017"
          title: "Verify idempotency across all operations"
          status: "Pending"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/cliagent/configurator_test.go"
          dependencies: ["T016"]
          acceptance_criteria:
            - "Test: running init 3 times produces identical config"
            - "Test: permissions not duplicated on repeated runs"
            - "Test: DefaultAgents not corrupted on repeated saves"
        - id: "T018"
          title: "Verify quality gates pass"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: null
          dependencies: ["T017"]
          acceptance_criteria:
            - "make test exits 0"
            - "make fmt exits 0 with no changes"
            - "make lint exits 0"
            - "make build exits 0"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-003", "US-005"]
        - story_id: "US-002"
          depends_on: []
          blocks: ["US-005"]
        - story_id: "US-003"
          depends_on: ["US-001"]
          blocks: []
        - story_id: "US-004"
          depends_on: []
          blocks: []
        - story_id: "US-005"
          depends_on: ["US-001", "US-002"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3, 4]
        - phase: 3
          blocks: [5]
        - phase: 4
          blocks: [5]
        - phase: 5
          blocks: [6]
parallel_execution:
    - phase: 2
      parallel_groups:
        - tasks: ["T002", "T003", "T004"]
          rationale: "Independent config/settings changes in different packages"
    - phase: 5
      parallel_groups:
        - tasks: ["T010", "T014"]
          rationale: "Flag addition and TTY detection are independent"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3, 4]
        description: "Setup + Foundational + Agent Selection + Claude Configuration"
        validation: "Run autospec init, select claude, verify .claude/settings.local.json has all permissions"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "Configurator interface and config infrastructure in place"
        - milestone: "Agent Selection Works"
          phases: [1, 2, 3]
          deliverable: "Interactive agent selection prompt functional"
        - milestone: "Claude Configuration Complete"
          phases: [1, 2, 3, 4]
          deliverable: "Claude can be selected and configured with all permissions"
        - milestone: "Full Feature Complete"
          phases: [1, 2, 3, 4, 5, 6]
          deliverable: "All user stories implemented with edge cases handled"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec dev"
    created: "2025-12-20T02:55:20Z"
    artifact_type: "tasks"
