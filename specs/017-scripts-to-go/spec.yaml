feature:
  branch: "017-scripts-to-go"
  created: "2025-12-15"
  status: "Draft"
  input: "Migrate shell scripts to Go CLI commands: create new-feature, prereqs, and setup-plan commands to replace shell scripts, enabling cross-platform execution and eliminating code duplication. Excludes update-agent-context.sh migration (deferred)."

user_stories:
  - id: "US-001"
    title: "Create new feature with Go command"
    priority: "P1"
    as_a: "developer using autospec"
    i_want: "to create new feature branches and directories using a Go CLI command"
    so_that: "I get consistent cross-platform behavior without shell script dependencies"
    why_this_priority: "Core workflow - most frequently used operation, blocks all other phases"
    independent_test: "Run autospec new-feature on Windows, macOS, and Linux; verify identical branch/directory creation"
    acceptance_scenarios:
      - given: "a git repository with existing specs"
        when: "I run autospec new-feature --json --short-name 'user-auth' 'Add authentication'"
        then: "a new branch NNN-user-auth is created and JSON output contains BRANCH_NAME, SPEC_FILE, FEATURE_NUM, AUTOSPEC_VERSION, CREATED_DATE"
      - given: "a non-git directory with .autospec folder"
        when: "I run autospec new-feature 'Add feature'"
        then: "the specs directory is created but no git branch is created, with warning message"
      - given: "existing branches 001-foo, 003-bar in repo"
        when: "I run autospec new-feature 'New feature'"
        then: "the new branch gets number 004 (next available)"

  - id: "US-002"
    title: "Check prerequisites with Go command"
    priority: "P1"
    as_a: "developer or Claude slash command"
    i_want: "to validate that required artifacts exist before running a workflow phase"
    so_that: "I get clear error messages if prerequisites are missing"
    why_this_priority: "Called before every phase; validation prevents wasted effort"
    independent_test: "Run autospec prereqs with missing/present artifacts; verify correct JSON output and exit codes"
    acceptance_scenarios:
      - given: "a feature directory with spec.yaml only"
        when: "I run autospec prereqs --json --require-spec"
        then: "JSON output shows FEATURE_DIR, FEATURE_SPEC path, and AVAILABLE_DOCS contains spec.yaml"
      - given: "a feature directory missing plan.yaml"
        when: "I run autospec prereqs --require-plan"
        then: "exit code 1 and error message indicating plan.yaml is required"
      - given: "not on a feature branch (e.g., main)"
        when: "I run autospec prereqs"
        then: "exit code 1 and error message about feature branch requirement"

  - id: "US-003"
    title: "Deprecate shell scripts"
    priority: "P2"
    as_a: "autospec maintainer"
    i_want: "shell scripts to emit deprecation warnings when called"
    so_that: "users transition to Go commands gradually"
    why_this_priority: "Enables smooth migration without breaking existing workflows"
    independent_test: "Run old script; verify deprecation warning appears in stderr"
    acceptance_scenarios:
      - given: "user has old .autospec/scripts/create-new-feature.sh"
        when: "the script is executed"
        then: "stderr shows deprecation warning pointing to autospec new-feature command"
      - given: "Claude slash commands still reference old scripts"
        when: "the script is executed"
        then: "scripts still work but emit warnings"

  - id: "US-004"
    title: "Setup plan with Go command"
    priority: "P2"
    as_a: "developer or Claude slash command"
    i_want: "to initialize plan files in a feature directory using a Go CLI command"
    so_that: "plan setup works cross-platform without shell script dependencies"
    why_this_priority: "Simple command that completes script migration set"
    independent_test: "Run autospec setup-plan; verify plan template is copied to feature directory"
    acceptance_scenarios:
      - given: "a feature directory exists with spec.yaml"
        when: "I run autospec setup-plan --json"
        then: "plan template is copied and JSON output shows FEATURE_SPEC, IMPL_PLAN, SPECS_DIR, BRANCH"
      - given: "plan template does not exist"
        when: "I run autospec setup-plan"
        then: "an empty plan.yaml is created with warning about missing template"
      - given: "feature directory does not exist"
        when: "I run autospec setup-plan"
        then: "feature directory is created before copying template"

  - id: "US-005"
    title: "Deprecate shell scripts"
    priority: "P2"
    as_a: "autospec maintainer"
    i_want: "shell scripts to emit deprecation warnings when called"
    so_that: "users transition to Go commands gradually"
    why_this_priority: "Enables smooth migration without breaking existing workflows"
    independent_test: "Run old script; verify deprecation warning appears in stderr"
    acceptance_scenarios:
      - given: "user has old .autospec/scripts/create-new-feature.sh"
        when: "the script is executed"
        then: "stderr shows deprecation warning pointing to autospec new-feature command"
      - given: "Claude slash commands still reference old scripts"
        when: "the script is executed"
        then: "scripts still work but emit warnings"

  - id: "US-006"
    title: "Update slash commands to use Go commands"
    priority: "P2"
    as_a: "developer using Claude slash commands"
    i_want: "slash commands to call autospec CLI instead of shell scripts"
    so_that: "I benefit from Go command improvements automatically"
    why_this_priority: "Completes the migration; eliminates script dependency"
    independent_test: "Run /autospec.specify; verify it calls autospec new-feature instead of script"
    acceptance_scenarios:
      - given: "autospec.specify.md references create-new-feature.sh"
        when: "the command template is updated"
        then: "it calls autospec new-feature --json --short-name '<name>' instead"
      - given: "autospec.plan.md references check-prerequisites.sh"
        when: "the command template is updated"
        then: "it calls autospec prereqs --json --require-spec instead"

requirements:
  functional:
    - id: "FR-001"
      description: "MUST implement autospec new-feature command with identical output format to create-new-feature.sh"
      testable: true
      acceptance_criteria: "JSON output keys match: BRANCH_NAME, SPEC_FILE, FEATURE_NUM, AUTOSPEC_VERSION, CREATED_DATE"
    - id: "FR-002"
      description: "MUST support --json flag for machine-readable output"
      testable: true
      acceptance_criteria: "Output is valid JSON when --json flag present"
    - id: "FR-003"
      description: "MUST support --short-name flag to specify branch name suffix"
      testable: true
      acceptance_criteria: "Branch name uses provided short-name after NNN- prefix"
    - id: "FR-004"
      description: "MUST support --number flag to override auto-detected branch number"
      testable: true
      acceptance_criteria: "Branch uses specified number instead of auto-detected next number"
    - id: "FR-005"
      description: "MUST implement autospec prereqs command with identical output format to check-prerequisites.sh"
      testable: true
      acceptance_criteria: "JSON output keys match: FEATURE_DIR, FEATURE_SPEC, IMPL_PLAN, TASKS, AVAILABLE_DOCS, AUTOSPEC_VERSION, CREATED_DATE"
    - id: "FR-006"
      description: "MUST support --require-spec, --require-plan, --require-tasks flags for validation"
      testable: true
      acceptance_criteria: "Exit code 1 when required file missing; exit code 0 when present"
    - id: "FR-007"
      description: "MUST support --include-tasks flag to include tasks in AVAILABLE_DOCS"
      testable: true
      acceptance_criteria: "AVAILABLE_DOCS array includes tasks.yaml when flag present and file exists"
    - id: "FR-008"
      description: "MUST support --paths-only flag to skip validation and output paths only"
      testable: true
      acceptance_criteria: "No validation performed; only path variables output"
    - id: "FR-009"
      description: "MUST reuse existing Go packages internal/git and internal/spec"
      testable: true
      acceptance_criteria: "No duplication of git.GetCurrentBranch, spec.DetectCurrentSpec functionality"
    - id: "FR-010"
      description: "MUST handle non-git repositories gracefully"
      testable: true
      acceptance_criteria: "Commands work without git; skip git operations and warn user"
    - id: "FR-011"
      description: "MUST filter stop words from feature description when generating branch name"
      testable: true
      acceptance_criteria: "Words like 'the', 'a', 'to', 'for' are excluded from generated branch name"
    - id: "FR-012"
      description: "MUST enforce GitHub's 244-byte branch name limit"
      testable: true
      acceptance_criteria: "Branch names exceeding limit are truncated with warning"
    - id: "FR-013"
      description: "MUST implement autospec setup-plan command with identical output format to setup-plan.sh"
      testable: true
      acceptance_criteria: "JSON output keys match: FEATURE_SPEC, IMPL_PLAN, SPECS_DIR, BRANCH, HAS_GIT"
    - id: "FR-014"
      description: "MUST copy plan template from .specify/templates/plan-template.md if it exists"
      testable: true
      acceptance_criteria: "Template file is copied to feature directory as plan file"
    - id: "FR-015"
      description: "MUST create empty plan file with warning if template does not exist"
      testable: true
      acceptance_criteria: "Warning message emitted; empty file created"
    - id: "FR-016"
      description: "MUST create feature directory if it does not exist"
      testable: true
      acceptance_criteria: "Directory created before attempting to copy template"
  non_functional:
    - id: "NFR-001"
      category: "performance"
      description: "Commands should execute in under 2 seconds on typical systems"
      measurable_target: "p95 latency < 2s for new-feature, prereqs, and setup-plan commands"
    - id: "NFR-002"
      category: "reliability"
      description: "Commands should produce identical output across Windows, macOS, and Linux"
      measurable_target: "100% output consistency across platforms for same inputs"
    - id: "NFR-003"
      category: "usability"
      description: "Error messages should clearly indicate what went wrong and how to fix it"
      measurable_target: "All error messages include actionable guidance"

success_criteria:
  measurable_outcomes:
    - id: "SC-001"
      description: "Core shell scripts can be removed from distribution"
      metric: "Count of shell scripts required for core workflow"
      target: "0 scripts required (only update-agent-context.sh and common.sh remain as optional)"
    - id: "SC-002"
      description: "Claude slash commands work with Go commands"
      metric: "Percentage of slash commands using Go commands"
      target: "100% of specify/plan/tasks/implement commands"
    - id: "SC-003"
      description: "Feature creation works on all platforms"
      metric: "Platforms where autospec new-feature succeeds"
      target: "Windows, macOS, Linux all pass"
    - id: "SC-004"
      description: "No regression in existing workflows"
      metric: "Existing integration tests pass"
      target: "100% of existing tests pass"

key_entities:
  - name: "NewFeatureOutput"
    description: "JSON structure returned by autospec new-feature command"
    attributes:
      - "BRANCH_NAME: string - full branch name (e.g., '004-user-auth')"
      - "SPEC_FILE: string - absolute path to spec.yaml"
      - "FEATURE_NUM: string - zero-padded number (e.g., '004')"
      - "AUTOSPEC_VERSION: string - autospec version for _meta"
      - "CREATED_DATE: string - ISO 8601 timestamp"
  - name: "PrereqsOutput"
    description: "JSON structure returned by autospec prereqs command"
    attributes:
      - "FEATURE_DIR: string - absolute path to feature directory"
      - "FEATURE_SPEC: string - absolute path to spec.yaml"
      - "IMPL_PLAN: string - absolute path to plan.yaml"
      - "TASKS: string - absolute path to tasks.yaml"
      - "AVAILABLE_DOCS: array - list of existing artifact filenames"
      - "AUTOSPEC_VERSION: string - autospec version for _meta"
      - "CREATED_DATE: string - ISO 8601 timestamp"
  - name: "SetupPlanOutput"
    description: "JSON structure returned by autospec setup-plan command"
    attributes:
      - "FEATURE_SPEC: string - absolute path to spec.yaml"
      - "IMPL_PLAN: string - absolute path to plan.yaml (newly created)"
      - "SPECS_DIR: string - absolute path to feature directory"
      - "BRANCH: string - current branch name"
      - "HAS_GIT: string - 'true' or 'false' indicating git availability"

edge_cases:
  - scenario: "Branch name exceeds GitHub's 244-byte limit"
    expected_behavior: "Truncate at word boundary, emit warning to stderr, continue with truncated name"
  - scenario: "Multiple specs directories match the numeric prefix"
    expected_behavior: "Return error indicating naming conflict"
  - scenario: "SPECIFY_FEATURE environment variable is set"
    expected_behavior: "Use environment variable as current feature name instead of git branch"
  - scenario: "Git fetch fails due to network issues"
    expected_behavior: "Continue with local branches only, warn user about potentially stale data"
  - scenario: "Spec directory exists but branch was deleted"
    expected_behavior: "prereqs command uses spec directory even if branch doesn't exist"
  - scenario: "User provides invalid --number value (negative or non-numeric)"
    expected_behavior: "Return error with clear message about valid number format"

assumptions:
  - "Git CLI is available and in PATH when git operations are needed"
  - "Users have write access to specs/ directory"
  - "Feature numbers follow NNN- pattern (three digits)"
  - "Claude slash commands can call autospec binary just as easily as shell scripts"
  - "Existing internal/git and internal/spec packages provide sufficient building blocks"

constraints:
  - "Must maintain backward compatibility with existing JSON output format"
  - "Cannot break existing Claude slash commands during migration"
  - "Must work without git (for --no-git initialized projects)"
  - "Go standard library only - no external dependencies for cross-platform support"

out_of_scope:
  - "Migration of update-agent-context.sh (deferred per analysis recommendation - 800 lines, complex)"
  - "Changes to spec.yaml, plan.yaml, or tasks.yaml schemas"
  - "API key authentication mode changes"
  - "New workflow phases beyond existing specify/plan/tasks/implement"

_meta:
  version: "1.0.0"
  generator: "autospec"
  generator_version: "autospec dev"
  created: "2025-12-16T03:31:15Z"
  artifact_type: "spec"
