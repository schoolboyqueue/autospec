feature:
  branch: "024-rename-workflow-stages"
  created: "2025-12-16"
  status: "Draft"
  input: "Rename workflow phases to stages. See .dev/tasks/023-rename-workflow-phases-to-stages.md for full details."

user_stories:
  - id: "US-001"
    title: "Developer uses distinct terminology for workflow levels"
    priority: "P1"
    as_a: "developer using autospec"
    i_want: "clear distinction between high-level workflow stages and implementation phases"
    so_that: "I don't confuse workflow-level concepts with task-level subdivisions"
    why_this_priority: "Core confusion exists today between overloaded 'phase' terminology"
    independent_test: "Run autospec --help and verify terminology is consistent"
    acceptance_scenarios:
      - given: "autospec CLI is installed"
        when: "I view help text for any workflow command"
        then: "high-level workflow steps are called 'stages' (specify, plan, tasks, implement)"
      - given: "autospec CLI is installed"
        when: "I view help text for implement command"
        then: "'phases' refers only to task groupings within implementation"

  - id: "US-002"
    title: "Developer reads documentation with consistent terminology"
    priority: "P1"
    as_a: "developer reading autospec documentation"
    i_want: "consistent use of 'stage' for workflow and 'phase' for task groupings"
    so_that: "I can quickly understand the conceptual hierarchy"
    why_this_priority: "Documentation is primary reference; inconsistency causes ongoing confusion"
    independent_test: "Search documentation for 'phase' and verify each usage refers to task groupings"
    acceptance_scenarios:
      - given: "CLAUDE.md documentation"
        when: "I search for 'stage'"
        then: "results describe workflow stages: specify, plan, tasks, implement"
      - given: "CLAUDE.md documentation"
        when: "I search for 'phase'"
        then: "results describe task phases within implementation"

  - id: "US-003"
    title: "Developer maintains code with clear type names"
    priority: "P1"
    as_a: "developer maintaining autospec codebase"
    i_want: "Go types and variables to use 'Stage' for workflow and 'Phase' for tasks"
    so_that: "code is self-documenting and matches CLI/documentation terminology"
    why_this_priority: "Code clarity directly impacts maintainability and contribution ease"
    independent_test: "Search codebase for 'type Stage' and 'type Phase' and verify separation"
    acceptance_scenarios:
      - given: "internal/workflow/executor.go"
        when: "I examine the workflow stage type"
        then: "it is named 'Stage' with constants like 'StageSpecify', 'StagePlan'"
      - given: "internal/validation/tasks.go"
        when: "I examine task phase parsing"
        then: "'Phase' refers to task groupings (Phase 1, Phase 2, etc.)"

requirements:
  functional:
    - id: "FR-001"
      description: "MUST rename workflow Phase type to Stage in internal/workflow/executor.go"
      testable: true
      acceptance_criteria: "Type is named 'Stage', not 'Phase'; constants are StageSpecify, StagePlan, StageTasks, StageImplement"

    - id: "FR-002"
      description: "MUST rename phase_config.go to stage_config.go and update struct names"
      testable: true
      acceptance_criteria: "File renamed; PhaseConfig becomes StageConfig; PhaseExecutionOptions becomes StageExecutionOptions"

    - id: "FR-003"
      description: "MUST update internal/workflow/workflow.go to use Stage terminology"
      testable: true
      acceptance_criteria: "All method signatures and variables use Stage instead of Phase for workflow concepts"

    - id: "FR-004"
      description: "MUST update internal/workflow/preflight.go artifact dependency messages"
      testable: true
      acceptance_criteria: "Messages refer to 'stage' for workflow-level dependencies"

    - id: "FR-005"
      description: "MUST update CLI help text to use 'stage' for workflow concepts"
      testable: true
      acceptance_criteria: "Help text for run, all, prep commands refers to 'stages'; implement command keeps 'phases' for task groupings"

    - id: "FR-006"
      description: "MUST update internal/retry/retry.go to use Stage terminology where applicable"
      testable: true
      acceptance_criteria: "MarkPhaseComplete renamed to MarkStageComplete if it refers to workflow stages"

    - id: "FR-007"
      description: "MUST update CLAUDE.md documentation with stage/phase distinction"
      testable: true
      acceptance_criteria: "All references to workflow phases changed to stages; phase reserved for task groupings"

    - id: "FR-008"
      description: "MUST update README.md with stage/phase distinction"
      testable: true
      acceptance_criteria: "Consistent terminology throughout README"

    - id: "FR-009"
      description: "MUST update .claude/commands/*.md files with stage/phase distinction"
      testable: true
      acceptance_criteria: "All slash command documentation uses correct terminology"

    - id: "FR-010"
      description: "MUST preserve existing CLI flags (-s, -p, -t, -i, --phases, --phase, --from-phase)"
      testable: true
      acceptance_criteria: "All existing flags work identically; no breaking changes to CLI interface"

    - id: "FR-011"
      description: "MUST maintain backward compatibility for all public APIs"
      testable: true
      acceptance_criteria: "Existing scripts and integrations continue to work without modification"

  non_functional:
    - id: "NFR-001"
      category: "usability"
      description: "Terminology must be intuitive and consistent across all user touchpoints"
      measurable_target: "Zero instances of 'phase' when referring to workflow stages in user-facing text"

    - id: "NFR-002"
      category: "reliability"
      description: "Refactoring must not introduce regressions"
      measurable_target: "All existing tests pass after renaming"

success_criteria:
  measurable_outcomes:
    - id: "SC-001"
      description: "Developers can distinguish workflow stages from task phases at a glance"
      metric: "Terminology consistency audit"
      target: "100% of workflow references use 'stage'; 100% of task grouping references use 'phase'"

    - id: "SC-002"
      description: "Existing CLI commands continue to work identically"
      metric: "CLI compatibility test suite"
      target: "All existing command invocations produce identical results"

    - id: "SC-003"
      description: "Documentation provides clear mental model for hierarchy"
      metric: "Presence of hierarchy diagram in documentation"
      target: "Diagram showing stages contain phases is present in CLAUDE.md"

key_entities:
  - name: "Stage"
    description: "High-level workflow step in autospec (specify, plan, tasks, implement)"
    attributes:
      - "name: identify the stage"
      - "order: canonical execution sequence"
      - "artifacts: files produced by this stage"

  - name: "Phase"
    description: "Numbered grouping of tasks within the implement stage"
    attributes:
      - "number: sequential identifier"
      - "title: human-readable description"
      - "tasks: list of task IDs in this phase"

edge_cases:
  - scenario: "Existing scripts reference old internal types via reflection or parsing"
    expected_behavior: "Internal type names are not part of public API; scripts using them may need updates"

  - scenario: "Retry state files contain 'phase' in keys"
    expected_behavior: "Migrate retry state format if needed, or maintain backward-compatible parsing"

  - scenario: "Error messages reference phases"
    expected_behavior: "Update to use 'stage' for workflow errors, 'phase' for task errors"

assumptions:
  - "Internal Go type names are not part of the public API"
  - "Retry state file format can be versioned/migrated if needed"
  - "All relevant documentation lives in CLAUDE.md, README.md, and .claude/commands/"
  - "No external tools directly depend on internal type names"

constraints:
  - "CLI flags must remain backward compatible (no flag renaming)"
  - "YAML artifact schemas (spec.yaml, plan.yaml, tasks.yaml) remain unchanged"
  - "tasks.yaml continues to use 'phase' for task groupings"

out_of_scope:
  - "Renaming CLI flags (e.g., --phases stays as --phases)"
  - "Changing tasks.yaml schema or 'phase' field names"
  - "Adding new workflow stages"
  - "Modifying the canonical stage order"

_meta:
  version: "1.0.0"
  generator: "autospec"
  generator_version: "autospec dev"
  created: "2025-12-16T08:55:14Z"
  artifact_type: "spec"
