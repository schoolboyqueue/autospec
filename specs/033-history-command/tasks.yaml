tasks:
    branch: "033-history-command"
    created: "2025-12-17"
    spec_path: "specs/033-history-command/spec.yaml"
    plan_path: "specs/033-history-command/plan.yaml"
summary:
    total_tasks: 22
    total_phases: 7
    parallel_opportunities: 6
    estimated_complexity: "medium"
phases:
    - number: 1
      title: "Setup"
      purpose: "Create new package structure and test files"
      tasks:
        - id: "T001"
          title: "Create internal/history directory and package files"
          status: "Completed"
          type: "setup"
          parallel: false
          story_id: null
          file_path: "internal/history/"
          dependencies: []
          acceptance_criteria:
            - "Directory internal/history exists"
            - "Package declaration is 'package history'"
        - id: "T002"
          title: "Create internal/history/history_test.go test file skeleton"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/history/history_test.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Test file exists with package history_test"
            - "Uses map-based table-driven test pattern"
            - "Includes t.Parallel() calls"
        - id: "T003"
          title: "Create internal/history/writer_test.go test file skeleton"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: null
          file_path: "internal/history/writer_test.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "Test file exists with package history_test"
            - "Uses map-based table-driven test pattern"
    - number: 2
      title: "Foundational"
      purpose: "Core data structures and file operations that MUST be complete before user stories"
      tasks:
        - id: "T004"
          title: "Implement HistoryEntry struct in internal/history/history.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/history/history.go"
          dependencies: ["T002"]
          acceptance_criteria:
            - "HistoryEntry struct with Timestamp, Command, Spec, ExitCode, Duration fields"
            - "Proper YAML tags for serialization"
            - "time.Time for Timestamp, string for Duration"
        - id: "T005"
          title: "Implement HistoryFile struct and LoadHistory function"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/history/history.go"
          dependencies: ["T004"]
          acceptance_criteria:
            - "HistoryFile struct with Entries slice"
            - "LoadHistory() reads from ~/.autospec/state/history.yaml"
            - "Returns empty history if file doesn't exist"
            - "Handles corrupted file by backing up and creating fresh"
            - "All errors wrapped with context"
        - id: "T006"
          title: "Implement SaveHistory function with atomic writes"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: "internal/history/history.go"
          dependencies: ["T005"]
          acceptance_criteria:
            - "Uses temp file + rename pattern for atomic writes"
            - "Creates parent directories if needed"
            - "All errors wrapped with context"
            - "Function under 40 lines"
        - id: "T007"
          title: "Implement unit tests for LoadHistory and SaveHistory"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: null
          file_path: "internal/history/history_test.go"
          dependencies: ["T006"]
          acceptance_criteria:
            - "Tests for loading existing file"
            - "Tests for missing file (returns empty)"
            - "Tests for corrupted file (backup and fresh)"
            - "Tests for atomic write behavior"
            - "Uses t.TempDir() for isolation"
        - id: "T008"
          title: "Add MaxHistoryEntries to config in internal/config/config.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/config/config.go"
          dependencies: ["T001"]
          acceptance_criteria:
            - "MaxHistoryEntries int field in Config struct"
            - "Proper koanf binding for max_history_entries"
        - id: "T009"
          title: "Add max_history_entries default value in internal/config/defaults.go"
          status: "Completed"
          type: "implementation"
          parallel: true
          story_id: null
          file_path: "internal/config/defaults.go"
          dependencies: ["T008"]
          acceptance_criteria:
            - "Default value of 500 for max_history_entries"
    - number: 3
      title: "User Story 1 - View command execution history"
      purpose: "Core functionality - without viewing history, the feature has no value"
      story_reference: "US-001"
      independent_test: "Run autospec history after executing several commands and verify entries are displayed"
      tasks:
        - id: "T010"
          title: "Create internal/cli/history_test.go with display tests"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/history_test.go"
          dependencies: ["T007"]
          acceptance_criteria:
            - "Tests for displaying history entries"
            - "Tests for empty history message"
            - "Tests for formatted output"
            - "Uses map-based table-driven pattern"
        - id: "T011"
          title: "Implement historyCmd Cobra command in internal/cli/history.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/history.go"
          dependencies: ["T010"]
          acceptance_criteria:
            - "historyCmd with 'history' command name"
            - "Short and long descriptions"
            - "Loads history using LoadHistory()"
            - "Displays entries in readable format with timestamp, command, spec, exit code, duration"
            - "Shows 'No history available' when empty"
            - "Registers command in root.go"
        - id: "T012"
          title: "Implement formatted history output display"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-001"
          file_path: "internal/cli/history.go"
          dependencies: ["T011"]
          acceptance_criteria:
            - "Human-readable date/time formatting"
            - "Consistent column alignment"
            - "Color coding for exit codes (green=0, red=non-zero)"
            - "Function under 40 lines"
    - number: 4
      title: "User Story 2 & 3 - Filter and Limit history"
      purpose: "Essential for usability when working on multiple features and reviewing recent activity"
      story_reference: "US-002, US-003"
      independent_test: "Filter by spec name and limit results to verify correct filtering and limiting"
      tasks:
        - id: "T013"
          title: "Add tests for --spec filtering in internal/cli/history_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cli/history_test.go"
          dependencies: ["T012"]
          acceptance_criteria:
            - "Tests for filtering by exact spec name"
            - "Tests for no matching entries"
            - "Tests for case sensitivity"
        - id: "T014"
          title: "Implement --spec NAME flag for history filtering"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-002"
          file_path: "internal/cli/history.go"
          dependencies: ["T013"]
          acceptance_criteria:
            - "--spec flag with string value"
            - "Filters entries where Spec matches the provided name"
            - "Shows message when no entries match"
        - id: "T015"
          title: "Add tests for --limit flag in internal/cli/history_test.go"
          status: "Completed"
          type: "test"
          parallel: true
          story_id: "US-003"
          file_path: "internal/cli/history_test.go"
          dependencies: ["T012"]
          acceptance_criteria:
            - "Tests for limiting to N most recent entries"
            - "Tests for limit larger than available entries"
            - "Tests for invalid limit (0, negative)"
        - id: "T016"
          title: "Implement --limit N flag for entry limiting"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-003"
          file_path: "internal/cli/history.go"
          dependencies: ["T015"]
          acceptance_criteria:
            - "--limit flag with int value"
            - "Returns last N entries (most recent)"
            - "Error with exit code 3 for invalid values (0, negative)"
            - "--spec filter applied before --limit"
    - number: 5
      title: "User Story 4 - Clear command history"
      purpose: "Useful for maintenance and storage management"
      story_reference: "US-004"
      independent_test: "Execute commands, run history --clear, then verify history is empty"
      tasks:
        - id: "T017"
          title: "Add tests for --clear flag in internal/cli/history_test.go"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-004"
          file_path: "internal/cli/history_test.go"
          dependencies: ["T016"]
          acceptance_criteria:
            - "Tests for clearing history with entries"
            - "Tests for clearing already empty history"
            - "Tests for confirmation message output"
        - id: "T018"
          title: "Implement --clear flag for deleting history"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-004"
          file_path: "internal/cli/history.go"
          dependencies: ["T017"]
          acceptance_criteria:
            - "--clear flag as bool"
            - "Removes all entries from history file"
            - "Displays confirmation message"
            - "No confirmation prompt required (per spec)"
    - number: 6
      title: "User Story 5 & 6 - Automatic logging and pruning"
      purpose: "Core functionality - logging must happen automatically for the feature to work"
      story_reference: "US-005, US-006"
      independent_test: "Execute an autospec command, then check history file contains the new entry"
      tasks:
        - id: "T019"
          title: "Implement HistoryWriter in internal/history/writer.go"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-005"
          file_path: "internal/history/writer.go"
          dependencies: ["T009"]
          acceptance_criteria:
            - "HistoryWriter struct with config reference"
            - "LogEntry() method to add new entry"
            - "Uses LoadHistory() and SaveHistory()"
            - "Non-fatal errors (warns to stderr, doesn't fail)"
            - "Function under 40 lines"
        - id: "T020"
          title: "Implement entry pruning when max exceeded in writer"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-006"
          file_path: "internal/history/writer.go"
          dependencies: ["T019"]
          acceptance_criteria:
            - "Removes oldest entries when count exceeds MaxHistoryEntries"
            - "Pruning happens at write time"
            - "FIFO removal (oldest first)"
        - id: "T021"
          title: "Implement unit tests for HistoryWriter and pruning"
          status: "Completed"
          type: "test"
          parallel: false
          story_id: "US-005"
          file_path: "internal/history/writer_test.go"
          dependencies: ["T020"]
          acceptance_criteria:
            - "Tests for logging new entry"
            - "Tests for pruning when max exceeded"
            - "Tests for concurrent access safety"
            - "Tests for non-fatal error handling"
        - id: "T022"
          title: "Hook HistoryWriter into lifecycle wrapper"
          status: "Completed"
          type: "implementation"
          parallel: false
          story_id: "US-005"
          file_path: "internal/lifecycle/lifecycle.go"
          dependencies: ["T021"]
          acceptance_criteria:
            - "Calls HistoryWriter.LogEntry() after command completion"
            - "Passes command name, spec, exit code, duration"
            - "Handles nil writer gracefully"
            - "Logging failures don't fail commands"
            - "Works with both Run() and RunWithContext()"
    - number: 7
      title: "Polish & Cross-Cutting Concerns"
      purpose: "Documentation and quality gates"
      tasks:
        - id: "T023"
          title: "Update docs/reference.md with history command documentation"
          status: "InProgress"
          type: "documentation"
          parallel: false
          story_id: null
          file_path: "docs/reference.md"
          dependencies: ["T022"]
          acceptance_criteria:
            - "Documents autospec history command"
            - "Documents --spec, --limit, --clear flags"
            - "Includes usage examples"
            - "Documents max_history_entries config option"
        - id: "T024"
          title: "Run quality gates: make test, make fmt, make lint, make build"
          status: "Pending"
          type: "implementation"
          parallel: false
          story_id: null
          file_path: null
          dependencies: ["T023"]
          acceptance_criteria:
            - "make test passes with no failures"
            - "make fmt produces no changes"
            - "make lint passes with no errors"
            - "make build succeeds"
dependencies:
    user_story_order:
        - story_id: "US-001"
          depends_on: []
          blocks: ["US-002", "US-003", "US-004"]
        - story_id: "US-002"
          depends_on: ["US-001"]
          blocks: []
        - story_id: "US-003"
          depends_on: ["US-001"]
          blocks: []
        - story_id: "US-004"
          depends_on: ["US-001"]
          blocks: []
        - story_id: "US-005"
          depends_on: []
          blocks: ["US-006"]
        - story_id: "US-006"
          depends_on: ["US-005"]
          blocks: []
    phase_order:
        - phase: 1
          blocks: [2]
        - phase: 2
          blocks: [3, 4, 5, 6]
        - phase: 3
          blocks: [4, 5]
        - phase: 4
          blocks: []
        - phase: 5
          blocks: []
        - phase: 6
          blocks: [7]
        - phase: 7
          blocks: []
parallel_execution:
    - phase: 1
      parallel_groups:
        - tasks: ["T002", "T003"]
          rationale: "Test file skeletons for different files can be created in parallel"
    - phase: 2
      parallel_groups:
        - tasks: ["T008", "T009"]
          rationale: "Config changes are independent of history file operations"
    - phase: 4
      parallel_groups:
        - tasks: ["T013", "T015"]
          rationale: "Tests for --spec and --limit flags are independent"
implementation_strategy:
    mvp_scope:
        phases: [1, 2, 3]
        description: "Setup + Foundational + View History - users can view command history"
        validation: "Run autospec history and see formatted output of past commands"
    incremental_delivery:
        - milestone: "Foundation Ready"
          phases: [1, 2]
          deliverable: "History package with data structures and file operations"
        - milestone: "Basic History Viewing"
          phases: [1, 2, 3]
          deliverable: "Users can run autospec history to see past commands"
        - milestone: "Full CLI Features"
          phases: [1, 2, 3, 4, 5]
          deliverable: "Complete history command with all flags (--spec, --limit, --clear)"
        - milestone: "Automatic Logging"
          phases: [1, 2, 3, 4, 5, 6]
          deliverable: "Commands are automatically logged to history"
        - milestone: "Production Ready"
          phases: [1, 2, 3, 4, 5, 6, 7]
          deliverable: "Full feature with documentation and all quality gates passing"
_meta:
    version: "1.0.0"
    generator: "autospec"
    generator_version: "autospec dev"
    created: "2025-12-17T01:30:20Z"
    artifact_type: "tasks"
