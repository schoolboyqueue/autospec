# Data Model: YAML Structured Output

**Feature**: 007-yaml-structured-output
**Date**: 2025-12-13

## Overview

This document defines the data structures for YAML structured output, including artifact schemas, metadata, and Go type definitions.

---

## 1. Core Entities

### 1.1 YAMLArtifact

The base structure for all YAML artifacts generated by the autospec workflow.

```yaml
_meta:
  version: string          # Schema version (semver)
  generator: string        # Tool name ("autospec")
  generator_version: string # Tool version
  created: string          # ISO 8601 timestamp
  artifact_type: string    # One of: spec, plan, tasks, checklist, analysis, constitution
```

**Relationships**:
- All artifact types inherit `_meta` section
- `artifact_type` determines the document's schema

**Validation Rules**:
- `version`: Must match semver pattern (e.g., "1.0.0")
- `generator`: Must be non-empty string
- `created`: Must be valid ISO 8601 timestamp

---

### 1.2 SpecArtifact

YAML representation of a feature specification.

```yaml
_meta:
  artifact_type: "spec"
  # ... base fields

feature:
  branch: string           # Git branch name
  created: string          # Creation date
  status: string           # Draft | InProgress | Complete
  input: string            # Original user description

user_stories:
  - id: string             # e.g., "US-001"
    title: string
    priority: string       # P1 | P2 | P3 | P4 | P5
    as_a: string           # Role
    i_want: string         # Action
    so_that: string        # Benefit
    why_priority: string   # Priority justification
    test_description: string
    acceptance_scenarios:
      - given: string
        when: string
        then: string

edge_cases:
  - question: string
    answer: string

requirements:
  functional:
    - id: string           # e.g., "FR-001"
      description: string
  non_functional:
    - id: string           # e.g., "NFR-001"
      description: string

key_entities:
  - name: string
    description: string

success_criteria:
  - id: string             # e.g., "SC-001"
    description: string

assumptions:
  - text: string

constraints:
  - text: string

out_of_scope:
  - text: string
```

**Go Type**:
```go
type SpecArtifact struct {
    Meta        Meta         `yaml:"_meta"`
    Feature     Feature      `yaml:"feature"`
    UserStories []UserStory  `yaml:"user_stories"`
    EdgeCases   []EdgeCase   `yaml:"edge_cases"`
    Requirements Requirements `yaml:"requirements"`
    KeyEntities []Entity     `yaml:"key_entities"`
    SuccessCriteria []Criterion `yaml:"success_criteria"`
    Assumptions []TextItem   `yaml:"assumptions"`
    Constraints []TextItem   `yaml:"constraints"`
    OutOfScope  []TextItem   `yaml:"out_of_scope"`
}
```

---

### 1.3 PlanArtifact

YAML representation of an implementation plan.

```yaml
_meta:
  artifact_type: "plan"
  # ... base fields

plan:
  branch: string
  date: string
  spec_path: string

summary: string

technical_context:
  language: string
  primary_dependencies: string[]
  storage: string
  testing: string
  target_platform: string
  project_type: string
  performance_goals: string
  constraints: string
  scale_scope: string

constitution_check:
  gates:
    - name: string
      status: string       # PASS | FAIL | REQUIRED
      notes: string

project_structure:
  documentation:
    - path: string
      description: string
  source_code:
    - path: string
      description: string

complexity_tracking:
  - violation: string
    why_needed: string
    alternative_rejected: string
```

**Go Type**:
```go
type PlanArtifact struct {
    Meta              Meta            `yaml:"_meta"`
    Plan              PlanInfo        `yaml:"plan"`
    Summary           string          `yaml:"summary"`
    TechnicalContext  TechContext     `yaml:"technical_context"`
    ConstitutionCheck ConstitutionCheck `yaml:"constitution_check"`
    ProjectStructure  ProjectStructure `yaml:"project_structure"`
    ComplexityTracking []ComplexityItem `yaml:"complexity_tracking,omitempty"`
}
```

---

### 1.4 TasksArtifact

YAML representation of implementation tasks.

```yaml
_meta:
  artifact_type: "tasks"
  # ... base fields

tasks:
  branch: string
  spec_path: string
  plan_path: string

phases:
  - number: int
    title: string
    description: string
    tasks:
      - id: string          # e.g., "1.1"
        title: string
        status: string      # Pending | InProgress | Completed
        type: string        # test | implementation | documentation | refactor
        dependencies: string[]  # Task IDs
        acceptance_criteria: string[]
        implementation_notes: string
```

**Go Type**:
```go
type TasksArtifact struct {
    Meta   Meta      `yaml:"_meta"`
    Tasks  TasksInfo `yaml:"tasks"`
    Phases []Phase   `yaml:"phases"`
}

type Phase struct {
    Number      int    `yaml:"number"`
    Title       string `yaml:"title"`
    Description string `yaml:"description"`
    Tasks       []Task `yaml:"tasks"`
}

type Task struct {
    ID                 string   `yaml:"id"`
    Title              string   `yaml:"title"`
    Status             string   `yaml:"status"`
    Type               string   `yaml:"type"`
    Dependencies       []string `yaml:"dependencies,omitempty"`
    AcceptanceCriteria []string `yaml:"acceptance_criteria"`
    ImplementationNotes string  `yaml:"implementation_notes,omitempty"`
}
```

---

### 1.5 ChecklistArtifact

YAML representation of a feature checklist.

```yaml
_meta:
  artifact_type: "checklist"
  # ... base fields

checklist:
  feature: string
  spec_path: string

categories:
  - name: string
    items:
      - id: string
        description: string
        checked: bool
        notes: string
```

**Go Type**:
```go
type ChecklistArtifact struct {
    Meta      Meta          `yaml:"_meta"`
    Checklist ChecklistInfo `yaml:"checklist"`
    Categories []Category   `yaml:"categories"`
}
```

---

### 1.6 AnalysisArtifact

YAML representation of cross-artifact analysis.

```yaml
_meta:
  artifact_type: "analysis"
  # ... base fields

analysis:
  spec_path: string
  plan_path: string
  tasks_path: string
  timestamp: string

findings:
  - category: string       # consistency | quality | coverage
    severity: string       # error | warning | info
    description: string
    location: string       # File and section reference
    recommendation: string

summary:
  total_issues: int
  errors: int
  warnings: int
  info: int
```

**Go Type**:
```go
type AnalysisArtifact struct {
    Meta     Meta         `yaml:"_meta"`
    Analysis AnalysisInfo `yaml:"analysis"`
    Findings []Finding    `yaml:"findings"`
    Summary  AnalysisSummary `yaml:"summary"`
}
```

---

### 1.7 ConstitutionArtifact

YAML representation of project constitution.

```yaml
_meta:
  artifact_type: "constitution"
  # ... base fields

constitution:
  project_name: string
  version: string
  ratified: string
  last_amended: string

principles:
  - name: string
    description: string
    enforcement: string    # How this is enforced

sections:
  - name: string
    content: string

governance:
  rules: string[]
```

**Go Type**:
```go
type ConstitutionArtifact struct {
    Meta         Meta              `yaml:"_meta"`
    Constitution ConstitutionInfo  `yaml:"constitution"`
    Principles   []Principle       `yaml:"principles"`
    Sections     []Section         `yaml:"sections"`
    Governance   GovernanceRules   `yaml:"governance"`
}
```

---

## 2. Shared Types

### 2.1 Meta

Common metadata for all artifacts.

```go
type Meta struct {
    Version          string `yaml:"version"`
    Generator        string `yaml:"generator"`
    GeneratorVersion string `yaml:"generator_version"`
    Created          string `yaml:"created"`
    ArtifactType     string `yaml:"artifact_type"`
}
```

### 2.2 CommandTemplate

Represents an embedded command template.

```go
type CommandTemplate struct {
    Name        string // Filename without extension
    Description string // From YAML frontmatter
    Version     string // Template schema version
    Content     []byte // Raw markdown content
}
```

### 2.3 VersionMismatch

Represents a version comparison result for `autospec commands check`.

```go
type VersionMismatch struct {
    CommandName       string
    InstalledVersion  string
    EmbeddedVersion   string
    Action            string // "update" | "install"
}
```

---

## 3. State Transitions

### 3.1 Task Status

```
Pending → InProgress → Completed
    ↑          |
    └──────────┘  (on failure/reassignment)
```

### 3.2 Feature Status

```
Draft → InProgress → Complete
```

### 3.3 Artifact Lifecycle

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ /autospec.  │ ──▶ │   YAML      │ ──▶ │  autospec   │
│   specify   │     │  artifact   │     │ yaml check  │
└─────────────┘     │  generated  │     └─────────────┘
                    └─────────────┘            │
                           │                   ▼
                           │         ┌─────────────────┐
                           └────────▶│ Validated/Ready │
                                     └─────────────────┘
```

---

## 4. Validation Rules Summary

| Entity | Field | Rule |
|--------|-------|------|
| Meta | version | Semver format (X.Y.Z) |
| Meta | created | ISO 8601 timestamp |
| UserStory | priority | One of: P1, P2, P3, P4, P5 |
| Task | status | One of: Pending, InProgress, Completed |
| Task | type | One of: test, implementation, documentation, refactor |
| Finding | severity | One of: error, warning, info |
| Phase | number | Positive integer |

---

## 5. File Naming Convention

| Artifact Type | Filename |
|---------------|----------|
| Specification | spec.yaml |
| Plan | plan.yaml |
| Tasks | tasks.yaml |
| Checklist | checklist.yaml |
| Analysis | analysis.yaml |
| Constitution | constitution.yaml |

All artifacts reside in `specs/<feature-name>/` directory.
