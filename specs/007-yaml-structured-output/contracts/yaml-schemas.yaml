# YAML Artifact Schemas
# Feature: 007-yaml-structured-output
# Date: 2025-12-13
#
# This file defines the schema contracts for all YAML artifacts
# generated by the autospec YAML workflow.

---
# Schema version for this contract file
schema_version: "1.0.0"

# =============================================================================
# Meta Schema (shared by all artifacts)
# =============================================================================
meta:
  type: object
  required:
    - version
    - generator
    - generator_version
    - created
    - artifact_type
  properties:
    version:
      type: string
      pattern: "^\\d+\\.\\d+\\.\\d+$"
      description: "Schema version in semver format"
    generator:
      type: string
      enum: ["autospec"]
      description: "Tool that generated this artifact"
    generator_version:
      type: string
      pattern: "^\\d+\\.\\d+\\.\\d+$"
      description: "Version of the generator tool"
    created:
      type: string
      format: "date-time"
      description: "ISO 8601 timestamp of creation"
    artifact_type:
      type: string
      enum: ["spec", "plan", "tasks", "checklist", "analysis", "constitution"]
      description: "Type of artifact"

# =============================================================================
# Spec Artifact Schema
# =============================================================================
spec_artifact:
  type: object
  required:
    - _meta
    - feature
    - user_stories
    - requirements
  properties:
    _meta:
      $ref: "#/meta"
      constraint: "artifact_type must be 'spec'"
    feature:
      type: object
      required: [branch, created, status]
      properties:
        branch:
          type: string
          pattern: "^\\d{3}-[a-z0-9-]+$"
        created:
          type: string
          format: date
        status:
          type: string
          enum: ["Draft", "InProgress", "Complete"]
        input:
          type: string
    user_stories:
      type: array
      minItems: 1
      items:
        type: object
        required: [id, title, priority, as_a, i_want, so_that, acceptance_scenarios]
        properties:
          id:
            type: string
            pattern: "^US-\\d{3}$"
          title:
            type: string
          priority:
            type: string
            enum: ["P1", "P2", "P3", "P4", "P5"]
          as_a:
            type: string
          i_want:
            type: string
          so_that:
            type: string
          why_priority:
            type: string
          test_description:
            type: string
          acceptance_scenarios:
            type: array
            items:
              type: object
              required: [given, when, then]
    edge_cases:
      type: array
      items:
        type: object
        required: [question, answer]
    requirements:
      type: object
      required: [functional]
      properties:
        functional:
          type: array
          items:
            type: object
            required: [id, description]
            properties:
              id:
                type: string
                pattern: "^FR-\\d{3}$"
              description:
                type: string
        non_functional:
          type: array
          items:
            type: object
            required: [id, description]
            properties:
              id:
                type: string
                pattern: "^NFR-\\d{3}$"
    key_entities:
      type: array
      items:
        type: object
        required: [name, description]
    success_criteria:
      type: array
      items:
        type: object
        required: [id, description]
        properties:
          id:
            type: string
            pattern: "^SC-\\d{3}$"
    assumptions:
      type: array
      items:
        type: object
        required: [text]
    constraints:
      type: array
      items:
        type: object
        required: [text]
    out_of_scope:
      type: array
      items:
        type: object
        required: [text]

# =============================================================================
# Plan Artifact Schema
# =============================================================================
plan_artifact:
  type: object
  required:
    - _meta
    - plan
    - summary
    - technical_context
  properties:
    _meta:
      $ref: "#/meta"
      constraint: "artifact_type must be 'plan'"
    plan:
      type: object
      required: [branch, date, spec_path]
      properties:
        branch:
          type: string
        date:
          type: string
          format: date
        spec_path:
          type: string
    summary:
      type: string
    technical_context:
      type: object
      properties:
        language:
          type: string
        primary_dependencies:
          type: array
          items:
            type: string
        storage:
          type: string
        testing:
          type: string
        target_platform:
          type: string
        project_type:
          type: string
          enum: ["single", "web", "mobile"]
        performance_goals:
          type: string
        constraints:
          type: string
        scale_scope:
          type: string
    constitution_check:
      type: object
      properties:
        gates:
          type: array
          items:
            type: object
            required: [name, status]
            properties:
              name:
                type: string
              status:
                type: string
                enum: ["PASS", "FAIL", "REQUIRED"]
              notes:
                type: string
    project_structure:
      type: object
      properties:
        documentation:
          type: array
          items:
            type: object
            required: [path, description]
        source_code:
          type: array
          items:
            type: object
            required: [path, description]
    complexity_tracking:
      type: array
      items:
        type: object
        required: [violation, why_needed, alternative_rejected]

# =============================================================================
# Tasks Artifact Schema
# =============================================================================
tasks_artifact:
  type: object
  required:
    - _meta
    - tasks
    - phases
  properties:
    _meta:
      $ref: "#/meta"
      constraint: "artifact_type must be 'tasks'"
    tasks:
      type: object
      required: [branch, spec_path, plan_path]
      properties:
        branch:
          type: string
        spec_path:
          type: string
        plan_path:
          type: string
    phases:
      type: array
      minItems: 1
      items:
        type: object
        required: [number, title, tasks]
        properties:
          number:
            type: integer
            minimum: 0
          title:
            type: string
          description:
            type: string
          tasks:
            type: array
            items:
              type: object
              required: [id, title, status, type, acceptance_criteria]
              properties:
                id:
                  type: string
                  pattern: "^\\d+\\.\\d+$"
                title:
                  type: string
                status:
                  type: string
                  enum: ["Pending", "InProgress", "Completed"]
                type:
                  type: string
                  enum: ["test", "implementation", "documentation", "refactor"]
                dependencies:
                  type: array
                  items:
                    type: string
                acceptance_criteria:
                  type: array
                  items:
                    type: string
                implementation_notes:
                  type: string

# =============================================================================
# Checklist Artifact Schema
# =============================================================================
checklist_artifact:
  type: object
  required:
    - _meta
    - checklist
    - categories
  properties:
    _meta:
      $ref: "#/meta"
      constraint: "artifact_type must be 'checklist'"
    checklist:
      type: object
      required: [feature, spec_path]
      properties:
        feature:
          type: string
        spec_path:
          type: string
    categories:
      type: array
      items:
        type: object
        required: [name, items]
        properties:
          name:
            type: string
          items:
            type: array
            items:
              type: object
              required: [id, description, checked]
              properties:
                id:
                  type: string
                description:
                  type: string
                checked:
                  type: boolean
                notes:
                  type: string

# =============================================================================
# Analysis Artifact Schema
# =============================================================================
analysis_artifact:
  type: object
  required:
    - _meta
    - analysis
    - findings
    - summary
  properties:
    _meta:
      $ref: "#/meta"
      constraint: "artifact_type must be 'analysis'"
    analysis:
      type: object
      required: [spec_path, plan_path, tasks_path, timestamp]
      properties:
        spec_path:
          type: string
        plan_path:
          type: string
        tasks_path:
          type: string
        timestamp:
          type: string
          format: date-time
    findings:
      type: array
      items:
        type: object
        required: [category, severity, description, location]
        properties:
          category:
            type: string
            enum: ["consistency", "quality", "coverage"]
          severity:
            type: string
            enum: ["error", "warning", "info"]
          description:
            type: string
          location:
            type: string
          recommendation:
            type: string
    summary:
      type: object
      required: [total_issues, errors, warnings, info]
      properties:
        total_issues:
          type: integer
          minimum: 0
        errors:
          type: integer
          minimum: 0
        warnings:
          type: integer
          minimum: 0
        info:
          type: integer
          minimum: 0

# =============================================================================
# Constitution Artifact Schema
# =============================================================================
constitution_artifact:
  type: object
  required:
    - _meta
    - constitution
    - principles
  properties:
    _meta:
      $ref: "#/meta"
      constraint: "artifact_type must be 'constitution'"
    constitution:
      type: object
      required: [project_name, version, ratified]
      properties:
        project_name:
          type: string
        version:
          type: string
        ratified:
          type: string
          format: date
        last_amended:
          type: string
          format: date
    principles:
      type: array
      minItems: 1
      items:
        type: object
        required: [name, description]
        properties:
          name:
            type: string
          description:
            type: string
          enforcement:
            type: string
    sections:
      type: array
      items:
        type: object
        required: [name, content]
    governance:
      type: object
      properties:
        rules:
          type: array
          items:
            type: string
